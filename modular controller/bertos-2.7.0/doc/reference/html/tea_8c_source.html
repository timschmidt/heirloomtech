

<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_9fd71c1ac00056e7d855336b2291c56c.html">bertos</a>      </li>
      <li class="navelem"><a class="el" href="dir_7a1c32e0b61e66bba4924a9a48a40b57.html">algo</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">tea.c</div>  </div>
</div>
<div class="contents">
<a href="tea_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00066"></a>00066 <span class="preprocessor">#include &quot;<a class="code" href="tea_8h.html" title="TEA Tiny Encription Algorith functions.">tea.h</a>&quot;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &lt;<a class="code" href="cpu_2byteorder_8h.html" title="Functions to convert integers to/from host byte-order.">cpu/byteorder.h</a>&gt;</span>
<a name="l00068"></a>00068 
<a name="l00069"></a>00069 <span class="keyword">static</span> uint32_t tea_func(uint32_t *in, uint32_t *sum, uint32_t *k)
<a name="l00070"></a>00070 {
<a name="l00071"></a>00071     <span class="keywordflow">return</span> ((*in &lt;&lt; 4) + cpu_to_le32(k[0])) ^ (*in + *sum) ^ ((*in &gt;&gt; 5) + cpu_to_le32(k[1]));
<a name="l00072"></a>00072 }
<a name="l00073"></a>00073 
<a name="l00081"></a><a class="code" href="tea_8h.html#a8e5e58235564805670941eae0650d183">00081</a> <span class="keywordtype">void</span> <a class="code" href="tea_8c.html#a8e5e58235564805670941eae0650d183" title="TEA encryption function.">tea_enc</a>(<span class="keywordtype">void</span> *_v, <span class="keywordtype">void</span> *_k)
<a name="l00082"></a>00082 {
<a name="l00083"></a>00083     uint32_t y, z;
<a name="l00084"></a>00084     uint32_t sum = 0;
<a name="l00085"></a>00085     uint8_t n = <a class="code" href="tea_8h.html#a69479655ab94c875413d38689002ff98" title="Number of rounds.">ROUNDS</a>;
<a name="l00086"></a>00086     uint32_t *v = (uint32_t *)_v;
<a name="l00087"></a>00087     uint32_t *k = (uint32_t *)_k;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089     y=cpu_to_le32(v[0]);
<a name="l00090"></a>00090     z=cpu_to_le32(v[1]);
<a name="l00091"></a>00091 
<a name="l00092"></a>00092     <span class="keywordflow">while</span>(n-- &gt; 0)
<a name="l00093"></a>00093     {
<a name="l00094"></a>00094         sum += <a class="code" href="tea_8h.html#a3fd2b1bcd7ddcf506237987ad780f495" title="Magic value. (Golden number * 2^31)">DELTA</a>;
<a name="l00095"></a>00095         y += tea_func(&amp;z, &amp;sum, &amp;(k[0]));
<a name="l00096"></a>00096         z += tea_func(&amp;y, &amp;sum, &amp;(k[2]));
<a name="l00097"></a>00097     }
<a name="l00098"></a>00098 
<a name="l00099"></a>00099     v[0] = le32_to_cpu(y);
<a name="l00100"></a>00100     v[1] = le32_to_cpu(z);
<a name="l00101"></a>00101 }
<a name="l00102"></a>00102 
<a name="l00110"></a><a class="code" href="tea_8h.html#a03a41475f621aad15671d2c43cfdb2b7">00110</a> <span class="keywordtype">void</span> <a class="code" href="tea_8c.html#a03a41475f621aad15671d2c43cfdb2b7" title="TEA decryption function.">tea_dec</a>(<span class="keywordtype">void</span> *_v, <span class="keywordtype">void</span> *_k)
<a name="l00111"></a>00111 {
<a name="l00112"></a>00112     uint32_t y, z;
<a name="l00113"></a>00113     uint32_t sum = <a class="code" href="tea_8h.html#a3fd2b1bcd7ddcf506237987ad780f495" title="Magic value. (Golden number * 2^31)">DELTA</a> * <a class="code" href="tea_8h.html#a69479655ab94c875413d38689002ff98" title="Number of rounds.">ROUNDS</a>;
<a name="l00114"></a>00114     uint8_t n = <a class="code" href="tea_8h.html#a69479655ab94c875413d38689002ff98" title="Number of rounds.">ROUNDS</a>;
<a name="l00115"></a>00115     uint32_t *v = (uint32_t *)_v;
<a name="l00116"></a>00116     uint32_t *k = (uint32_t *)_k;
<a name="l00117"></a>00117 
<a name="l00118"></a>00118     y = cpu_to_le32(v[0]);
<a name="l00119"></a>00119     z = cpu_to_le32(v[1]);
<a name="l00120"></a>00120 
<a name="l00121"></a>00121     <span class="keywordflow">while</span>(n-- &gt; 0)
<a name="l00122"></a>00122     {
<a name="l00123"></a>00123         z -= tea_func(&amp;y, &amp;sum, &amp;(k[2]));
<a name="l00124"></a>00124         y -= tea_func(&amp;z, &amp;sum, &amp;(k[0]));
<a name="l00125"></a>00125         sum -= <a class="code" href="tea_8h.html#a3fd2b1bcd7ddcf506237987ad780f495" title="Magic value. (Golden number * 2^31)">DELTA</a>;
<a name="l00126"></a>00126     }
<a name="l00127"></a>00127 
<a name="l00128"></a>00128     v[0] = le32_to_cpu(y);
<a name="l00129"></a>00129     v[1] = le32_to_cpu(z);
<a name="l00130"></a>00130 }
<a name="l00131"></a>00131 
</pre></div></div>
</div>


