

<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">KFile interface over KBlock</div>  </div>
<div class="ingroups"><a class="el" href="group__core.html">BeRTOS core functionality</a></div></div>
<div class="contents">

<p><a class="el" href="structKFile.html" title="Context data for callback functions which operate on pseudo files.">KFile</a> interface over a <a class="el" href="structKBlock.html" title="KBlock: interface for a generic block device.">KBlock</a>.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structKFileBlock.html">KFileBlock</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="structKFileBlock.html" title="KFileBlock context.">KFileBlock</a> context.  <a href="structKFileBlock.html#details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__kfile__block.html#ga852b4a8e0dbc3cd1a6b32d17a2bfb721">kfileblock_init</a> (<a class="el" href="structKFileBlock.html">KFileBlock</a> *fb, <a class="el" href="structKBlock.html">KBlock</a> *blk)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Init a <a class="el" href="structKFile.html" title="Context data for callback functions which operate on pseudo files.">KFile</a> over <a class="el" href="structKBlock.html" title="KBlock: interface for a generic block device.">KBlock</a>.  <a href="#ga852b4a8e0dbc3cd1a6b32d17a2bfb721"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<p><a class="el" href="structKFile.html" title="Context data for callback functions which operate on pseudo files.">KFile</a> interface over a <a class="el" href="structKBlock.html" title="KBlock: interface for a generic block device.">KBlock</a>. </p>
<p>With this module, you can access a <a class="el" href="structKBlock.html" title="KBlock: interface for a generic block device.">KBlock</a> device with the handy <a class="el" href="structKFile.html" title="Context data for callback functions which operate on pseudo files.">KFile</a> interface. In order to achieve this, the block device must support partial block write.</p>
<p>Error codes returned by <a class="el" href="group__io__kfile.html#ga9638c7d7f76976a58ceb670c28e13c39" title="Get file error mask.">kfile_error()</a> are specific of the underlying <a class="el" href="structKBlock.html" title="KBlock: interface for a generic block device.">KBlock</a> implementation.</p>
<p>Make sure you have trimmed the <a class="el" href="structKBlock.html" title="KBlock: interface for a generic block device.">KBlock</a> to avoid overwriting something. Example: </p>
<div class="fragment"><pre class="fragment"> <span class="comment">// init a derived instance of KBlock</span>
 <span class="comment">// any will do.</span>
 <a class="code" href="structFlash.html" title="EmbFlash KBlock context structure.">Flash</a> flash;
 <a class="code" href="group__drv__emb__flash.html#ga4ac5b95e3a0356f065fe0bb5eb9e3d33" title="Init function for flash driver.">flash_init</a>(&amp;flash, 0);
 <a class="code" href="group__io__kblock.html#ga0a44548c390609987086cac6a2387b99" title="Use a subset of the blocks on the device.">kblock_trim</a>(&amp;flash.<a class="code" href="structFlash.html#adbd85a74983c749e2ddf796538ac6baa" title="KBlock context.">blk</a>, trim_start, internal_flash.blk.<a class="code" href="structKBlock.html#ad413baaa0d82a56b1006fd69acb53fcc" title="Number of blocks available in the device.">blk_cnt</a> - trim_start);

 <span class="comment">// now create and initialize the kfile_block instance</span>
 <a class="code" href="structKFileBlock.html" title="KFileBlock context.">KFileBlock</a> kfb;
 <a class="code" href="group__kfile__block.html#ga852b4a8e0dbc3cd1a6b32d17a2bfb721" title="Init a KFile over KBlock.">kfileblock_init</a>(&amp;kfb, &amp;flash.<a class="code" href="structFlash.html#adbd85a74983c749e2ddf796538ac6baa" title="KBlock context.">blk</a>);

 <span class="comment">// now you can access the Flash in a file like fashion</span>
 <a class="code" href="group__io__kfile.html#ga56f9291708a17fd2aed611844c4f9286" title="Read size bytes from file fd into buf.">kfile_read</a>(&amp;kfb.<a class="code" href="structKFileBlock.html#a9c6548468fca50f76b9427de8286a58b" title="KFile context.">fd</a>, buf, 20);
</pre></div><dl class="author"><dt><b>Author:</b></dt><dd>Francesco Sacchi &lt;<a href="mailto:batt@develer.com">batt@develer.com</a>&gt; </dd>
<dd>
Daniele Basile &lt;<a href="mailto:asterix@develer.com">asterix@develer.com</a>&gt; </dd></dl>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga852b4a8e0dbc3cd1a6b32d17a2bfb721"></a><!-- doxytag: member="kfile_block.h::kfileblock_init" ref="ga852b4a8e0dbc3cd1a6b32d17a2bfb721" args="(KFileBlock *fb, KBlock *blk)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void kfileblock_init </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structKFileBlock.html">KFileBlock</a> *&#160;</td>
          <td class="paramname"><em>fb</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structKBlock.html">KBlock</a> *&#160;</td>
          <td class="paramname"><em>blk</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Init a <a class="el" href="structKFile.html" title="Context data for callback functions which operate on pseudo files.">KFile</a> over <a class="el" href="structKBlock.html" title="KBlock: interface for a generic block device.">KBlock</a>. </p>
<p>After this you can access your <a class="el" href="structKBlock.html" title="KBlock: interface for a generic block device.">KBlock</a> device with a handy <a class="el" href="structKFile.html" title="Context data for callback functions which operate on pseudo files.">KFile</a> interface.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>The block device must support partial block write in order to support random write access.</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">fb</td><td><a class="el" href="structKFileBlock.html" title="KFileBlock context.">KFileBlock</a> context. </td></tr>
    <tr><td class="paramname">blk</td><td>block device to be accessed with a <a class="el" href="structKFile.html" title="Context data for callback functions which operate on pseudo files.">KFile</a> interface. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="kfile__block_8c_source.html#l00116">116</a> of file <a class="el" href="kfile__block_8c_source.html">kfile_block.c</a>.</p>

</div>
</div>
</div>


