

<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_9fd71c1ac00056e7d855336b2291c56c.html">bertos</a>      </li>
      <li class="navelem"><a class="el" href="dir_8751e12fe1becf196f093883e557854f.html">struct</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">hashtable.h</div>  </div>
</div>
<div class="contents">
<a href="hashtable_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00061"></a>00061 <span class="preprocessor">#ifndef STRUCT_HASHTABLE_H</span>
<a name="l00062"></a>00062 <span class="preprocessor"></span><span class="preprocessor">#define STRUCT_HASHTABLE_H</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span>
<a name="l00064"></a>00064 <span class="preprocessor">#include &quot;<a class="code" href="cfg__hashtable_8h.html" title="Configuration file for hashtable module.">cfg/cfg_hashtable.h</a>&quot;</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="preprocessor">#include &lt;<a class="code" href="compiler_8h.html" title="Additional support macros for compiler independance.">cfg/compiler.h</a>&gt;</span>
<a name="l00067"></a>00067 <span class="preprocessor">#include &lt;<a class="code" href="macros_8h.html">cfg/macros.h</a>&gt;</span>
<a name="l00068"></a>00068 <span class="preprocessor">#include &lt;<a class="code" href="debug_8h.html">cfg/debug.h</a>&gt;</span>
<a name="l00069"></a>00069 
<a name="l00071"></a><a class="code" href="group__hashtable.html#ga0b33ec1bf27aefc1fc52211218048ef4">00071</a> <span class="preprocessor">#define INTERNAL_KEY_MAX_LENGTH     15</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span>
<a name="l00077"></a><a class="code" href="group__hashtable.html#gacaff480b667122f53c5c85709cbcf315">00077</a> <span class="keyword">typedef</span> <span class="keyword">const</span> <span class="keywordtype">void</span> *(*hook_get_key)(<span class="keyword">const</span> <span class="keywordtype">void</span> *data, uint8_t *key_length);
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 
<a name="l00090"></a><a class="code" href="structHashTable.html">00090</a> <span class="keyword">struct </span><a class="code" href="structHashTable.html" title="Hash table description.">HashTable</a>
<a name="l00091"></a>00091 {
<a name="l00092"></a><a class="code" href="structHashTable.html#aec11db08aa9ca4a28b464319f6eb6329">00092</a>     <span class="keyword">const</span> <span class="keywordtype">void</span> **<a class="code" href="structHashTable.html#aec11db08aa9ca4a28b464319f6eb6329" title="Buckets of data.">mem</a>;            
<a name="l00093"></a><a class="code" href="structHashTable.html#a42ceb98f88dfb7d3c5a17a090189e7b8">00093</a>     uint16_t <a class="code" href="structHashTable.html#a42ceb98f88dfb7d3c5a17a090189e7b8" title="Log2 of the size of the table.">max_elts_log2</a>;      
<a name="l00094"></a>00094     <span class="keyword">struct </span>{
<a name="l00095"></a><a class="code" href="structHashTable.html#ae584311fa8a2b5a55d3095960ae9ee35">00095</a>         <span class="keywordtype">bool</span> <a class="code" href="structHashTable.html#ae584311fa8a2b5a55d3095960ae9ee35" title="true if the key is copied internally">key_internal</a> : 1;   
<a name="l00096"></a>00096     } flags;
<a name="l00097"></a>00097     <span class="keyword">union </span>{
<a name="l00098"></a><a class="code" href="structHashTable.html#a14795472b31b31fc933e1b57b9737d75">00098</a>         <a class="code" href="group__hashtable.html#gacaff480b667122f53c5c85709cbcf315" title="Hook to get the key from data, which is an element of the hash table.">hook_get_key</a> <a class="code" href="structHashTable.html#a14795472b31b31fc933e1b57b9737d75" title="Hook to get the key.">hook</a>;       
<a name="l00099"></a><a class="code" href="structHashTable.html#afe8aca9325baeaffe69db5fe3d1b9fc0">00099</a>         uint8_t *<a class="code" href="structHashTable.html#afe8aca9325baeaffe69db5fe3d1b9fc0" title="Pointer to the key memory.">mem</a>;            
<a name="l00100"></a>00100     } key_data;
<a name="l00101"></a>00101 };
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 
<a name="l00105"></a><a class="code" href="structHashIterator.html">00105</a> <span class="keyword">typedef</span> <span class="keyword">struct</span>
<a name="l00106"></a>00106 {
<a name="l00107"></a>00107     <span class="keyword">const</span> <span class="keywordtype">void</span>** pos;
<a name="l00108"></a>00108     <span class="keyword">const</span> <span class="keywordtype">void</span>** end;
<a name="l00109"></a>00109 } <a class="code" href="structHashIterator.html" title="Iterator to walk the hash table.">HashIterator</a>;
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 
<a name="l00123"></a><a class="code" href="group__hashtable.html#ga1c76a860feecc225c0dc27bf773a63a1">00123</a> <span class="preprocessor">#define DECLARE_HASHTABLE(name, size, hook_gk) \</span>
<a name="l00124"></a>00124 <span class="preprocessor">    static const void* name##_nodes[1 &lt;&lt; UINT32_LOG2(size)]; \</span>
<a name="l00125"></a>00125 <span class="preprocessor">    struct HashTable name = \</span>
<a name="l00126"></a>00126 <span class="preprocessor">        { \</span>
<a name="l00127"></a>00127 <span class="preprocessor">            .mem = name##_nodes, \</span>
<a name="l00128"></a>00128 <span class="preprocessor">            .max_elts_log2 = UINT32_LOG2(size), \</span>
<a name="l00129"></a>00129 <span class="preprocessor">            .flags = { .key_internal = false }, \</span>
<a name="l00130"></a>00130 <span class="preprocessor">            .key_data.hook = hook_gk \</span>
<a name="l00131"></a>00131 <span class="preprocessor">        }</span>
<a name="l00132"></a>00132 <span class="preprocessor"></span>
<a name="l00133"></a>00133 
<a name="l00135"></a><a class="code" href="group__hashtable.html#gabfba4f3bd010e675164bd7828a59ac38">00135</a> <span class="preprocessor">#define DECLARE_HASHTABLE_STATIC(name, size, hook_gk) \</span>
<a name="l00136"></a>00136 <span class="preprocessor">    enum { name##_SIZE = (1 &lt;&lt; UINT32_LOG2(size)), }; \</span>
<a name="l00137"></a>00137 <span class="preprocessor">    static const void* name##_nodes[name##_SIZE]; \</span>
<a name="l00138"></a>00138 <span class="preprocessor">    static struct HashTable name = \</span>
<a name="l00139"></a>00139 <span class="preprocessor">        { \</span>
<a name="l00140"></a>00140 <span class="preprocessor">            .mem = name##_nodes, \</span>
<a name="l00141"></a>00141 <span class="preprocessor">            .max_elts_log2 = UINT32_LOG2(size), \</span>
<a name="l00142"></a>00142 <span class="preprocessor">            .flags = { .key_internal = false }, \</span>
<a name="l00143"></a>00143 <span class="preprocessor">            .key_data.hook = hook_gk \</span>
<a name="l00144"></a>00144 <span class="preprocessor">        }</span>
<a name="l00145"></a>00145 <span class="preprocessor"></span>
<a name="l00146"></a>00146 <span class="preprocessor">#if CONFIG_HT_OPTIONAL_INTERNAL_KEY</span>
<a name="l00147"></a>00147 <span class="preprocessor"></span>
<a name="l00152"></a>00152 <span class="preprocessor">    #define DECLARE_HASHTABLE_INTERNALKEY(name, size) \</span>
<a name="l00153"></a>00153 <span class="preprocessor">        static uint8_t name##_keys[(1 &lt;&lt; UINT32_LOG2(size)) * (INTERNAL_KEY_MAX_LENGTH + 1)]; \</span>
<a name="l00154"></a>00154 <span class="preprocessor">        static const void* name##_nodes[1 &lt;&lt; UINT32_LOG2(size)]; \</span>
<a name="l00155"></a>00155 <span class="preprocessor">        struct HashTable name = { name##_nodes, UINT32_LOG2(size), { true }, name##_keys }</span>
<a name="l00156"></a>00156 <span class="preprocessor"></span>
<a name="l00158"></a>00158 <span class="preprocessor">    #define DECLARE_HASHTABLE_INTERNALKEY_STATIC(name, size) \</span>
<a name="l00159"></a>00159 <span class="preprocessor">        enum { name##_KEYS = ((1 &lt;&lt; UINT32_LOG2(size)) * (INTERNAL_KEY_MAX_LENGTH + 1)), \</span>
<a name="l00160"></a>00160 <span class="preprocessor">            name##_SIZE = (1 &lt;&lt; UINT32_LOG2(size)), }; \</span>
<a name="l00161"></a>00161 <span class="preprocessor">        static uint8_t name##_keys[name##_KEYS]; \</span>
<a name="l00162"></a>00162 <span class="preprocessor">        static const void* name##_nodes[name##_SIZE]; \</span>
<a name="l00163"></a>00163 <span class="preprocessor">        static struct HashTable name = \</span>
<a name="l00164"></a>00164 <span class="preprocessor">            { \</span>
<a name="l00165"></a>00165 <span class="preprocessor">                .mem = name##_nodes, \</span>
<a name="l00166"></a>00166 <span class="preprocessor">                .max_elts_log2 = UINT32_LOG2(size), \</span>
<a name="l00167"></a>00167 <span class="preprocessor">                .flags = { .key_internal = true }, \</span>
<a name="l00168"></a>00168 <span class="preprocessor">                .key_data.mem = name##_keys \</span>
<a name="l00169"></a>00169 <span class="preprocessor">            }</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00171"></a>00171 <span class="preprocessor"></span>
<a name="l00181"></a>00181 <span class="keywordtype">void</span> <a class="code" href="group__hashtable.html#ga642ef6e1807f57157197f92a3647ccff" title="Initialize (and clear) a hash table in a memory buffer.">ht_init</a>(<span class="keyword">struct</span> <a class="code" href="structHashTable.html" title="Hash table description.">HashTable</a>* ht);
<a name="l00182"></a>00182 
<a name="l00200"></a>00200 <span class="keywordtype">bool</span> <a class="code" href="group__hashtable.html#ga40e43fc231256c2ea0593c044ed90736" title="Insert an element into the hash table.">ht_insert</a>(<span class="keyword">struct</span> <a class="code" href="structHashTable.html" title="Hash table description.">HashTable</a>* ht, <span class="keyword">const</span> <span class="keywordtype">void</span>* data);
<a name="l00201"></a>00201 
<a name="l00221"></a>00221 <span class="keywordtype">bool</span> <a class="code" href="group__hashtable.html#ga7fa7adf45770670438f205ec1f17e8f6" title="Insert an element into the hash table.">ht_insert_with_key</a>(<span class="keyword">struct</span> <a class="code" href="structHashTable.html" title="Hash table description.">HashTable</a>* ht, <span class="keyword">const</span> <span class="keywordtype">void</span>* key, uint8_t key_length, <span class="keyword">const</span> <span class="keywordtype">void</span>* data);
<a name="l00222"></a>00222 
<a name="l00231"></a>00231 <span class="keyword">const</span> <span class="keywordtype">void</span>* <a class="code" href="group__hashtable.html#gaba057880cc98ec88e0fcd46b54bb5a71" title="Find an element in the hash table.">ht_find</a>(<span class="keyword">struct</span> <a class="code" href="structHashTable.html" title="Hash table description.">HashTable</a>* ht, <span class="keyword">const</span> <span class="keywordtype">void</span>* key, uint8_t key_length);
<a name="l00232"></a>00232 
<a name="l00234"></a><a class="code" href="group__hashtable.html#ga2172123004dd6410e7ce7d3f984627a4">00234</a> <span class="preprocessor">#define ht_insert_str(ht, key, data)         ht_insert_with_key(ht, key, strlen(key), data)</span>
<a name="l00235"></a>00235 <span class="preprocessor"></span>
<a name="l00237"></a><a class="code" href="group__hashtable.html#ga8dd9b75b22d4d0fa5b540a82fa015747">00237</a> <span class="preprocessor">#define ht_find_str(ht, key)                 ht_find(ht, key, strlen(key))</span>
<a name="l00238"></a>00238 <span class="preprocessor"></span>
<a name="l00240"></a><a class="code" href="group__hashtable.html#gaddd877706abcd4f8f9fbf859619a739c">00240</a> INLINE <a class="code" href="structHashIterator.html" title="Iterator to walk the hash table.">HashIterator</a> <a class="code" href="group__hashtable.html#gaddd877706abcd4f8f9fbf859619a739c" title="Get an iterator to the begin of the hash table ht.">ht_iter_begin</a>(<span class="keyword">struct</span> <a class="code" href="structHashTable.html" title="Hash table description.">HashTable</a>* ht)
<a name="l00241"></a>00241 {
<a name="l00242"></a>00242     <a class="code" href="structHashIterator.html" title="Iterator to walk the hash table.">HashIterator</a> h;
<a name="l00243"></a>00243 
<a name="l00244"></a>00244     h.pos = &amp;ht-&gt;<a class="code" href="structHashTable.html#aec11db08aa9ca4a28b464319f6eb6329" title="Buckets of data.">mem</a>[0];
<a name="l00245"></a>00245     h.end = &amp;ht-&gt;<a class="code" href="structHashTable.html#aec11db08aa9ca4a28b464319f6eb6329" title="Buckets of data.">mem</a>[1 &lt;&lt; ht-&gt;<a class="code" href="structHashTable.html#a42ceb98f88dfb7d3c5a17a090189e7b8" title="Log2 of the size of the table.">max_elts_log2</a>];
<a name="l00246"></a>00246 
<a name="l00247"></a>00247     <span class="keywordflow">while</span> (h.pos != h.end &amp;&amp; !*h.pos)
<a name="l00248"></a>00248         ++h.pos;
<a name="l00249"></a>00249 
<a name="l00250"></a>00250     <span class="keywordflow">return</span> h;
<a name="l00251"></a>00251 }
<a name="l00252"></a>00252 
<a name="l00260"></a><a class="code" href="group__hashtable.html#gacf8073fe476b414b93c32d8169ba5bdc">00260</a> INLINE <a class="code" href="structHashIterator.html" title="Iterator to walk the hash table.">HashIterator</a> <a class="code" href="group__hashtable.html#gacf8073fe476b414b93c32d8169ba5bdc" title="Get an iterator to the (exclusive) end of the hash table ht.">ht_iter_end</a>(<span class="keyword">struct</span> <a class="code" href="structHashTable.html" title="Hash table description.">HashTable</a>* ht)
<a name="l00261"></a>00261 {
<a name="l00262"></a>00262     <a class="code" href="structHashIterator.html" title="Iterator to walk the hash table.">HashIterator</a> h;
<a name="l00263"></a>00263 
<a name="l00264"></a>00264     h.pos = h.end = &amp;ht-&gt;<a class="code" href="structHashTable.html#aec11db08aa9ca4a28b464319f6eb6329" title="Buckets of data.">mem</a>[1 &lt;&lt; ht-&gt;<a class="code" href="structHashTable.html#a42ceb98f88dfb7d3c5a17a090189e7b8" title="Log2 of the size of the table.">max_elts_log2</a>];
<a name="l00265"></a>00265 
<a name="l00266"></a>00266     <span class="keywordflow">return</span> h;
<a name="l00267"></a>00267 }
<a name="l00268"></a>00268 
<a name="l00270"></a><a class="code" href="group__hashtable.html#gad24c6445f6bd985748d867fa7dec1fbd">00270</a> INLINE <span class="keywordtype">bool</span> <a class="code" href="group__hashtable.html#gad24c6445f6bd985748d867fa7dec1fbd" title="Compare it1 and it2 for equality.">ht_iter_cmp</a>(<a class="code" href="structHashIterator.html" title="Iterator to walk the hash table.">HashIterator</a> it1, <a class="code" href="structHashIterator.html" title="Iterator to walk the hash table.">HashIterator</a> it2)
<a name="l00271"></a>00271 {
<a name="l00272"></a>00272     <a class="code" href="group__debug.html#gaca68c0d4ac8df0838e209fb5300f7be3" title="Assert a pre-condition on code.">ASSERT</a>(it1.end == it2.end);
<a name="l00273"></a>00273     <span class="keywordflow">return</span> it1.pos == it2.pos;
<a name="l00274"></a>00274 }
<a name="l00275"></a>00275 
<a name="l00277"></a><a class="code" href="group__hashtable.html#ga97974c395f3f43844ee4ea778e744482">00277</a> INLINE <span class="keyword">const</span> <span class="keywordtype">void</span>* <a class="code" href="group__hashtable.html#ga97974c395f3f43844ee4ea778e744482" title="Get the element within the hash table ht pointed by the iterator iter.">ht_iter_get</a>(<a class="code" href="structHashIterator.html" title="Iterator to walk the hash table.">HashIterator</a> iter)
<a name="l00278"></a>00278 { <span class="keywordflow">return</span> *iter.pos; }
<a name="l00279"></a>00279 
<a name="l00286"></a><a class="code" href="group__hashtable.html#ga1e7c45449116133e83072c2e0c17cf99">00286</a> INLINE <a class="code" href="structHashIterator.html" title="Iterator to walk the hash table.">HashIterator</a> <a class="code" href="group__hashtable.html#ga1e7c45449116133e83072c2e0c17cf99" title="Return an iterator pointing to the element following h.">ht_iter_next</a>(<a class="code" href="structHashIterator.html" title="Iterator to walk the hash table.">HashIterator</a> h)
<a name="l00287"></a>00287 {
<a name="l00288"></a>00288     ++h.pos;
<a name="l00289"></a>00289     <span class="keywordflow">while</span> (h.pos != h.end &amp;&amp; !(*h.pos))
<a name="l00290"></a>00290         ++h.pos;
<a name="l00291"></a>00291 
<a name="l00292"></a>00292     <span class="keywordflow">return</span> h;
<a name="l00293"></a>00293 }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295 <span class="keywordtype">int</span> hashtable_testSetup(<span class="keywordtype">void</span>);
<a name="l00296"></a>00296 <span class="keywordtype">int</span> hashtable_testRun(<span class="keywordtype">void</span>);
<a name="l00297"></a>00297 <span class="keywordtype">int</span> hashtable_testTearDown(<span class="keywordtype">void</span>);
<a name="l00298"></a>00298  <span class="comment">// \defgroup hashtable</span>
<a name="l00300"></a>00300 
<a name="l00301"></a>00301 <span class="preprocessor">#endif </span><span class="comment">/* STRUCT_HASHTABLE_H */</span>
</pre></div></div>
</div>


