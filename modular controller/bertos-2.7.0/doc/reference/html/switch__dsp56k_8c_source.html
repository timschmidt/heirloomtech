

<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_9fd71c1ac00056e7d855336b2291c56c.html">bertos</a>      </li>
      <li class="navelem"><a class="el" href="dir_a5de7543e32a5f073daa04f8834eb5fd.html">cpu</a>      </li>
      <li class="navelem"><a class="el" href="dir_208e286f567d262698bed7c7b968aead.html">dsp56k</a>      </li>
      <li class="navelem"><a class="el" href="dir_97730e82d0f309f3fee9e0533988f46e.html">hw</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">switch_dsp56k.c</div>  </div>
</div>
<div class="contents">
<a href="switch__dsp56k_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00037"></a>00037 <span class="keywordtype">void</span> <a class="code" href="proc__p_8h.html#ae8872e2d2ceccd32f376e812fa7419a5" title="CPU dependent context switching routines.">asm_switch_context</a>(<span class="keywordtype">void</span> ** new_sp <span class="comment">/* R2 */</span>, <span class="keywordtype">void</span> ** save_sp <span class="comment">/* R3 */</span>);
<a name="l00038"></a>00038 <span class="keyword">asm</span> <span class="keywordtype">void</span> <a class="code" href="proc__p_8h.html#ae8872e2d2ceccd32f376e812fa7419a5" title="CPU dependent context switching routines.">asm_switch_context</a>(<span class="keywordtype">void</span> ** new_sp, <span class="keywordtype">void</span> ** save_sp)
<a name="l00039"></a>00039 {
<a name="l00040"></a>00040     lea   (SP)+
<a name="l00041"></a>00041 
<a name="l00042"></a>00042     ; From the manual:
<a name="l00043"></a>00043     ; The compiler uses page 0 address locations <a class="code" href="md2_8c.html#a207fd5507206d307cd63f95374fcd00d" title="Md2_perm() function generate an array of 256 &quot;casual&quot; permutation.">X</a>: 0x0030 - 0x003F as register
<a name="l00044"></a>00044     ; variables. Frequently accessed local variables are assigned to the page 0
<a name="l00045"></a>00045     ; registers instead of to stack locations so that load and store instructions
<a name="l00046"></a>00046     ; are shortened. Addresses <a class="code" href="md2_8c.html#a207fd5507206d307cd63f95374fcd00d" title="Md2_perm() function generate an array of 256 &quot;casual&quot; permutation.">X</a>: 0x0030 - 0x0037 (page 0 registers MR0-MR7) are
<a name="l00047"></a>00047     ; <span class="keyword">volatile</span> registers and can be overwritten. The remaining registers (page 0
<a name="l00048"></a>00048     ; registers MR8-MR15) are treated as non-<span class="keyword">volatile</span> and, <span class="keywordflow">if</span> used by a routine,
<a name="l00049"></a>00049     ; must be saved on entry and restored on exit.
<a name="l00050"></a>00050     ;
<a name="l00051"></a>00051     ; So, <span class="keyword">register</span> 0x30-0x37 are caller-save, <span class="keywordflow">while</span> 0x38-0x3F are callee-save.
<a name="l00052"></a>00052     move  x:&lt;$38,y1
<a name="l00053"></a>00053     move  y1,x:(SP)+
<a name="l00054"></a>00054     move  x:&lt;$39,y1
<a name="l00055"></a>00055     move  y1,x:(SP)+
<a name="l00056"></a>00056     move  x:&lt;$3A,y1
<a name="l00057"></a>00057     move  y1,x:(SP)+
<a name="l00058"></a>00058     move  x:&lt;$3B,y1
<a name="l00059"></a>00059     move  y1,x:(SP)+
<a name="l00060"></a>00060     move  x:&lt;$3C,y1
<a name="l00061"></a>00061     move  y1,x:(SP)+
<a name="l00062"></a>00062     move  x:&lt;$3D,y1
<a name="l00063"></a>00063     move  y1,x:(SP)+
<a name="l00064"></a>00064     move  x:&lt;$3E,y1
<a name="l00065"></a>00065     move  y1,x:(SP)+
<a name="l00066"></a>00066     move  x:&lt;$3F,y1
<a name="l00067"></a>00067     move  y1,x:(SP)
<a name="l00068"></a>00068 
<a name="l00069"></a>00069     ;
<a name="l00070"></a>00070     ; Switch stacks
<a name="l00071"></a>00071     nop
<a name="l00072"></a>00072     move SP, x:(R3)
<a name="l00073"></a>00073     nop
<a name="l00074"></a>00074     move x:(R2), SP
<a name="l00075"></a>00075     nop
<a name="l00076"></a>00076 
<a name="l00077"></a>00077     ;
<a name="l00078"></a>00078     ; restore all saved registers
<a name="l00079"></a>00079     ;
<a name="l00080"></a>00080     pop   y1
<a name="l00081"></a>00081     move  y1,x:&lt;$3F
<a name="l00082"></a>00082     pop   y1
<a name="l00083"></a>00083     move  y1,x:&lt;$3E
<a name="l00084"></a>00084     pop   y1
<a name="l00085"></a>00085     move  y1,x:&lt;$3D
<a name="l00086"></a>00086     pop   y1
<a name="l00087"></a>00087     move  y1,x:&lt;$3C
<a name="l00088"></a>00088     pop   y1
<a name="l00089"></a>00089     move  y1,x:&lt;$3B
<a name="l00090"></a>00090     pop   y1
<a name="l00091"></a>00091     move  y1,x:&lt;$3A
<a name="l00092"></a>00092     pop   y1
<a name="l00093"></a>00093     move  y1,x:&lt;$39
<a name="l00094"></a>00094     pop   y1
<a name="l00095"></a>00095     move  y1,x:&lt;$38
<a name="l00096"></a>00096 
<a name="l00097"></a>00097     ; SR is already pushed on the stack (normal call context). Use RTI to restore
<a name="l00098"></a>00098     ; it, so that interrupt status is preserved across the tasks.
<a name="l00099"></a>00099     rti
<a name="l00100"></a>00100 }
</pre></div></div>
</div>


