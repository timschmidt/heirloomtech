

<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a>  </div>
  <div class="headertitle">
<div class="title">Pool memory allocator</div>  </div>
<div class="ingroups"><a class="el" href="group__struct.html">Embedded optimized general purpose data types</a></div></div>
<div class="contents">

<p>Pool macros.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga7ce1fd7fb261d381d6702885eaea067d"></a><!-- doxytag: member="pool::EXTERN_POOL" ref="ga7ce1fd7fb261d381d6702885eaea067d" args="(name)" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__pool.html#ga7ce1fd7fb261d381d6702885eaea067d">EXTERN_POOL</a>(name)&#160;&#160;&#160;extern <a class="el" href="structList.html">List</a> name</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Extern pool declaration. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__pool.html#ga5f5b00a437b5138b8b096fee81d7f01c">DECLARE_POOL</a>(name, type, num)&#160;&#160;&#160;DECLARE_POOL_WITH_STORAGE(name, type, num, <a class="el" href="structList.html">List</a>)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Helper macro to declare a Pool data type.  <a href="#ga5f5b00a437b5138b8b096fee81d7f01c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__pool.html#gaebfe3041ba7c5068fe7423e3284f035d">DECLARE_POOL_STATIC</a>(name, type, num)&#160;&#160;&#160;DECLARE_POOL_WITH_STORAGE(name, type, num, static <a class="el" href="structList.html">List</a>)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Static Pool declaration.  <a href="#gaebfe3041ba7c5068fe7423e3284f035d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__pool.html#gab327ce7d9ec066e9a92443fafc22435c">pool_init</a>(name, init_func)&#160;&#160;&#160;(*(name##_init))(init_func)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize the pool <em>name</em>, calling <em>init_func</em> on each element.  <a href="#gab327ce7d9ec066e9a92443fafc22435c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__pool.html#ga09431deb3ffa490cb62fbd0a967363a7">pool_alloc</a>(name)&#160;&#160;&#160;list_remHead(name)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate an element from the pool.  <a href="#ga09431deb3ffa490cb62fbd0a967363a7"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__pool.html#ga17af1483f46acfa5396926be274f884a">pool_free</a>(name, elem)&#160;&#160;&#160;ADDHEAD(name, (<a class="el" href="structNode.html">Node</a>*)elem)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Recycle an element into the pool.  <a href="#ga17af1483f46acfa5396926be274f884a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__pool.html#gaf301a96a0e63bfbb8ea3f9e71d8f1c3a">pool_empty</a>(name)&#160;&#160;&#160;LIST_EMPTY(name)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Test if the pool is empty.  <a href="#gaf301a96a0e63bfbb8ea3f9e71d8f1c3a"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<p>Pool macros. </p>
<p>The pool module provides the boilerplate code to create a set of objects of the same type. It provides an interface similar to the heap module, with <a class="el" href="group__pool.html#ga09431deb3ffa490cb62fbd0a967363a7" title="Allocate an element from the pool.">pool_alloc()</a> and <a class="el" href="group__pool.html#ga17af1483f46acfa5396926be274f884a" title="Recycle an element into the pool.">pool_free()</a> functions that allocate and free an element respectively. In contrast with the heap module, you can specify exactly the number of items that you want to be in the pool.</p>
<p>Items in the pool must be a derived class of <code><a class="el" href="structNode.html" title="This structure represents a node for bidirectional lists.">Node</a> *</code>, which also means that they can be used as-is with list containers, eg. MsgPort.</p>
<p>Example code: </p>
<div class="fragment"><pre class="fragment"> <span class="keyword">typedef</span> <span class="keyword">struct </span>MyType
 {
     <a class="code" href="structNode.html" title="This structure represents a node for bidirectional lists.">Node</a> *n;
     uint16_t *buf;
     <span class="comment">// other members here...</span>
 } MyType;

 <a class="code" href="group__pool.html#ga5f5b00a437b5138b8b096fee81d7f01c" title="Helper macro to declare a Pool data type.">DECLARE_POOL</a>(mypool, MyType, POOL_SIZE);

 <span class="keyword">static</span> <span class="keywordtype">void</span> elem_init(MyType *e)
 {
     e-&gt;buf = NULL;
     <span class="comment">// other initializations here</span>
 }

 <span class="keywordtype">int</span> main(<span class="keywordtype">void</span>)
 {
     <a class="code" href="group__pool.html#gab327ce7d9ec066e9a92443fafc22435c" title="Initialize the pool name, calling init_func on each element.">pool_init</a>(&amp;mypool, elem_init);

     MyType *foo = <a class="code" href="group__pool.html#ga09431deb3ffa490cb62fbd0a967363a7" title="Allocate an element from the pool.">pool_alloc</a>(&amp;mypool);
     <span class="comment">// do stuff with foo</span>
     <a class="code" href="group__pool.html#ga17af1483f46acfa5396926be274f884a" title="Recycle an element into the pool.">pool_free</a>(&amp;mypool, foo);
 }
</pre></div><dl class="author"><dt><b>Author:</b></dt><dd>Giovanni Bajo &lt;<a href="mailto:rasky@develer.com">rasky@develer.com</a>&gt; </dd>
<dd>
Luca Ottaviano &lt;<a href="mailto:lottaviano@develer.com">lottaviano@develer.com</a>&gt; </dd></dl>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ga5f5b00a437b5138b8b096fee81d7f01c"></a><!-- doxytag: member="pool.h::DECLARE_POOL" ref="ga5f5b00a437b5138b8b096fee81d7f01c" args="(name, type, num)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DECLARE_POOL</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">name, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">type, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">num&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;DECLARE_POOL_WITH_STORAGE(name, type, num, <a class="el" href="structList.html">List</a>)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Helper macro to declare a Pool data type. </p>
<p>Data type inserted into the pool must be a <code><a class="el" href="structNode.html" title="This structure represents a node for bidirectional lists.">Node</a> *</code> type.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>Variable name of the pool. </td></tr>
    <tr><td class="paramname">type</td><td>Data type held by the pool. </td></tr>
    <tr><td class="paramname">num</td><td>Number of elements in pool. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pool_8h_source.html#l00117">117</a> of file <a class="el" href="pool_8h_source.html">pool.h</a>.</p>

</div>
</div>
<a class="anchor" id="gaebfe3041ba7c5068fe7423e3284f035d"></a><!-- doxytag: member="pool.h::DECLARE_POOL_STATIC" ref="gaebfe3041ba7c5068fe7423e3284f035d" args="(name, type, num)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DECLARE_POOL_STATIC</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">name, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">type, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">num&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;DECLARE_POOL_WITH_STORAGE(name, type, num, static <a class="el" href="structList.html">List</a>)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Static Pool declaration. </p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="group__pool.html#ga5f5b00a437b5138b8b096fee81d7f01c" title="Helper macro to declare a Pool data type.">DECLARE_POOL</a> </dd></dl>

<p>Definition at line <a class="el" href="pool_8h_source.html#l00125">125</a> of file <a class="el" href="pool_8h_source.html">pool.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga09431deb3ffa490cb62fbd0a967363a7"></a><!-- doxytag: member="pool.h::pool_alloc" ref="ga09431deb3ffa490cb62fbd0a967363a7" args="(name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define pool_alloc</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">name</td><td>)</td>
          <td>&#160;&#160;&#160;list_remHead(name)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Allocate an element from the pool. </p>
<p>The returned element is of type <code><a class="el" href="structNode.html" title="This structure represents a node for bidirectional lists.">Node</a> *</code>, it's safe to cast it to the type contained in the pool.</p>
<dl class="note"><dt><b>Note:</b></dt><dd>If the element was recycled with <a class="el" href="group__pool.html#ga17af1483f46acfa5396926be274f884a" title="Recycle an element into the pool.">pool_free()</a>, it will not be reset, so don't assume that the element has specific values.</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>Pointer to pool to alloc from. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>Element of the type present in the pool. </dd></dl>

<p>Definition at line <a class="el" href="pool_8h_source.html#l00154">154</a> of file <a class="el" href="pool_8h_source.html">pool.h</a>.</p>

</div>
</div>
<a class="anchor" id="gaf301a96a0e63bfbb8ea3f9e71d8f1c3a"></a><!-- doxytag: member="pool.h::pool_empty" ref="gaf301a96a0e63bfbb8ea3f9e71d8f1c3a" args="(name)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define pool_empty</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">name</td><td>)</td>
          <td>&#160;&#160;&#160;LIST_EMPTY(name)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Test if the pool is empty. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>Pointer to pool. </td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>True if the pool is empty, false otherwise. </dd></dl>

<p>Definition at line <a class="el" href="pool_8h_source.html#l00173">173</a> of file <a class="el" href="pool_8h_source.html">pool.h</a>.</p>

</div>
</div>
<a class="anchor" id="ga17af1483f46acfa5396926be274f884a"></a><!-- doxytag: member="pool.h::pool_free" ref="ga17af1483f46acfa5396926be274f884a" args="(name, elem)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define pool_free</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">name, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">elem&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;ADDHEAD(name, (<a class="el" href="structNode.html">Node</a>*)elem)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Recycle an element into the pool. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>Element fields are not reset to its original values, keep that in mind when you alloc nodes.</dd></dl>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>Pointer to pool where the node should be recycled. </td></tr>
    <tr><td class="paramname">elem</td><td>Element to be recycled. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pool_8h_source.html#l00165">165</a> of file <a class="el" href="pool_8h_source.html">pool.h</a>.</p>

</div>
</div>
<a class="anchor" id="gab327ce7d9ec066e9a92443fafc22435c"></a><!-- doxytag: member="pool.h::pool_init" ref="gab327ce7d9ec066e9a92443fafc22435c" args="(name, init_func)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define pool_init</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">name, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">init_func&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td>&#160;&#160;&#160;(*(name##_init))(init_func)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize the pool <em>name</em>, calling <em>init_func</em> on each element. </p>
<p>The init function must have the following prototype: </p>
<div class="fragment"><pre class="fragment"> <span class="keywordtype">void</span> init_func(type *)
</pre></div><p> where <em>type</em> is the type of objects held in the pool.</p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">name</td><td>Pool to initialize </td></tr>
    <tr><td class="paramname">init_func</td><td>Init function to be called on each element </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="pool_8h_source.html#l00140">140</a> of file <a class="el" href="pool_8h_source.html">pool.h</a>.</p>

</div>
</div>
</div>


