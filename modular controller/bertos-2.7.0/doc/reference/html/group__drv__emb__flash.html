

<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">Embedded flash driver</div>  </div>
<div class="ingroups"><a class="el" href="group__drivers.html">BeRTOS peripherals drivers</a></div></div>
<div class="contents">

<p>Embedded flash for cpu.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structFlash.html">Flash</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">EmbFlash <a class="el" href="structKBlock.html" title="KBlock: interface for a generic block device.">KBlock</a> context structure.  <a href="structFlash.html#details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__drv__emb__flash.html#ga4ac5b95e3a0356f065fe0bb5eb9e3d33">flash_init</a>(args...)&#160;&#160;&#160;PP_CAT(flash_init_, COUNT_PARMS(args)) (args)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Init function for flash driver.  <a href="#ga4ac5b95e3a0356f065fe0bb5eb9e3d33"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__drv__emb__flash.html#gabb169325d66922a8d2b9d8a183c3d383">flash_init_2</a>(fls, flags)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize <em>fls</em> <a class="el" href="structFlash.html" title="EmbFlash KBlock context structure.">Flash</a> context structure.  <a href="#gabb169325d66922a8d2b9d8a183c3d383"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga76c592b1b1df3ac60734d5f758fb1d43"></a><!-- doxytag: member="drv_emb_flash::FLASH_CAST" ref="ga76c592b1b1df3ac60734d5f758fb1d43" args="(KBlock *fls)" -->
<a class="el" href="structFlash.html">Flash</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__drv__emb__flash.html#ga76c592b1b1df3ac60734d5f758fb1d43">FLASH_CAST</a> (<a class="el" href="structKBlock.html">KBlock</a> *fls)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Convert + ASSERT from generic <a class="el" href="structKBlock.html" title="KBlock: interface for a generic block device.">KBlock</a> to <a class="el" href="structFlash.html" title="EmbFlash KBlock context structure.">Flash</a>. <br/></td></tr>
<tr><td colspan="2"><h2><a name="member-group"></a>
Embedded flash error values</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gacd086424caa0defa8fb0dec3973f089d"></a><!-- doxytag: member="drv_emb_flash::FLASH_WR_OK" ref="gacd086424caa0defa8fb0dec3973f089d" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__drv__emb__flash.html#gacd086424caa0defa8fb0dec3973f089d">FLASH_WR_OK</a>&#160;&#160;&#160;0</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Write ok. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga7b6753269fcc8ce2b2bc2140d07e9e95"></a><!-- doxytag: member="drv_emb_flash::FLASH_NOT_ERASED" ref="ga7b6753269fcc8ce2b2bc2140d07e9e95" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__drv__emb__flash.html#ga7b6753269fcc8ce2b2bc2140d07e9e95">FLASH_NOT_ERASED</a>&#160;&#160;&#160;BV(1)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight"><a class="el" href="structFlash.html" title="EmbFlash KBlock context structure.">Flash</a> memory was not erased before to write it. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga676edc33d7f5284351f2fb71e9dad7d4"></a><!-- doxytag: member="drv_emb_flash::FLASH_WR_PROTECT" ref="ga676edc33d7f5284351f2fb71e9dad7d4" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__drv__emb__flash.html#ga676edc33d7f5284351f2fb71e9dad7d4">FLASH_WR_PROTECT</a>&#160;&#160;&#160;BV(2)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Write not allowed the flash memory was protected. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga5c018b5750d5651e320aa2843c3bc2d4"></a><!-- doxytag: member="drv_emb_flash::FLASH_WR_TIMEOUT" ref="ga5c018b5750d5651e320aa2843c3bc2d4" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__drv__emb__flash.html#ga5c018b5750d5651e320aa2843c3bc2d4">FLASH_WR_TIMEOUT</a>&#160;&#160;&#160;BV(3)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Timeout while writing. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="gaccd303f77805f06c02df708f81814edd"></a><!-- doxytag: member="drv_emb_flash::FLASH_WR_ERR" ref="gaccd303f77805f06c02df708f81814edd" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__drv__emb__flash.html#gaccd303f77805f06c02df708f81814edd">FLASH_WR_ERR</a>&#160;&#160;&#160;BV(4)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Invalid command and/or a bad keywords. <br/></td></tr>
<tr><td colspan="2"><h2><a name="member-group"></a>
Flash init flags</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga2a73578fb80d9e92ac7f06bb1d4da14c"></a><!-- doxytag: member="drv_emb_flash::FLASH_WRITE_ONCE" ref="ga2a73578fb80d9e92ac7f06bb1d4da14c" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__drv__emb__flash.html#ga2a73578fb80d9e92ac7f06bb1d4da14c">FLASH_WRITE_ONCE</a>&#160;&#160;&#160;BV(0)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Allow only one write per block. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ga2b895ca0b6bf50ca8f9ee59dec183d82"></a><!-- doxytag: member="drv_emb_flash::FLASH_UNBUFFERED" ref="ga2b895ca0b6bf50ca8f9ee59dec183d82" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__drv__emb__flash.html#ga2b895ca0b6bf50ca8f9ee59dec183d82">FLASH_UNBUFFERED</a>&#160;&#160;&#160;BV(1)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Open flash memory disabling page caching, no modification and partial write are allowed. <br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<p>Embedded flash for cpu. </p>
<p>This module allows to access in reading and writing to the internal flash memory of the micro. It is a block device, so it must be accessed using the <a class="el" href="structKBlock.html" title="KBlock: interface for a generic block device.">KBlock</a> interface functions (see <a class="el" href="kblock_8h.html">kblock.h</a>).</p>
<p>Once you have opened the flash for writing, you may want to use <a class="el" href="group__io__kblock.html#ga0a44548c390609987086cac6a2387b99" title="Use a subset of the blocks on the device.">kblock_trim()</a> to avoid overwriting data on other flash banks.</p>
<p>Example usage: </p>
<div class="fragment"><pre class="fragment"> <a class="code" href="structFlash.html" title="EmbFlash KBlock context structure.">Flash</a> fls;
 <a class="code" href="group__drv__emb__flash.html#ga4ac5b95e3a0356f065fe0bb5eb9e3d33" title="Init function for flash driver.">flash_init</a>(&amp;fls, 0);
 <span class="comment">// enable access only on desired blocks</span>
 <span class="comment">// start block = 50, num blocks = 20</span>
 <a class="code" href="group__io__kblock.html#ga0a44548c390609987086cac6a2387b99" title="Use a subset of the blocks on the device.">kblock_trim</a>(&amp;fls.<a class="code" href="structFlash.html#adbd85a74983c749e2ddf796538ac6baa" title="KBlock context.">blk</a>, 50, 20);
 <span class="comment">// ...</span>
 <span class="comment">// now write to the flash</span>
 <span class="comment">// block number is automatically converted</span>
 <a class="code" href="group__io__kblock.html#ga069340cc7fe0a6aec2bada078ad9c889" title="Write data to the block device.">kblock_write</a>(&amp;fls.<a class="code" href="structFlash.html#adbd85a74983c749e2ddf796538ac6baa" title="KBlock context.">blk</a>, 0, buf, 0, 128);
</pre></div><dl class="author"><dt><b>Author:</b></dt><dd>Francesco Sacchi &lt;<a href="mailto:batt@develer.com">batt@develer.com</a>&gt; </dd>
<dd>
Daniele Basile &lt;<a href="mailto:asterix@develer.com">asterix@develer.com</a>&gt; </dd></dl>
<hr/><h2>Define Documentation</h2>
<a class="anchor" id="ga4ac5b95e3a0356f065fe0bb5eb9e3d33"></a><!-- doxytag: member="flash.h::flash_init" ref="ga4ac5b95e3a0356f065fe0bb5eb9e3d33" args="(args...)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define flash_init</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">args...</td><td>)</td>
          <td>&#160;&#160;&#160;PP_CAT(flash_init_, COUNT_PARMS(args)) (args)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Init function for flash driver. </p>
<p>This macro cannot fail, so no error conditions are reported.</p>
<p>This macro expands to</p>
<ul>
<li><a class="el" href="group__drv__emb__flash.html#gabb169325d66922a8d2b9d8a183c3d383" title="Initialize fls Flash context structure.">flash_init_2(Flash *fls, flags)</a>, the new <a class="el" href="structKBlock.html" title="KBlock: interface for a generic block device.">KBlock</a> API</li>
<li>flash_init_1(Flash *fls), old API, provided for compatibility</li>
</ul>
<p>Do NOT use the above functions directly, use <a class="el" href="group__drv__emb__flash.html#ga4ac5b95e3a0356f065fe0bb5eb9e3d33" title="Init function for flash driver.">flash_init()</a> instead. Disable old API if you are not upgrading an existing project. </p>

<p>Definition at line <a class="el" href="flash_8h_source.html#l00095">95</a> of file <a class="el" href="flash_8h_source.html">flash.h</a>.</p>

</div>
</div>
<a class="anchor" id="gabb169325d66922a8d2b9d8a183c3d383"></a><!-- doxytag: member="flash.h::flash_init_2" ref="gabb169325d66922a8d2b9d8a183c3d383" args="(fls, flags)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define flash_init_2</td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">fls, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname">flags&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<b>Value:</b><div class="fragment"><pre class="fragment">(flags &amp; <a class="code" href="group__drv__emb__flash.html#ga2b895ca0b6bf50ca8f9ee59dec183d82" title="Open flash memory disabling page caching, no modification and partial write are allowed.">FLASH_UNBUFFERED</a>) ? \
                                        flash_hw_initUnbuffered(fls, flags) : flash_hw_init(fls, flags)
</pre></div>
<p>Initialize <em>fls</em> <a class="el" href="structFlash.html" title="EmbFlash KBlock context structure.">Flash</a> context structure. </p>
<dl><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">fls</td><td><a class="el" href="structFlash.html" title="EmbFlash KBlock context structure.">Flash</a> context structure </td></tr>
    <tr><td class="paramname">flags</td><td>A combination of flash init flags </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="flash_8h_source.html#l00158">158</a> of file <a class="el" href="flash_8h_source.html">flash.h</a>.</p>

</div>
</div>
</div>


