

<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_9fd71c1ac00056e7d855336b2291c56c.html">bertos</a>      </li>
      <li class="navelem"><a class="el" href="dir_e91c80130e425b11d52da5b92a7aa933.html">net</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">ax25.h</div>  </div>
</div>
<div class="contents">
<a href="ax25_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00045"></a>00045 <span class="preprocessor">#ifndef NET_AX25_H</span>
<a name="l00046"></a>00046 <span class="preprocessor"></span><span class="preprocessor">#define NET_AX25_H</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span>
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="cfg__ax25_8h.html" title="Configuration file for the AX25 protocol module.">cfg/cfg_ax25.h</a>&quot;</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;<a class="code" href="compiler_8h.html" title="Additional support macros for compiler independance.">cfg/compiler.h</a>&gt;</span>
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;<a class="code" href="io_2kfile_8h.html">io/kfile.h</a>&gt;</span>
<a name="l00052"></a>00052 
<a name="l00056"></a><a class="code" href="ax25_8h.html#a4dc6bc53a35714e315e64780885500d5">00056</a> <span class="preprocessor">#define AX25_MIN_FRAME_LEN 18</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span>
<a name="l00062"></a><a class="code" href="ax25_8h.html#ae8a60e641e91e4c15b901fdefa6809cf">00062</a> <span class="preprocessor">#define AX25_CRC_CORRECT 0xF0B8</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span>
<a name="l00064"></a>00064 <span class="keyword">struct </span><a class="code" href="structAX25Msg.html" title="AX25 Message.">AX25Msg</a>; <span class="comment">// fwd declaration</span>
<a name="l00065"></a>00065 
<a name="l00069"></a><a class="code" href="ax25_8h.html#ac2f79198fd7eec52cc825dd92cec7400">00069</a> <span class="keyword">typedef</span> void (*<a class="code" href="ax25_8h.html#ac2f79198fd7eec52cc825dd92cec7400" title="Type for AX25 messages callback.">ax25_callback_t</a>)(<span class="keyword">struct </span><a class="code" href="structAX25Msg.html" title="AX25 Message.">AX25Msg</a> *msg);
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 
<a name="l00075"></a><a class="code" href="structAX25Ctx.html">00075</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structAX25Ctx.html" title="AX25 Protocol context.">AX25Ctx</a>
<a name="l00076"></a>00076 {
<a name="l00077"></a><a class="code" href="structAX25Ctx.html#ab0ba422bb687dfaaecb7bcd704cd7b5c">00077</a>     uint8_t <a class="code" href="structAX25Ctx.html#ab0ba422bb687dfaaecb7bcd704cd7b5c" title="buffer for received chars">buf</a>[<a class="code" href="cfg__ax25_8h.html#a7814a5985786c36227869bfc41932ac5" title="AX25 frame buffer lenght.">CONFIG_AX25_FRAME_BUF_LEN</a>]; 
<a name="l00078"></a><a class="code" href="structAX25Ctx.html#a9eeed7428d5f20fe2b39d5ac70b09b44">00078</a>     <a class="code" href="structKFile.html" title="Context data for callback functions which operate on pseudo files.">KFile</a> *<a class="code" href="structAX25Ctx.html#a9eeed7428d5f20fe2b39d5ac70b09b44" title="KFile used to access the physical medium.">ch</a>;        
<a name="l00079"></a><a class="code" href="structAX25Ctx.html#aaaf3150e7a61858d023c722e6fb46206">00079</a>     <span class="keywordtype">size_t</span> <a class="code" href="structAX25Ctx.html#aaaf3150e7a61858d023c722e6fb46206" title="received frame length.">frm_len</a>;   
<a name="l00080"></a><a class="code" href="structAX25Ctx.html#acba5c6c48b277cd5520a4060abac3a63">00080</a>     uint16_t <a class="code" href="structAX25Ctx.html#acba5c6c48b277cd5520a4060abac3a63" title="CRC for current received frame.">crc_in</a>;  
<a name="l00081"></a><a class="code" href="structAX25Ctx.html#aea6a6b921e34e3ed514e4598a907adf1">00081</a>     uint16_t <a class="code" href="structAX25Ctx.html#aea6a6b921e34e3ed514e4598a907adf1" title="CRC of current sent frame.">crc_out</a>; 
<a name="l00082"></a><a class="code" href="structAX25Ctx.html#aaf4149ca8e0ac15cb846f57b5a2056cd">00082</a>     <a class="code" href="ax25_8h.html#ac2f79198fd7eec52cc825dd92cec7400" title="Type for AX25 messages callback.">ax25_callback_t</a> <a class="code" href="structAX25Ctx.html#aaf4149ca8e0ac15cb846f57b5a2056cd" title="Hook function to be called when a message is received.">hook</a>; 
<a name="l00083"></a><a class="code" href="structAX25Ctx.html#a9ff9110cc05e86005aaab19c41aa3237">00083</a>     <span class="keywordtype">bool</span> <a class="code" href="structAX25Ctx.html#a9ff9110cc05e86005aaab19c41aa3237" title="True if we have received a HDLC flag.">sync</a>;   
<a name="l00084"></a><a class="code" href="structAX25Ctx.html#a2cf354b3ec66e851815667cf1ac43c06">00084</a>     <span class="keywordtype">bool</span> <a class="code" href="structAX25Ctx.html#a2cf354b3ec66e851815667cf1ac43c06" title="True when we have to escape the following char.">escape</a>; 
<a name="l00085"></a>00085 } <a class="code" href="structAX25Ctx.html" title="AX25 Protocol context.">AX25Ctx</a>;
<a name="l00086"></a>00086 
<a name="l00087"></a>00087 
<a name="l00091"></a><a class="code" href="structAX25Call.html">00091</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structAX25Call.html" title="AX25 Call sign.">AX25Call</a>
<a name="l00092"></a>00092 {
<a name="l00093"></a><a class="code" href="structAX25Call.html#a40822310cacc1cc2ca715d8475953152">00093</a>     <span class="keywordtype">char</span> <a class="code" href="structAX25Call.html#a40822310cacc1cc2ca715d8475953152" title="Call string, max 6 character.">call</a>[6]; 
<a name="l00094"></a><a class="code" href="structAX25Call.html#aab01f56f5e1cd0599dcf01f6a65b2415">00094</a>     uint8_t <a class="code" href="structAX25Call.html#aab01f56f5e1cd0599dcf01f6a65b2415" title="SSID (secondary station ID) for the call.">ssid</a>; 
<a name="l00095"></a>00095 } <a class="code" href="structAX25Call.html" title="AX25 Call sign.">AX25Call</a>;
<a name="l00096"></a>00096 
<a name="l00102"></a><a class="code" href="ax25_8h.html#a5327edd4421eb544c6ef1a6b6b57c3d5">00102</a> <span class="preprocessor">#define AX25_CALL(str, id) {.call = (str), .ssid = (id) }</span>
<a name="l00103"></a>00103 <span class="preprocessor"></span>
<a name="l00107"></a><a class="code" href="ax25_8h.html#aca2813d00ec3666b450f4de16c225d38">00107</a> <span class="preprocessor">#define AX25_MAX_RPT 8</span>
<a name="l00108"></a>00108 <span class="preprocessor"></span>
<a name="l00109"></a>00109 <span class="comment">/*</span>
<a name="l00110"></a>00110 <span class="comment"> * Has to be lesser than 8 in order to fit in one byte</span>
<a name="l00111"></a>00111 <span class="comment"> * change AX25Msg.rpt_flags if you need more repeaters.</span>
<a name="l00112"></a>00112 <span class="comment"> */</span>
<a name="l00113"></a>00113 <a class="code" href="compiler_8h.html#a695e64485eb9535f5ddcfec01167bddc" title="Issue a compilation error if the condition is false.">STATIC_ASSERT</a>(<a class="code" href="ax25_8h.html#aca2813d00ec3666b450f4de16c225d38" title="Maximum number of Repeaters in a AX25 message.">AX25_MAX_RPT</a> &lt;= 8);
<a name="l00114"></a>00114 
<a name="l00119"></a><a class="code" href="structAX25Msg.html">00119</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structAX25Msg.html" title="AX25 Message.">AX25Msg</a>
<a name="l00120"></a>00120 {
<a name="l00121"></a><a class="code" href="structAX25Msg.html#a1f0571ab6f708e1725ad9a8be8e6b28a">00121</a>     <a class="code" href="structAX25Call.html" title="AX25 Call sign.">AX25Call</a> <a class="code" href="structAX25Msg.html#a1f0571ab6f708e1725ad9a8be8e6b28a" title="Source adress.">src</a>;  
<a name="l00122"></a><a class="code" href="structAX25Msg.html#a38dc18966290b4f8cb24651e9e75ef66">00122</a>     <a class="code" href="structAX25Call.html" title="AX25 Call sign.">AX25Call</a> <a class="code" href="structAX25Msg.html#a38dc18966290b4f8cb24651e9e75ef66" title="Destination address.">dst</a>;  
<a name="l00123"></a>00123 <span class="preprocessor">    #if CONFIG_AX25_RPT_LST</span>
<a name="l00124"></a>00124 <span class="preprocessor"></span>    <a class="code" href="structAX25Call.html" title="AX25 Call sign.">AX25Call</a> rpt_lst[<a class="code" href="ax25_8h.html#aca2813d00ec3666b450f4de16c225d38" title="Maximum number of Repeaters in a AX25 message.">AX25_MAX_RPT</a>]; 
<a name="l00125"></a>00125     uint8_t rpt_cnt; 
<a name="l00126"></a>00126     uint8_t rpt_flags; 
<a name="l00127"></a>00127 <span class="preprocessor">    #define AX25_REPEATED(msg, idx) ((msg)-&gt;rpt_flags &amp; BV(idx))</span>
<a name="l00128"></a>00128 <span class="preprocessor"></span><span class="preprocessor">    #endif</span>
<a name="l00129"></a><a class="code" href="structAX25Msg.html#a375105fdcb83cb525082d8dbc22c2d33">00129</a> <span class="preprocessor"></span>    uint16_t <a class="code" href="structAX25Msg.html#a375105fdcb83cb525082d8dbc22c2d33" title="AX25 control field.">ctrl</a>; 
<a name="l00130"></a><a class="code" href="structAX25Msg.html#ae2e8532da38c1a6fac980377ab9b494b">00130</a>     uint8_t <a class="code" href="structAX25Msg.html#ae2e8532da38c1a6fac980377ab9b494b" title="AX25 PID field.">pid</a>;   
<a name="l00131"></a><a class="code" href="structAX25Msg.html#ac2aec986679b69baa42af40caf9a48bd">00131</a>     <span class="keyword">const</span> uint8_t *<a class="code" href="structAX25Msg.html#ac2aec986679b69baa42af40caf9a48bd" title="Pointer to the info field (payload) of the message.">info</a>; 
<a name="l00132"></a><a class="code" href="structAX25Msg.html#a45b0f4c6c77aec02cd647b51e0f736e1">00132</a>     <span class="keywordtype">size_t</span> <a class="code" href="structAX25Msg.html#a45b0f4c6c77aec02cd647b51e0f736e1" title="Payload length.">len</a>;    
<a name="l00133"></a>00133 } <a class="code" href="structAX25Msg.html" title="AX25 Message.">AX25Msg</a>;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135 
<a name="l00136"></a>00136 <span class="preprocessor">#define AX25_CTRL_UI      0x03</span>
<a name="l00137"></a>00137 <span class="preprocessor"></span><span class="preprocessor">#define AX25_PID_NOLAYER3 0xF0</span>
<a name="l00138"></a>00138 <span class="preprocessor"></span>
<a name="l00145"></a>00145 <span class="preprocessor">#define HDLC_FLAG  0x7E</span>
<a name="l00146"></a>00146 <span class="preprocessor"></span><span class="preprocessor">#define HDLC_RESET 0x7F</span>
<a name="l00147"></a>00147 <span class="preprocessor"></span><span class="preprocessor">#define AX25_ESC   0x1B</span>
<a name="l00148"></a>00148 <span class="preprocessor"></span><span class="comment">/* \} */</span>
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 
<a name="l00169"></a><a class="code" href="ax25_8h.html#a46f680eba52bb13a331f9821bbdccf43">00169</a> <span class="preprocessor">#define AX25_PATH(dst, src, ...) { dst, src, ## __VA_ARGS__ }</span>
<a name="l00170"></a>00170 <span class="preprocessor"></span>
<a name="l00171"></a>00171 <span class="keywordtype">void</span> <a class="code" href="ax25_8c.html#a852682ef0f0f2764ea1dbacebfa2a4e7" title="Check if there are any AX25 messages to be processed.">ax25_poll</a>(<a class="code" href="structAX25Ctx.html" title="AX25 Protocol context.">AX25Ctx</a> *ctx);
<a name="l00172"></a>00172 <span class="keywordtype">void</span> <a class="code" href="ax25_8c.html#aeb4be1c44c0faeb1fc73dbb04ac59a6e" title="Send an AX25 frame on the channel through a specific path.">ax25_sendVia</a>(<a class="code" href="structAX25Ctx.html" title="AX25 Protocol context.">AX25Ctx</a> *ctx, <span class="keyword">const</span> <a class="code" href="structAX25Call.html" title="AX25 Call sign.">AX25Call</a> *path, <span class="keywordtype">size_t</span> path_len, <span class="keyword">const</span> <span class="keywordtype">void</span> *_buf, <span class="keywordtype">size_t</span> len);
<a name="l00173"></a>00173 
<a name="l00186"></a><a class="code" href="ax25_8h.html#a239dd54aca232c9713d7cfbde19f547e">00186</a> <span class="preprocessor">#define ax25_send(ctx, dst, src, buf, len) ax25_sendVia(ctx, ({static AX25Call __path[]={dst, src}; __path;}), 2, buf, len)</span>
<a name="l00187"></a>00187 <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="ax25_8c.html#a3144cd329146fff767b284401511313f" title="Init the AX25 protocol decoder.">ax25_init</a>(<a class="code" href="structAX25Ctx.html" title="AX25 Protocol context.">AX25Ctx</a> *ctx, <a class="code" href="structKFile.html" title="Context data for callback functions which operate on pseudo files.">KFile</a> *channel, <a class="code" href="ax25_8h.html#ac2f79198fd7eec52cc825dd92cec7400" title="Type for AX25 messages callback.">ax25_callback_t</a> hook);
<a name="l00188"></a>00188 
<a name="l00189"></a>00189 <span class="keywordtype">void</span> <a class="code" href="ax25_8c.html#a90563f3e3c197ea55f024dfaf7891aeb" title="Print a AX25 message in TNC-2 packet monitor format.">ax25_print</a>(<a class="code" href="structKFile.html" title="Context data for callback functions which operate on pseudo files.">KFile</a> *ch, <span class="keyword">const</span> <a class="code" href="structAX25Msg.html" title="AX25 Message.">AX25Msg</a> *msg);
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 <span class="keywordtype">int</span> ax25_testSetup(<span class="keywordtype">void</span>);
<a name="l00192"></a>00192 <span class="keywordtype">int</span> ax25_testTearDown(<span class="keywordtype">void</span>);
<a name="l00193"></a>00193 <span class="keywordtype">int</span> ax25_testRun(<span class="keywordtype">void</span>);
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 <span class="preprocessor">#endif </span><span class="comment">/* NET_AX25_H */</span>
</pre></div></div>
</div>


