

<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_9fd71c1ac00056e7d855336b2291c56c.html">bertos</a>      </li>
      <li class="navelem"><a class="el" href="dir_f7c89dbd63e8f34e572fe939945c15d7.html">drv</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">timer.h</div>  </div>
</div>
<div class="contents">
<a href="timer_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00056"></a>00056 <span class="preprocessor">#ifndef DRV_TIMER_H</span>
<a name="l00057"></a>00057 <span class="preprocessor"></span><span class="preprocessor">#define DRV_TIMER_H</span>
<a name="l00058"></a>00058 <span class="preprocessor"></span>
<a name="l00059"></a>00059 <span class="preprocessor">#include &lt;<a class="code" href="os_8h.html" title="OS-specific definitions.">cfg/os.h</a>&gt;</span>
<a name="l00060"></a>00060 <span class="preprocessor">#include &lt;<a class="code" href="macros_8h.html">cfg/macros.h</a>&gt;</span>
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 <span class="preprocessor">#include &lt;<a class="code" href="attr_8h.html" title="CPU-specific attributes.">cpu/attr.h</a>&gt;</span>
<a name="l00063"></a>00063 <span class="preprocessor">#include &lt;<a class="code" href="cpu_2irq_8h.html" title="CPU-specific IRQ definitions.">cpu/irq.h</a>&gt;</span>
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="comment">/*</span>
<a name="l00067"></a>00067 <span class="comment"> * Include platform-specific binding header if we&#39;re hosted.</span>
<a name="l00068"></a>00068 <span class="comment"> * Try the CPU specific one for bare-metal environments.</span>
<a name="l00069"></a>00069 <span class="comment"> */</span>
<a name="l00070"></a>00070 <span class="preprocessor">#if OS_HOSTED</span>
<a name="l00071"></a>00071 <span class="preprocessor"></span>    <span class="comment">//#include OS_HEADER(timer)</span>
<a name="l00072"></a>00072 <span class="preprocessor">    #include &lt;<a class="code" href="timer__posix_8h.html" title="Low-level timer module for POSIX systems (interface).">emul/timer_posix.h</a>&gt;</span>
<a name="l00073"></a>00073 <span class="preprocessor">#else</span>
<a name="l00074"></a>00074 <span class="preprocessor"></span><span class="preprocessor">    #include CPU_HEADER(timer)</span>
<a name="l00075"></a>00075 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00076"></a>00076 <span class="preprocessor"></span>
<a name="l00077"></a>00077 <a class="code" href="compiler_8h.html#a695e64485eb9535f5ddcfec01167bddc" title="Issue a compilation error if the condition is false.">STATIC_ASSERT</a>(<span class="keyword">sizeof</span>(<a class="code" href="timer__lpc2_8h.html#a39ca00de3e892de8f389dd23dc6f1053" title="Type of time expressed in ticks of the hardware high-precision timer.">hptime_t</a>) == <a class="code" href="timer__lpc2_8h.html#a6fc725df69ff6820b40925a0f1af33e7" title="System timer on Timer0 Compare match0.">SIZEOF_HPTIME_T</a>);
<a name="l00078"></a>00078 
<a name="l00079"></a>00079 <span class="preprocessor">#include &quot;<a class="code" href="cfg__timer_8h.html" title="Configuration file for timer module.">cfg/cfg_timer.h</a>&quot;</span>
<a name="l00080"></a>00080 <span class="preprocessor">#include &lt;<a class="code" href="debug_8h.html">cfg/debug.h</a>&gt;</span>
<a name="l00081"></a>00081 <span class="preprocessor">#include &lt;<a class="code" href="compiler_8h.html" title="Additional support macros for compiler independance.">cfg/compiler.h</a>&gt;</span>
<a name="l00082"></a>00082 
<a name="l00083"></a>00083 <span class="preprocessor">#include &lt;<a class="code" href="list_8h.html">struct/list.h</a>&gt;</span>
<a name="l00084"></a>00084 
<a name="l00085"></a>00085 <span class="comment">/*</span>
<a name="l00086"></a>00086 <span class="comment"> * Sanity check for config parameters required by this module.</span>
<a name="l00087"></a>00087 <span class="comment"> */</span>
<a name="l00088"></a>00088 <span class="preprocessor">#if !defined(CONFIG_TIMER_EVENTS) || ((CONFIG_TIMER_EVENTS != 0) &amp;&amp; CONFIG_TIMER_EVENTS != 1)</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span><span class="preprocessor">    #error CONFIG_TIMER_EVENTS must be set to either 0 or 1 in cfg_timer.h</span>
<a name="l00090"></a>00090 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00091"></a>00091 <span class="preprocessor"></span><span class="preprocessor">#if !defined(CONFIG_TIMER_UDELAY) || ((CONFIG_TIMER_UDELAY != 0) &amp;&amp; CONFIG_TIMER_EVENTS != 1)</span>
<a name="l00092"></a>00092 <span class="preprocessor"></span><span class="preprocessor">    #error CONFIG_TIMER_UDELAY must be set to either 0 or 1 in cfg_timer.h</span>
<a name="l00093"></a>00093 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00094"></a>00094 <span class="preprocessor"></span><span class="preprocessor">#if defined(CONFIG_TIMER_DISABLE_UDELAY)</span>
<a name="l00095"></a>00095 <span class="preprocessor"></span><span class="preprocessor">    #error Obosolete config option CONFIG_TIMER_DISABLE_UDELAY.  Use CONFIG_TIMER_UDELAY</span>
<a name="l00096"></a>00096 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00097"></a>00097 <span class="preprocessor"></span><span class="preprocessor">#if defined(CONFIG_TIMER_DISABLE_EVENTS)</span>
<a name="l00098"></a>00098 <span class="preprocessor"></span><span class="preprocessor">    #error Obosolete config option CONFIG_TIMER_DISABLE_EVENTS.  Use CONFIG_TIMER_EVENTS</span>
<a name="l00099"></a>00099 <span class="preprocessor"></span><span class="preprocessor">#endif</span>
<a name="l00100"></a>00100 <span class="preprocessor"></span>
<a name="l00101"></a>00101 <span class="keyword">extern</span> <span class="keyword">volatile</span> <a class="code" href="compiler_8h.html#a9f2d272efa5f391ffc4b9ec4eb59fa88" title="Type for time expressed in ticks.">ticks_t</a> <a class="code" href="group__drv__timers.html#ga4b50915a13f7782dff7fb06333b1aae8" title="Master system clock (1 tick accuracy)">_clock</a>;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103 <span class="preprocessor">#define TIMER_AFTER(x, y) ((long)(y) - (long)(x) &lt; 0)</span>
<a name="l00104"></a>00104 <span class="preprocessor"></span><span class="preprocessor">#define TIMER_BEFORE(x, y) TIMER_AFTER(y, x)</span>
<a name="l00105"></a>00105 <span class="preprocessor"></span>
<a name="l00134"></a><a class="code" href="group__drv__timers.html#gadc48ccae1f609e329b7bcb153622b8c4">00134</a> INLINE <a class="code" href="compiler_8h.html#a9f2d272efa5f391ffc4b9ec4eb59fa88" title="Type for time expressed in ticks.">ticks_t</a> <a class="code" href="group__drv__timers.html#gadc48ccae1f609e329b7bcb153622b8c4" title="Return the system tick counter (expressed in ticks)">timer_clock</a>(<span class="keywordtype">void</span>)
<a name="l00135"></a>00135 {
<a name="l00136"></a>00136     <a class="code" href="compiler_8h.html#a9f2d272efa5f391ffc4b9ec4eb59fa88" title="Type for time expressed in ticks.">ticks_t</a> result;
<a name="l00137"></a>00137 
<a name="l00138"></a>00138     <a class="code" href="cpu_2irq_8h.html#a3c8f1dd0e9b40d1c40624a84a56ec8bc" title="Execute CODE atomically with respect to interrupts.">ATOMIC</a>(result = _clock);
<a name="l00139"></a>00139 
<a name="l00140"></a>00140     <span class="keywordflow">return</span> result;
<a name="l00141"></a>00141 }
<a name="l00142"></a>00142 
<a name="l00150"></a><a class="code" href="group__drv__timers.html#ga91dc8903e46f81c8490adaec8f2b5069">00150</a> INLINE <a class="code" href="compiler_8h.html#a9f2d272efa5f391ffc4b9ec4eb59fa88" title="Type for time expressed in ticks.">ticks_t</a> <a class="code" href="group__drv__timers.html#ga91dc8903e46f81c8490adaec8f2b5069" title="Faster version of timer_clock(), to be called only when the timer interrupt is disabled (DISABLE_INTS...">timer_clock_unlocked</a>(<span class="keywordtype">void</span>)
<a name="l00151"></a>00151 {
<a name="l00152"></a>00152     <span class="keywordflow">return</span> <a class="code" href="group__drv__timers.html#ga4b50915a13f7782dff7fb06333b1aae8" title="Master system clock (1 tick accuracy)">_clock</a>;
<a name="l00153"></a>00153 }
<a name="l00154"></a>00154 
<a name="l00155"></a>00155 
<a name="l00157"></a><a class="code" href="group__drv__timers.html#ga1058ec50197d9ff9483be09612022929">00157</a> INLINE <a class="code" href="compiler_8h.html#a9f2d272efa5f391ffc4b9ec4eb59fa88" title="Type for time expressed in ticks.">ticks_t</a> <a class="code" href="group__drv__timers.html#ga1058ec50197d9ff9483be09612022929" title="Convert ms [ms] to ticks.">ms_to_ticks</a>(<a class="code" href="compiler_8h.html#ac6f57181b1edf6b9b510c8a1a66201c1" title="Type for time expressed in milliseconds.">mtime_t</a> ms)
<a name="l00158"></a>00158 {
<a name="l00159"></a>00159 <span class="preprocessor">#if TIMER_TICKS_PER_SEC &lt; 1000</span>
<a name="l00160"></a>00160 <span class="preprocessor"></span>    <span class="comment">/* Slow timer: avoid rounding down too much. */</span>
<a name="l00161"></a>00161     <span class="keywordflow">return</span> (ms * <a class="code" href="timer__lpc2_8h.html#a3790164b4b6781f5988faf9c05d8eb1d" title="System timer on Timer0 Compare match0.">TIMER_TICKS_PER_SEC</a>) / 1000;
<a name="l00162"></a>00162 <span class="preprocessor">#else</span>
<a name="l00163"></a>00163 <span class="preprocessor"></span>    <span class="comment">/* Fast timer: don&#39;t overflow ticks_t. */</span>
<a name="l00164"></a>00164     <span class="keywordflow">return</span> ms * <a class="code" href="group__macros.html#ga1ddec5826f8a1f9010183107bb77c06d" title="Perform an integer division rounding the result to the nearest int value.">DIV_ROUND</a>(TIMER_TICKS_PER_SEC, 1000);
<a name="l00165"></a>00165 <span class="preprocessor">#endif</span>
<a name="l00166"></a>00166 <span class="preprocessor"></span>}
<a name="l00167"></a>00167 
<a name="l00169"></a><a class="code" href="group__drv__timers.html#gafacb3940d04dceeabb9fe405fdfc69d9">00169</a> INLINE <a class="code" href="compiler_8h.html#a9f2d272efa5f391ffc4b9ec4eb59fa88" title="Type for time expressed in ticks.">ticks_t</a> <a class="code" href="group__drv__timers.html#gafacb3940d04dceeabb9fe405fdfc69d9" title="Convert us [us] to ticks.">us_to_ticks</a>(<a class="code" href="compiler_8h.html#ac439914e9bd78be702b64d8dbc8816aa" title="Type for time expressed in microseconds.">utime_t</a> us)
<a name="l00170"></a>00170 {
<a name="l00171"></a>00171 <span class="preprocessor">#if TIMER_TICKS_PER_SEC &lt; 1000</span>
<a name="l00172"></a>00172 <span class="preprocessor"></span>    <span class="comment">/* Slow timer: avoid rounding down too much. */</span>
<a name="l00173"></a>00173     <span class="keywordflow">return</span> ((us / 1000) * <a class="code" href="timer__lpc2_8h.html#a3790164b4b6781f5988faf9c05d8eb1d" title="System timer on Timer0 Compare match0.">TIMER_TICKS_PER_SEC</a>) / 1000;
<a name="l00174"></a>00174 <span class="preprocessor">#else</span>
<a name="l00175"></a>00175 <span class="preprocessor"></span>    <span class="comment">/* Fast timer: don&#39;t overflow ticks_t. */</span>
<a name="l00176"></a>00176     <span class="keywordflow">return</span> (us * <a class="code" href="group__macros.html#ga1ddec5826f8a1f9010183107bb77c06d" title="Perform an integer division rounding the result to the nearest int value.">DIV_ROUND</a>(<a class="code" href="timer__lpc2_8h.html#a3790164b4b6781f5988faf9c05d8eb1d" title="System timer on Timer0 Compare match0.">TIMER_TICKS_PER_SEC</a>, 1000)) / 1000;
<a name="l00177"></a>00177 <span class="preprocessor">#endif</span>
<a name="l00178"></a>00178 <span class="preprocessor"></span>}
<a name="l00179"></a>00179 
<a name="l00181"></a><a class="code" href="group__drv__timers.html#gadf5cdcf8fd13e7b4c55a4050de5e603c">00181</a> INLINE <a class="code" href="compiler_8h.html#ac6f57181b1edf6b9b510c8a1a66201c1" title="Type for time expressed in milliseconds.">mtime_t</a> <a class="code" href="group__drv__timers.html#gadf5cdcf8fd13e7b4c55a4050de5e603c" title="Convert ticks [ticks] to ms.">ticks_to_ms</a>(<a class="code" href="compiler_8h.html#a9f2d272efa5f391ffc4b9ec4eb59fa88" title="Type for time expressed in ticks.">ticks_t</a> ticks)
<a name="l00182"></a>00182 {
<a name="l00183"></a>00183 <span class="preprocessor">#if TIMER_TICKS_PER_SEC &lt; 1000</span>
<a name="l00184"></a>00184 <span class="preprocessor"></span>    <span class="comment">/* Slow timer: avoid rounding down too much. */</span>
<a name="l00185"></a>00185     <span class="keywordflow">return</span> (ticks * 1000) / <a class="code" href="timer__lpc2_8h.html#a3790164b4b6781f5988faf9c05d8eb1d" title="System timer on Timer0 Compare match0.">TIMER_TICKS_PER_SEC</a>;
<a name="l00186"></a>00186 <span class="preprocessor">#else</span>
<a name="l00187"></a>00187 <span class="preprocessor"></span>    <span class="comment">/* Fast timer: avoid overflowing ticks_t. */</span>
<a name="l00188"></a>00188     <span class="keywordflow">return</span> ticks / (<a class="code" href="timer__lpc2_8h.html#a3790164b4b6781f5988faf9c05d8eb1d" title="System timer on Timer0 Compare match0.">TIMER_TICKS_PER_SEC</a> / 1000);
<a name="l00189"></a>00189 <span class="preprocessor">#endif</span>
<a name="l00190"></a>00190 <span class="preprocessor"></span>}
<a name="l00191"></a>00191 
<a name="l00193"></a><a class="code" href="group__drv__timers.html#ga4e220e6a96836ebf697dd5a09181f69f">00193</a> INLINE <a class="code" href="compiler_8h.html#ac439914e9bd78be702b64d8dbc8816aa" title="Type for time expressed in microseconds.">utime_t</a> <a class="code" href="group__drv__timers.html#ga4e220e6a96836ebf697dd5a09181f69f" title="Convert ticks [ticks] to us.">ticks_to_us</a>(<a class="code" href="compiler_8h.html#a9f2d272efa5f391ffc4b9ec4eb59fa88" title="Type for time expressed in ticks.">ticks_t</a> ticks)
<a name="l00194"></a>00194 {
<a name="l00195"></a>00195 <span class="preprocessor">#if TIMER_TICKS_PER_SEC &lt; 1000</span>
<a name="l00196"></a>00196 <span class="preprocessor"></span>    <span class="comment">/* Slow timer: avoid rounding down too much. */</span>
<a name="l00197"></a>00197     <span class="keywordflow">return</span> ((ticks * 1000) / <a class="code" href="timer__lpc2_8h.html#a3790164b4b6781f5988faf9c05d8eb1d" title="System timer on Timer0 Compare match0.">TIMER_TICKS_PER_SEC</a>) * 1000;
<a name="l00198"></a>00198 <span class="preprocessor">#else</span>
<a name="l00199"></a>00199 <span class="preprocessor"></span>    <span class="comment">/* Fast timer: avoid overflowing ticks_t. */</span>
<a name="l00200"></a>00200     <span class="keywordflow">return</span> (ticks / (<a class="code" href="timer__lpc2_8h.html#a3790164b4b6781f5988faf9c05d8eb1d" title="System timer on Timer0 Compare match0.">TIMER_TICKS_PER_SEC</a> / 1000)) * 1000;
<a name="l00201"></a>00201 <span class="preprocessor">#endif</span>
<a name="l00202"></a>00202 <span class="preprocessor"></span>}
<a name="l00203"></a>00203 
<a name="l00205"></a><a class="code" href="group__drv__timers.html#ga70225249121c80ec37dd84f1ad3c3aeb">00205</a> INLINE <a class="code" href="timer__lpc2_8h.html#a39ca00de3e892de8f389dd23dc6f1053" title="Type of time expressed in ticks of the hardware high-precision timer.">hptime_t</a> <a class="code" href="group__drv__timers.html#ga70225249121c80ec37dd84f1ad3c3aeb" title="Convert us [us] to hpticks.">us_to_hptime</a>(<a class="code" href="compiler_8h.html#ac439914e9bd78be702b64d8dbc8816aa" title="Type for time expressed in microseconds.">utime_t</a> us)
<a name="l00206"></a>00206 {
<a name="l00207"></a>00207 <span class="preprocessor">#if TIMER_HW_HPTICKS_PER_SEC &gt; 10000000UL</span>
<a name="l00208"></a>00208 <span class="preprocessor"></span>    <span class="keywordflow">return</span> us * <a class="code" href="group__macros.html#ga1ddec5826f8a1f9010183107bb77c06d" title="Perform an integer division rounding the result to the nearest int value.">DIV_ROUND</a>(<a class="code" href="timer__lpc2_8h.html#a2c065265476718db0664beeb655884c9" title="Frequency of the hardware high-precision timer.">TIMER_HW_HPTICKS_PER_SEC</a>, 1000000UL);
<a name="l00209"></a>00209 <span class="preprocessor">#else</span>
<a name="l00210"></a>00210 <span class="preprocessor"></span>    <span class="keywordflow">return</span> (us * ((<a class="code" href="timer__lpc2_8h.html#a2c065265476718db0664beeb655884c9" title="Frequency of the hardware high-precision timer.">TIMER_HW_HPTICKS_PER_SEC</a> + 500) / 1000UL) + 500) / 1000UL;
<a name="l00211"></a>00211 <span class="preprocessor">#endif</span>
<a name="l00212"></a>00212 <span class="preprocessor"></span>}
<a name="l00213"></a>00213 
<a name="l00215"></a><a class="code" href="group__drv__timers.html#gaf9a389338d010ad77bf863d4fcef26d4">00215</a> INLINE <a class="code" href="compiler_8h.html#ac439914e9bd78be702b64d8dbc8816aa" title="Type for time expressed in microseconds.">utime_t</a> <a class="code" href="group__drv__timers.html#gaf9a389338d010ad77bf863d4fcef26d4" title="Convert hpticks [hptime] to usec.">hptime_to_us</a>(<a class="code" href="timer__lpc2_8h.html#a39ca00de3e892de8f389dd23dc6f1053" title="Type of time expressed in ticks of the hardware high-precision timer.">hptime_t</a> hpticks)
<a name="l00216"></a>00216 {
<a name="l00217"></a>00217 <span class="preprocessor">#if TIMER_HW_HPTICKS_PER_SEC &lt; 100000UL</span>
<a name="l00218"></a>00218 <span class="preprocessor"></span>    <span class="keywordflow">return</span> hpticks * <a class="code" href="group__macros.html#ga1ddec5826f8a1f9010183107bb77c06d" title="Perform an integer division rounding the result to the nearest int value.">DIV_ROUND</a>(1000000UL, <a class="code" href="timer__lpc2_8h.html#a2c065265476718db0664beeb655884c9" title="Frequency of the hardware high-precision timer.">TIMER_HW_HPTICKS_PER_SEC</a>);
<a name="l00219"></a>00219 <span class="preprocessor">#else</span>
<a name="l00220"></a>00220 <span class="preprocessor"></span>    <span class="keywordflow">return</span> (hpticks * 1000UL) / <a class="code" href="group__macros.html#ga1ddec5826f8a1f9010183107bb77c06d" title="Perform an integer division rounding the result to the nearest int value.">DIV_ROUND</a>(<a class="code" href="timer__lpc2_8h.html#a2c065265476718db0664beeb655884c9" title="Frequency of the hardware high-precision timer.">TIMER_HW_HPTICKS_PER_SEC</a>, 1000UL);
<a name="l00221"></a>00221 <span class="preprocessor">#endif </span><span class="comment">/* TIMER_HW_HPTICKS_PER_SEC &lt; 100000UL */</span>
<a name="l00222"></a>00222 }
<a name="l00223"></a>00223 
<a name="l00224"></a>00224 <span class="keywordtype">void</span> <a class="code" href="group__drv__timers.html#gac497fa7bd2e2ee77b4dcf765b1e24894" title="Wait for the specified amount of timer ticks.">timer_delayTicks</a>(<a class="code" href="compiler_8h.html#a9f2d272efa5f391ffc4b9ec4eb59fa88" title="Type for time expressed in ticks.">ticks_t</a> delay);
<a name="l00231"></a><a class="code" href="group__drv__timers.html#gace6fb3d382bd740f9cee1b139e12f7a6">00231</a> INLINE <span class="keywordtype">void</span> <a class="code" href="group__drv__timers.html#gace6fb3d382bd740f9cee1b139e12f7a6" title="Wait some time [ms].">timer_delay</a>(<a class="code" href="compiler_8h.html#ac6f57181b1edf6b9b510c8a1a66201c1" title="Type for time expressed in milliseconds.">mtime_t</a> delay)
<a name="l00232"></a>00232 {
<a name="l00233"></a>00233     <a class="code" href="group__drv__timers.html#gac497fa7bd2e2ee77b4dcf765b1e24894" title="Wait for the specified amount of timer ticks.">timer_delayTicks</a>(<a class="code" href="group__drv__timers.html#ga1058ec50197d9ff9483be09612022929" title="Convert ms [ms] to ticks.">ms_to_ticks</a>(delay));
<a name="l00234"></a>00234 }
<a name="l00235"></a>00235 
<a name="l00236"></a>00236 <span class="keywordtype">void</span> timer_init(<span class="keywordtype">void</span>);
<a name="l00237"></a>00237 <span class="keywordtype">void</span> timer_cleanup(<span class="keywordtype">void</span>);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239 <span class="keywordtype">int</span> timer_testSetup(<span class="keywordtype">void</span>);
<a name="l00240"></a>00240 <span class="keywordtype">int</span> timer_testRun(<span class="keywordtype">void</span>);
<a name="l00241"></a>00241 <span class="keywordtype">int</span> timer_testTearDown(<span class="keywordtype">void</span>);
<a name="l00242"></a>00242 
<a name="l00243"></a>00243 <span class="preprocessor">#if CONFIG_TIMER_UDELAY</span>
<a name="l00244"></a>00244 <span class="preprocessor"></span><span class="keywordtype">void</span> <a class="code" href="group__drv__timers.html#ga1243060e36ef4739b9d5cc50e8e4f27a" title="Busy wait until the specified amount of high-precision ticks have elapsed.">timer_busyWait</a>(<a class="code" href="timer__lpc2_8h.html#a39ca00de3e892de8f389dd23dc6f1053" title="Type of time expressed in ticks of the hardware high-precision timer.">hptime_t</a> delay);
<a name="l00245"></a>00245 <span class="keywordtype">void</span> <a class="code" href="group__drv__timers.html#ga3407c46c6b439217c694ed4372336330" title="Wait for the specified amount of time (expressed in microseconds).">timer_delayHp</a>(<a class="code" href="timer__lpc2_8h.html#a39ca00de3e892de8f389dd23dc6f1053" title="Type of time expressed in ticks of the hardware high-precision timer.">hptime_t</a> delay);
<a name="l00246"></a>00246 INLINE <span class="keywordtype">void</span> timer_udelay(<a class="code" href="compiler_8h.html#ac439914e9bd78be702b64d8dbc8816aa" title="Type for time expressed in microseconds.">utime_t</a> delay)
<a name="l00247"></a>00247 {
<a name="l00248"></a>00248     <a class="code" href="group__drv__timers.html#ga3407c46c6b439217c694ed4372336330" title="Wait for the specified amount of time (expressed in microseconds).">timer_delayHp</a>(<a class="code" href="group__drv__timers.html#ga70225249121c80ec37dd84f1ad3c3aeb" title="Convert us [us] to hpticks.">us_to_hptime</a>(delay));
<a name="l00249"></a>00249 }
<a name="l00250"></a>00250 <span class="preprocessor">#endif</span>
<a name="l00251"></a>00251 <span class="preprocessor"></span>
<a name="l00252"></a>00252 <span class="preprocessor">#if CONFIG_TIMER_EVENTS</span>
<a name="l00253"></a>00253 <span class="preprocessor"></span>
<a name="l00254"></a>00254 <span class="preprocessor">#include &lt;<a class="code" href="event_8h.html">mware/event.h</a>&gt;</span>
<a name="l00255"></a>00255 
<a name="l00263"></a><a class="code" href="structTimer.html">00263</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structTimer.html" title="The timer driver supports multiple synchronous timers that can trigger an event when they expire...">Timer</a>
<a name="l00264"></a>00264 {
<a name="l00265"></a><a class="code" href="structTimer.html#acb9df85e1dc3de275a953dbf91f1656f">00265</a>     <a class="code" href="structNode.html" title="This structure represents a node for bidirectional lists.">Node</a>    <a class="code" href="structTimer.html#acb9df85e1dc3de275a953dbf91f1656f" title="Link into timers queue.">link</a>;     
<a name="l00266"></a><a class="code" href="structTimer.html#ac0125011e860a00e3d9b7528d16586d4">00266</a>     <a class="code" href="compiler_8h.html#a9f2d272efa5f391ffc4b9ec4eb59fa88" title="Type for time expressed in ticks.">ticks_t</a> <a class="code" href="structTimer.html#ac0125011e860a00e3d9b7528d16586d4" title="[ticks] Timer delay">_delay</a>;   
<a name="l00267"></a><a class="code" href="structTimer.html#a9324555c9303c9a3fa71d8c3b7a5ebd2">00267</a>     <a class="code" href="compiler_8h.html#a9f2d272efa5f391ffc4b9ec4eb59fa88" title="Type for time expressed in ticks.">ticks_t</a> <a class="code" href="structTimer.html#a9324555c9303c9a3fa71d8c3b7a5ebd2" title="[ticks] When this timer will expire">tick</a>;     
<a name="l00268"></a><a class="code" href="structTimer.html#aa45b37c9431d05dd4812bfb32a6cfa5d">00268</a>     Event   <a class="code" href="structTimer.html#aa45b37c9431d05dd4812bfb32a6cfa5d" title="Event to execute when the timer expires.">expire</a>;   
<a name="l00269"></a>00269     <a class="code" href="group__debug.html#ga5ae59b9945c3ef623af1719976ef3a1f" title="This macro can be used to conditionally exclude one or more statements conditioned on _DEBUG...">DB</a>(uint16_t magic;)
<a name="l00270"></a>00270 } <a class="code" href="structTimer.html" title="The timer driver supports multiple synchronous timers that can trigger an event when they expire...">Timer</a>;
<a name="l00271"></a>00271 
<a name="l00272"></a>00272 <span class="comment">/* Timer is active when Timer.magic contains this value (for debugging purposes). */</span>
<a name="l00273"></a>00273 <span class="preprocessor">#define TIMER_MAGIC_ACTIVE    0xABBA</span>
<a name="l00274"></a>00274 <span class="preprocessor"></span><span class="preprocessor">#define TIMER_MAGIC_INACTIVE  0xBAAB</span>
<a name="l00275"></a>00275 <span class="preprocessor"></span>
<a name="l00276"></a>00276 <span class="keywordtype">void</span> <a class="code" href="group__drv__timers.html#ga31b280936e453dff724b326c0309af4c" title="Add the specified timer to the software timer service queue.">timer_add</a>(<a class="code" href="structTimer.html" title="The timer driver supports multiple synchronous timers that can trigger an event when they expire...">Timer</a> *timer);
<a name="l00277"></a>00277 <a class="code" href="structTimer.html" title="The timer driver supports multiple synchronous timers that can trigger an event when they expire...">Timer</a> *<a class="code" href="group__drv__timers.html#ga083b16dd889741b74ca1142fd6498ae9" title="Remove a timer from the timers queue before it has expired.">timer_abort</a>(<a class="code" href="structTimer.html" title="The timer driver supports multiple synchronous timers that can trigger an event when they expire...">Timer</a> *timer);
<a name="l00278"></a>00278 
<a name="l00289"></a><a class="code" href="group__drv__timers.html#ga05183713aaa5b341bcda25af3837a111">00289</a> INLINE <span class="keywordtype">void</span> <a class="code" href="group__drv__timers.html#ga05183713aaa5b341bcda25af3837a111" title="Set the timer so that it calls an user hook when it expires.">timer_setSoftint</a>(<a class="code" href="structTimer.html" title="The timer driver supports multiple synchronous timers that can trigger an event when they expire...">Timer</a> *timer, <a class="code" href="compiler_8h.html#a29da6a2c5167c69f4e05da8466f2b339" title="User defined callback type.">Hook</a> func, <a class="code" href="compiler_8h.html#afebdfc027148249641ae51fb8c7914fc" title="Bulk storage large enough for both pointers or integers.">iptr_t</a> user_data)
<a name="l00290"></a>00290 {
<a name="l00291"></a>00291     <a class="code" href="group__event__handling.html#gaca50ea4a82621e6c3e4d8c4d7627dcdf" title="Initialize the event e with a software interrupt (call function f, with parameter u)...">event_initSoftint</a>(&amp;timer-&gt;<a class="code" href="structTimer.html#aa45b37c9431d05dd4812bfb32a6cfa5d" title="Event to execute when the timer expires.">expire</a>, func, user_data);
<a name="l00292"></a>00292 }
<a name="l00293"></a>00293 
<a name="l00300"></a><a class="code" href="group__drv__timers.html#ga74311fd08b3bfdecb496f16b7465715b">00300</a> INLINE <span class="keywordtype">void</span> <a class="code" href="group__drv__timers.html#ga74311fd08b3bfdecb496f16b7465715b" title="Set the timer delay (the time before the event will be triggered)">timer_setDelay</a>(<a class="code" href="structTimer.html" title="The timer driver supports multiple synchronous timers that can trigger an event when they expire...">Timer</a> *timer, <a class="code" href="compiler_8h.html#a9f2d272efa5f391ffc4b9ec4eb59fa88" title="Type for time expressed in ticks.">ticks_t</a> delay)
<a name="l00301"></a>00301 {
<a name="l00302"></a>00302     timer-&gt;<a class="code" href="structTimer.html#ac0125011e860a00e3d9b7528d16586d4" title="[ticks] Timer delay">_delay</a> = delay;
<a name="l00303"></a>00303 }
<a name="l00304"></a>00304 
<a name="l00305"></a>00305 
<a name="l00306"></a>00306 <span class="keywordtype">void</span> <a class="code" href="group__drv__timers.html#gaceda10d0921ceb0e991744fd6760b454" title="Add timer to queue.">synctimer_add</a>(<a class="code" href="structTimer.html" title="The timer driver supports multiple synchronous timers that can trigger an event when they expire...">Timer</a> *timer, <a class="code" href="structList.html" title="Head of a doubly-linked list of Node structs.">List</a>* q);
<a name="l00307"></a>00307 
<a name="l00309"></a><a class="code" href="group__drv__timers.html#ga40ea9215551098e4d4e1f58cc687e69b">00309</a> <span class="preprocessor">#define synctimer_abort(t) timer_abort(t)</span>
<a name="l00310"></a>00310 <span class="preprocessor"></span>
<a name="l00311"></a>00311 <span class="keywordtype">void</span> <a class="code" href="group__drv__timers.html#ga8ef6c10d089728296204e5e03cf39863" title="Simple synchronous timer based scheduler polling routine.">synctimer_poll</a>(<a class="code" href="structList.html" title="Head of a doubly-linked list of Node structs.">List</a>* q);
<a name="l00312"></a>00312 
<a name="l00313"></a>00313 
<a name="l00314"></a>00314 <span class="preprocessor">#endif </span><span class="comment">/* CONFIG_TIMER_EVENTS */</span>
<a name="l00315"></a>00315 
<a name="l00316"></a>00316 <span class="preprocessor">#if defined(CONFIG_KERN_SIGNALS) &amp;&amp; CONFIG_KERN_SIGNALS</span>
<a name="l00317"></a>00317 <span class="preprocessor"></span>
<a name="l00319"></a><a class="code" href="group__drv__timers.html#gab0b325030f6245240487f9ff4e885f88">00319</a> INLINE <span class="keywordtype">void</span> <a class="code" href="group__drv__timers.html#gab0b325030f6245240487f9ff4e885f88" title="Set the timer so that it sends a event notification when it expires.">timer_setEvent</a>(<a class="code" href="structTimer.html" title="The timer driver supports multiple synchronous timers that can trigger an event when they expire...">Timer</a> *timer)
<a name="l00320"></a>00320 {
<a name="l00321"></a>00321     event_initGeneric(&amp;timer-&gt;<a class="code" href="structTimer.html#aa45b37c9431d05dd4812bfb32a6cfa5d" title="Event to execute when the timer expires.">expire</a>);
<a name="l00322"></a>00322 }
<a name="l00323"></a>00323 
<a name="l00325"></a><a class="code" href="group__drv__timers.html#ga9265c1b69b3c4fcd509e227b56bc3e45">00325</a> INLINE <span class="keywordtype">void</span> <a class="code" href="group__drv__timers.html#ga9265c1b69b3c4fcd509e227b56bc3e45" title="Wait until the timer expires.">timer_waitEvent</a>(<a class="code" href="structTimer.html" title="The timer driver supports multiple synchronous timers that can trigger an event when they expire...">Timer</a> *timer)
<a name="l00326"></a>00326 {
<a name="l00327"></a>00327     <a class="code" href="group__event__handling.html#ga2dc29c321fb1c8e61ee67e64d85ad256" title="Wait the completion of event e.">event_wait</a>(&amp;timer-&gt;<a class="code" href="structTimer.html#aa45b37c9431d05dd4812bfb32a6cfa5d" title="Event to execute when the timer expires.">expire</a>);
<a name="l00328"></a>00328 }
<a name="l00329"></a>00329 
<a name="l00331"></a><a class="code" href="group__drv__timers.html#gaa68dbdace6460cd22586a63f6da31290">00331</a> INLINE <span class="keywordtype">void</span> <a class="code" href="group__drv__timers.html#gaa68dbdace6460cd22586a63f6da31290" title="Set the timer so that it sends a signal when it expires.">timer_setSignal</a>(<a class="code" href="structTimer.html" title="The timer driver supports multiple synchronous timers that can trigger an event when they expire...">Timer</a> *timer, <span class="keyword">struct</span> Process *proc, <a class="code" href="compiler_8h.html#a8eab9d9d79ff58f19a5a51e821d95330" title="Type for signal masks.">sigmask_t</a> sigs)
<a name="l00332"></a>00332 {
<a name="l00333"></a>00333     event_initSignal(&amp;timer-&gt;<a class="code" href="structTimer.html#aa45b37c9431d05dd4812bfb32a6cfa5d" title="Event to execute when the timer expires.">expire</a>, proc, sigs);
<a name="l00334"></a>00334 }
<a name="l00335"></a>00335 
<a name="l00336"></a>00336 <span class="preprocessor">#define timer_set_event_signal timer_setSignal</span>
<a name="l00337"></a>00337 <span class="preprocessor"></span>
<a name="l00338"></a>00338 <span class="preprocessor">#endif </span><span class="comment">/* CONFIG_KERN_SIGNALS */</span>
<a name="l00339"></a>00339  <span class="comment">//defgroup drv_timers</span>
<a name="l00341"></a>00341 
<a name="l00342"></a>00342 <span class="preprocessor">#endif </span><span class="comment">/* DRV_TIMER_H */</span>
</pre></div></div>
</div>


