

<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_9fd71c1ac00056e7d855336b2291c56c.html">bertos</a>      </li>
      <li class="navelem"><a class="el" href="dir_f7c89dbd63e8f34e572fe939945c15d7.html">drv</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">led_7seg.c</div>  </div>
</div>
<div class="contents">
<a href="led__7seg_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00041"></a>00041 <span class="preprocessor">#include &quot;<a class="code" href="led__7seg_8h.html">drv/led_7seg.h</a>&quot;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &quot;<a class="code" href="hw__led__7seg_8h.html" title="led 7 segment display low-level">hw/hw_led_7seg.h</a>&quot;</span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="cfg__arch_8h.html" title="Set system configuration.">cfg/cfg_arch.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;<a class="code" href="timer_8h.html">drv/timer.h</a>&gt;</span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &lt;string.h&gt;</span>
<a name="l00046"></a>00046 
<a name="l00047"></a>00047 <span class="comment">/*</span>
<a name="l00048"></a>00048 <span class="comment"> * Define the timer for the refreshing</span>
<a name="l00049"></a>00049 <span class="comment"> */</span>
<a name="l00050"></a>00050 <span class="keyword">static</span> <a class="code" href="structTimer.html" title="The timer driver supports multiple synchronous timers that can trigger an event when they expire...">Timer</a> sseg_trefresh;
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="comment">/*</span>
<a name="l00053"></a>00053 <span class="comment"> * FUNCTION: sseg_refresh</span>
<a name="l00054"></a>00054 <span class="comment"> *</span>
<a name="l00055"></a>00055 <span class="comment"> * This is the procedure that prints the seven_seg structure&#39;string to the display.</span>
<a name="l00056"></a>00056 <span class="comment"> * It prints a single digit at time and does all the checks to a proper display.</span>
<a name="l00057"></a>00057 <span class="comment"> * It is called by the wrapper function fired by the timer set in the init procedure.</span>
<a name="l00058"></a>00058 <span class="comment"> * </span>
<a name="l00059"></a>00059 <span class="comment"> * param SS The void pointer that holds the pointer to the data structure</span>
<a name="l00060"></a>00060 <span class="comment"> *</span>
<a name="l00061"></a>00061 <span class="comment"> */</span>
<a name="l00062"></a>00062 <span class="keyword">static</span> <span class="keywordtype">void</span> sseg_refresh(<a class="code" href="structSevenSeg.html" title="Context data for Display functions.">SevenSeg</a> *SS)
<a name="l00063"></a>00063 {
<a name="l00064"></a>00064     <span class="comment">/* First Check if the structure is being edited we do a silent exit*/</span>
<a name="l00065"></a>00065     <span class="keywordflow">if</span> (SS-&gt;<a class="code" href="structSevenSeg.html#ad8050be682a2f28d9260165437143832" title="Is the structure in edit?">busyedit</a> == <span class="keyword">true</span>)
<a name="l00066"></a>00066         <span class="keywordflow">return</span>;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068     <span class="comment">/* If we have displayed all the digits */</span>
<a name="l00069"></a>00069     <span class="keywordflow">if</span> (SS-&gt;<a class="code" href="structSevenSeg.html#ae599485da1d3c9d746838ea275dfc1fe" title="Working current digit.">curdigit</a> == <a class="code" href="group__SevenSegDisplay.html#gaf157c1b0f5897e3552ba92859984c2c2" title="Number of digit present in the LED display.">CONFIG_LED_7SEG_DIGIT</a>)
<a name="l00070"></a>00070     {
<a name="l00071"></a>00071         <a class="code" href="hw__led__7seg_8h.html#aa7330e563e67c2bc7215a2493a9bb4f2" title="Clean the display.">sseg_off</a>();
<a name="l00072"></a>00072         <span class="comment">/* And if we have to display again all the digit */</span>
<a name="l00073"></a>00073         <span class="keywordflow">if</span> (SS-&gt;<a class="code" href="structSevenSeg.html#a4769182c92e04dd81c57a64ffe6e3408" title="Working scrolling speed.">curspeed</a> &gt; 0)
<a name="l00074"></a>00074         {
<a name="l00075"></a>00075             SS-&gt;<a class="code" href="structSevenSeg.html#a4769182c92e04dd81c57a64ffe6e3408" title="Working scrolling speed.">curspeed</a>--;
<a name="l00076"></a>00076             SS-&gt;<a class="code" href="structSevenSeg.html#ae599485da1d3c9d746838ea275dfc1fe" title="Working current digit.">curdigit</a> = 0;
<a name="l00077"></a>00077             SS-&gt;<a class="code" href="structSevenSeg.html#aef677238dc31002c2dce0addd4b5f056" title="Working current position.">curpos</a> -= <a class="code" href="group__SevenSegDisplay.html#gaf157c1b0f5897e3552ba92859984c2c2" title="Number of digit present in the LED display.">CONFIG_LED_7SEG_DIGIT</a>;
<a name="l00078"></a>00078         }
<a name="l00079"></a>00079         <span class="comment">/* Else is time to scroll the text */</span>
<a name="l00080"></a>00080         <span class="keywordflow">else</span>
<a name="l00081"></a>00081         {
<a name="l00082"></a>00082             <span class="comment">/* If we aren&#39;t at the end of the string */</span>
<a name="l00083"></a>00083             <span class="keywordflow">if</span> (SS-&gt;<a class="code" href="structSevenSeg.html#aef677238dc31002c2dce0addd4b5f056" title="Working current position.">curpos</a> &lt; SS-&gt;<a class="code" href="structSevenSeg.html#ac96f863120bdae5081ee236839db20a0" title="The length of the string to be displayed.">string_len</a>)
<a name="l00084"></a>00084             {
<a name="l00085"></a>00085                 SS-&gt;<a class="code" href="structSevenSeg.html#aef677238dc31002c2dce0addd4b5f056" title="Working current position.">curpos</a> -= <a class="code" href="group__SevenSegDisplay.html#gaf157c1b0f5897e3552ba92859984c2c2" title="Number of digit present in the LED display.">CONFIG_LED_7SEG_DIGIT</a>;
<a name="l00086"></a>00086                 SS-&gt;<a class="code" href="structSevenSeg.html#aef677238dc31002c2dce0addd4b5f056" title="Working current position.">curpos</a>++;
<a name="l00087"></a>00087                 SS-&gt;<a class="code" href="structSevenSeg.html#ae599485da1d3c9d746838ea275dfc1fe" title="Working current digit.">curdigit</a> = 0;
<a name="l00088"></a>00088                 SS-&gt;<a class="code" href="structSevenSeg.html#a4769182c92e04dd81c57a64ffe6e3408" title="Working scrolling speed.">curspeed</a> = SS-&gt;<a class="code" href="structSevenSeg.html#af205235c7d82d5e663aae2572bf3e699" title="Scrolling speed.">speed</a>;
<a name="l00089"></a>00089             }
<a name="l00090"></a>00090             <span class="comment">/* Else we are at the end of the string */</span>
<a name="l00091"></a>00091             <span class="keywordflow">else</span>
<a name="l00092"></a>00092             {
<a name="l00093"></a>00093                 <span class="comment">/* Set that the string was displayed at least one time and we can accept a new text*/</span>
<a name="l00094"></a>00094                 SS-&gt;<a class="code" href="structSevenSeg.html#a52d8dcc2120c8546478e576109232053" title="Is it printed at least one time?">firstrun</a> = <span class="keyword">false</span>;
<a name="l00095"></a>00095                 <span class="comment">/* If the string has to be displayed only one time we set an empty string</span>
<a name="l00096"></a>00096 <span class="comment">                 * to display till next print request*/</span>
<a name="l00097"></a>00097                 <span class="keywordflow">if</span> (SS-&gt;<a class="code" href="structSevenSeg.html#a3d3986f18dbc16cc3589477f5a97dad0" title="Has to be displayed only one time?">runonce</a> == <span class="keyword">true</span>)
<a name="l00098"></a>00098                     <a class="code" href="group__SevenSegDisplay.html#gae1efd17019b365c64e4c1b3a8425d347" title="clear the display">sevenseg_clear</a>(SS);
<a name="l00099"></a>00099                 <span class="comment">/* Else we reset the text to it&#39;s first character ad do again the display */</span>
<a name="l00100"></a>00100                 <span class="keywordflow">else</span>
<a name="l00101"></a>00101                 {
<a name="l00102"></a>00102                     SS-&gt;<a class="code" href="structSevenSeg.html#ae599485da1d3c9d746838ea275dfc1fe" title="Working current digit.">curdigit</a> = 0;
<a name="l00103"></a>00103                     SS-&gt;<a class="code" href="structSevenSeg.html#aef677238dc31002c2dce0addd4b5f056" title="Working current position.">curpos</a> = 0;
<a name="l00104"></a>00104                     SS-&gt;<a class="code" href="structSevenSeg.html#a4769182c92e04dd81c57a64ffe6e3408" title="Working scrolling speed.">curspeed</a> = SS-&gt;<a class="code" href="structSevenSeg.html#af205235c7d82d5e663aae2572bf3e699" title="Scrolling speed.">speed</a>;
<a name="l00105"></a>00105                 }
<a name="l00106"></a>00106             }
<a name="l00107"></a>00107         }
<a name="l00108"></a>00108     }
<a name="l00109"></a>00109     <span class="comment">/* Else We have to do a print*/</span>
<a name="l00110"></a>00110     <span class="keywordflow">else</span>
<a name="l00111"></a>00111     {
<a name="l00112"></a>00112         <span class="comment">/* If the text doesn&#39;t have to blink we write the character to the proper disply&#39;s digit */</span>
<a name="l00113"></a>00113         <span class="keywordflow">if</span> (SS-&gt;<a class="code" href="structSevenSeg.html#a499fbe67df8814ef60c79651a4c2e9f0" title="Has to blink?">blink</a> == <span class="keyword">false</span>)
<a name="l00114"></a>00114             <a class="code" href="hw__led__7seg_8h.html#a18e4b25861f3e3341199ea03311fee43" title="writes the character to the single digit of the display">sseg_on</a>(SS-&gt;<a class="code" href="structSevenSeg.html#ac171cdfbdac61c83ff3a2f96a4698fc3" title="The String to be displayed.">string</a>[SS-&gt;<a class="code" href="structSevenSeg.html#aef677238dc31002c2dce0addd4b5f056" title="Working current position.">curpos</a>], SS-&gt;<a class="code" href="structSevenSeg.html#ae599485da1d3c9d746838ea275dfc1fe" title="Working current digit.">curdigit</a>);
<a name="l00115"></a>00115         <span class="comment">/* Else we do the blinking */</span>
<a name="l00116"></a>00116         <span class="keywordflow">else</span>
<a name="l00117"></a>00117         {
<a name="l00118"></a>00118             <span class="comment">/* If bdigit == 0 we have to blink all the digits */</span>
<a name="l00119"></a>00119             <span class="keywordflow">if</span> (SS-&gt;<a class="code" href="structSevenSeg.html#af30f5da3cb040e98e26e2c34b9b00f1f" title="Has to blink only one digit?">bdigit</a> == 0)
<a name="l00120"></a>00120             {
<a name="l00121"></a>00121                 <span class="keywordflow">if</span> (SS-&gt;<a class="code" href="structSevenSeg.html#a4769182c92e04dd81c57a64ffe6e3408" title="Working scrolling speed.">curspeed</a> &gt;= (SS-&gt;<a class="code" href="structSevenSeg.html#af205235c7d82d5e663aae2572bf3e699" title="Scrolling speed.">speed</a>/2))
<a name="l00122"></a>00122                     <a class="code" href="hw__led__7seg_8h.html#a18e4b25861f3e3341199ea03311fee43" title="writes the character to the single digit of the display">sseg_on</a>(SS-&gt;<a class="code" href="structSevenSeg.html#ac171cdfbdac61c83ff3a2f96a4698fc3" title="The String to be displayed.">string</a>[SS-&gt;<a class="code" href="structSevenSeg.html#aef677238dc31002c2dce0addd4b5f056" title="Working current position.">curpos</a>], SS-&gt;<a class="code" href="structSevenSeg.html#ae599485da1d3c9d746838ea275dfc1fe" title="Working current digit.">curdigit</a>);
<a name="l00123"></a>00123                 <span class="keywordflow">else</span>
<a name="l00124"></a>00124                     <a class="code" href="hw__led__7seg_8h.html#aa7330e563e67c2bc7215a2493a9bb4f2" title="Clean the display.">sseg_off</a>();
<a name="l00125"></a>00125             }
<a name="l00126"></a>00126             <span class="comment">/* else we have to blink only one digit (bdigit -1) */</span>
<a name="l00127"></a>00127             <span class="keywordflow">else</span>
<a name="l00128"></a>00128                 <span class="comment">/* is this the digit to blink? */</span>
<a name="l00129"></a>00129                 <span class="keywordflow">if</span> (SS-&gt;<a class="code" href="structSevenSeg.html#ae599485da1d3c9d746838ea275dfc1fe" title="Working current digit.">curdigit</a> == ((<span class="keywordtype">unsigned</span> <span class="keywordtype">int</span>)SS-&gt;<a class="code" href="structSevenSeg.html#af30f5da3cb040e98e26e2c34b9b00f1f" title="Has to blink only one digit?">bdigit</a>-1))
<a name="l00130"></a>00130                 {
<a name="l00131"></a>00131                     <span class="keywordflow">if</span> (SS-&gt;<a class="code" href="structSevenSeg.html#a4769182c92e04dd81c57a64ffe6e3408" title="Working scrolling speed.">curspeed</a> &gt;= (SS-&gt;<a class="code" href="structSevenSeg.html#af205235c7d82d5e663aae2572bf3e699" title="Scrolling speed.">speed</a>/2))
<a name="l00132"></a>00132                         <a class="code" href="hw__led__7seg_8h.html#a18e4b25861f3e3341199ea03311fee43" title="writes the character to the single digit of the display">sseg_on</a>(SS-&gt;<a class="code" href="structSevenSeg.html#ac171cdfbdac61c83ff3a2f96a4698fc3" title="The String to be displayed.">string</a>[SS-&gt;<a class="code" href="structSevenSeg.html#aef677238dc31002c2dce0addd4b5f056" title="Working current position.">curpos</a>], SS-&gt;<a class="code" href="structSevenSeg.html#ae599485da1d3c9d746838ea275dfc1fe" title="Working current digit.">curdigit</a>);
<a name="l00133"></a>00133                     <span class="keywordflow">else</span>
<a name="l00134"></a>00134                         <a class="code" href="hw__led__7seg_8h.html#aa7330e563e67c2bc7215a2493a9bb4f2" title="Clean the display.">sseg_off</a>();
<a name="l00135"></a>00135                 }
<a name="l00136"></a>00136                 <span class="comment">/* no, so let do a normal print */</span>
<a name="l00137"></a>00137                 <span class="keywordflow">else</span>
<a name="l00138"></a>00138                     <a class="code" href="hw__led__7seg_8h.html#a18e4b25861f3e3341199ea03311fee43" title="writes the character to the single digit of the display">sseg_on</a>(SS-&gt;<a class="code" href="structSevenSeg.html#ac171cdfbdac61c83ff3a2f96a4698fc3" title="The String to be displayed.">string</a>[SS-&gt;<a class="code" href="structSevenSeg.html#aef677238dc31002c2dce0addd4b5f056" title="Working current position.">curpos</a>], SS-&gt;<a class="code" href="structSevenSeg.html#ae599485da1d3c9d746838ea275dfc1fe" title="Working current digit.">curdigit</a>);
<a name="l00139"></a>00139         }
<a name="l00140"></a>00140         <span class="comment">/* Ok, next time next char.... ;) */</span>
<a name="l00141"></a>00141         SS-&gt;<a class="code" href="structSevenSeg.html#ae599485da1d3c9d746838ea275dfc1fe" title="Working current digit.">curdigit</a>++;
<a name="l00142"></a>00142         SS-&gt;<a class="code" href="structSevenSeg.html#aef677238dc31002c2dce0addd4b5f056" title="Working current position.">curpos</a>++;
<a name="l00143"></a>00143     }
<a name="l00144"></a>00144 }
<a name="l00145"></a>00145 
<a name="l00146"></a>00146 <span class="comment">/*</span>
<a name="l00147"></a>00147 <span class="comment"> * FUNCTION: sseg_refresh_wrapper</span>
<a name="l00148"></a>00148 <span class="comment"> *</span>
<a name="l00149"></a>00149 <span class="comment"> * This is a &quot;wrapper&quot; procedure that is called by the timer_setSoftint()</span>
<a name="l00150"></a>00150 <span class="comment"> * with the unique purpose to call the real sseg_refresh procedure without</span>
<a name="l00151"></a>00151 <span class="comment"> * the cast of the structure from void to SevenSeg.</span>
<a name="l00152"></a>00152 <span class="comment"> *</span>
<a name="l00153"></a>00153 <span class="comment"> * param VSS The void pointer that holds the pointer to the data structure</span>
<a name="l00154"></a>00154 <span class="comment"> *</span>
<a name="l00155"></a>00155 <span class="comment"> */</span>
<a name="l00156"></a>00156 <span class="keyword">static</span> <span class="keywordtype">void</span> sseg_refresh_wrapper(<span class="keywordtype">void</span> *VSS)
<a name="l00157"></a>00157 {
<a name="l00158"></a>00158     <span class="comment">/* Here we cast the Structure from void to proper type */</span>
<a name="l00159"></a>00159     <a class="code" href="structSevenSeg.html" title="Context data for Display functions.">SevenSeg</a> *SS;
<a name="l00160"></a>00160     SS = (<a class="code" href="structSevenSeg.html" title="Context data for Display functions.">SevenSeg</a> *)VSS;
<a name="l00161"></a>00161     <span class="comment">/* now we call the right refresh routine */</span>
<a name="l00162"></a>00162     sseg_refresh(SS);
<a name="l00163"></a>00163     <span class="comment">/* ReStart the timer */</span>
<a name="l00164"></a>00164     <a class="code" href="group__drv__timers.html#ga31b280936e453dff724b326c0309af4c" title="Add the specified timer to the software timer service queue.">timer_add</a>(&amp;sseg_trefresh);
<a name="l00165"></a>00165 }
<a name="l00166"></a>00166 
<a name="l00167"></a>00167 <span class="comment">/*</span>
<a name="l00168"></a>00168 <span class="comment"> * FUNCTION: sseg_tabcheck</span>
<a name="l00169"></a>00169 <span class="comment"> *</span>
<a name="l00170"></a>00170 <span class="comment"> * This function return the position of the ascii character in the hex</span>
<a name="l00171"></a>00171 <span class="comment"> * segstable.</span>
<a name="l00172"></a>00172 <span class="comment"> *</span>
<a name="l00173"></a>00173 <span class="comment"> * param source The ascii char to be positioned</span>
<a name="l00174"></a>00174 <span class="comment"> */</span>
<a name="l00175"></a>00175 INLINE uint8_t sseg_tabcheck(<span class="keywordtype">char</span> source)
<a name="l00176"></a>00176 {
<a name="l00177"></a>00177     uint8_t hexchar=38;
<a name="l00178"></a>00178 
<a name="l00179"></a>00179     <span class="comment">/* Numbers */</span>
<a name="l00180"></a>00180     <span class="keywordflow">if</span> ((((<span class="keywordtype">int</span>)source) &gt; 47) &amp;&amp; (((<span class="keywordtype">int</span>)source) &lt; 58))
<a name="l00181"></a>00181         hexchar = source-48;
<a name="l00182"></a>00182     <span class="keywordflow">else</span>
<a name="l00183"></a>00183         <span class="comment">/* Capital Letters */</span>
<a name="l00184"></a>00184         <span class="keywordflow">if</span> ((((<span class="keywordtype">int</span>)source) &gt; 64) &amp;&amp; (((<span class="keywordtype">int</span>)source) &lt; 91))
<a name="l00185"></a>00185             hexchar = source-53;
<a name="l00186"></a>00186         <span class="keywordflow">else</span>
<a name="l00187"></a>00187             <span class="comment">/* Letters */</span>
<a name="l00188"></a>00188             <span class="keywordflow">if</span> ((((<span class="keywordtype">int</span>)source) &gt; 96) &amp;&amp; (((<span class="keywordtype">int</span>)source) &lt; 123))
<a name="l00189"></a>00189                 hexchar = source-85;
<a name="l00190"></a>00190             <span class="keywordflow">else</span>
<a name="l00191"></a>00191                 <span class="comment">/* Minus */</span>
<a name="l00192"></a>00192                 <span class="keywordflow">if</span> (((<span class="keywordtype">int</span>)source) == 45)
<a name="l00193"></a>00193                     hexchar = 11;
<a name="l00194"></a>00194                 <span class="keywordflow">else</span>
<a name="l00195"></a>00195                     <span class="comment">/* Space */</span>
<a name="l00196"></a>00196                     <span class="keywordflow">if</span> (((<span class="keywordtype">int</span>)source) == 32)
<a name="l00197"></a>00197                         hexchar = 38;
<a name="l00198"></a>00198                     <span class="keywordflow">else</span>
<a name="l00199"></a>00199                         <span class="comment">/* Dot */</span>
<a name="l00200"></a>00200                         <span class="keywordflow">if</span> (((<span class="keywordtype">int</span>)source) == 46)
<a name="l00201"></a>00201                             hexchar = 10;
<a name="l00202"></a>00202     <span class="keywordflow">return</span> hexchar;
<a name="l00203"></a>00203 }
<a name="l00204"></a>00204 
<a name="l00217"></a><a class="code" href="group__SevenSegDisplay.html#gadbdb730fe489f13944c584720c1c456d">00217</a> <span class="keywordtype">int</span> <a class="code" href="group__SevenSegDisplay.html#gadbdb730fe489f13944c584720c1c456d" title="Print a string on the display.">sevenseg_print</a>(<a class="code" href="structSevenSeg.html" title="Context data for Display functions.">SevenSeg</a> *SS, <span class="keyword">const</span> <span class="keywordtype">char</span> *sstring)
<a name="l00218"></a>00218 {
<a name="l00219"></a>00219     <span class="keywordtype">size_t</span> string_lenght;
<a name="l00220"></a>00220     <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> x,y,dotnumber;
<a name="l00221"></a>00221     <span class="keywordtype">bool</span> dotjump = <span class="keyword">false</span>;
<a name="l00222"></a>00222     uint8_t hexchar;
<a name="l00223"></a>00223 
<a name="l00224"></a>00224     <span class="comment">/* Check if the display is unlocked */</span>
<a name="l00225"></a>00225     <span class="keywordflow">if</span> (SS-&gt;<a class="code" href="structSevenSeg.html#ad8050be682a2f28d9260165437143832" title="Is the structure in edit?">busyedit</a> == <span class="keyword">false</span>)
<a name="l00226"></a>00226         <span class="keywordflow">return</span> -1;
<a name="l00227"></a>00227 
<a name="l00228"></a>00228     <span class="comment">/* Check if the string is too big */</span>
<a name="l00229"></a>00229     <span class="keywordflow">if</span> (<span class="keyword">sizeof</span>(&amp;sstring) &gt; (<a class="code" href="group__SevenSegDisplay.html#gaaf8eb040245b97fa569c3ead8215971d" title="Max lenght of the string to be displayed.">CONFIG_LED_7SEG_STRLEN</a>-(2*<a class="code" href="group__SevenSegDisplay.html#gaf157c1b0f5897e3552ba92859984c2c2" title="Number of digit present in the LED display.">CONFIG_LED_7SEG_DIGIT</a>)))
<a name="l00230"></a>00230         <span class="keywordflow">return</span> -2;
<a name="l00231"></a>00231 
<a name="l00232"></a>00232     <span class="comment">/* get the string length and set the number of dots in the string to 0 */</span>
<a name="l00233"></a>00233     string_lenght = strlen(sstring);
<a name="l00234"></a>00234     dotnumber = 0;
<a name="l00235"></a>00235 
<a name="l00236"></a>00236     <span class="comment">/* check if there are some dots in the string and report the number in dotnumber */</span>
<a name="l00237"></a>00237     <span class="keywordflow">for</span> (x=0;x&lt;(<span class="keywordtype">unsigned</span> int)string_lenght;x++)
<a name="l00238"></a>00238     {
<a name="l00239"></a>00239         <span class="keywordflow">if</span> (((<span class="keywordtype">int</span>)sstring[x]) == 46)
<a name="l00240"></a>00240             dotnumber++;
<a name="l00241"></a>00241     }
<a name="l00242"></a>00242 
<a name="l00243"></a>00243     <span class="comment">/* If the *REAL* lenght of the string is less or equal than the number of digits */</span>
<a name="l00244"></a>00244     <span class="keywordflow">if</span> (((<span class="keywordtype">int</span>)string_lenght-dotnumber) &lt;= <a class="code" href="group__SevenSegDisplay.html#gaf157c1b0f5897e3552ba92859984c2c2" title="Number of digit present in the LED display.">CONFIG_LED_7SEG_DIGIT</a>)
<a name="l00245"></a>00245     {
<a name="l00246"></a>00246         <span class="comment">/* If the *REAL* lenght of the string is less than number of digits */</span>
<a name="l00247"></a>00247         <span class="keywordflow">if</span> (((<span class="keywordtype">int</span>)string_lenght-dotnumber) &lt; <a class="code" href="group__SevenSegDisplay.html#gaf157c1b0f5897e3552ba92859984c2c2" title="Number of digit present in the LED display.">CONFIG_LED_7SEG_DIGIT</a>)
<a name="l00248"></a>00248         {
<a name="l00249"></a>00249             <span class="comment">/* Fill the left side of the string with blanks */</span>
<a name="l00250"></a>00250             <span class="keywordflow">for</span> (x=0; x&lt;(<a class="code" href="group__SevenSegDisplay.html#gaf157c1b0f5897e3552ba92859984c2c2" title="Number of digit present in the LED display.">CONFIG_LED_7SEG_DIGIT</a>-((int)string_lenght-dotnumber)); x++)
<a name="l00251"></a>00251                 SS-&gt;<a class="code" href="structSevenSeg.html#ac171cdfbdac61c83ff3a2f96a4698fc3" title="The String to be displayed.">string</a>[x] = segstable[38];
<a name="l00252"></a>00252             y = x;
<a name="l00253"></a>00253         }
<a name="l00254"></a>00254         <span class="keywordflow">else</span>
<a name="l00255"></a>00255         {
<a name="l00256"></a>00256             <span class="comment">/* Else we have the exact string length of the display */</span>
<a name="l00257"></a>00257             y = 0;
<a name="l00258"></a>00258         }
<a name="l00259"></a>00259     }
<a name="l00260"></a>00260     <span class="keywordflow">else</span>
<a name="l00261"></a>00261     {
<a name="l00262"></a>00262         <span class="comment">/* Else we have the string length bigger than the display and we need to fill</span>
<a name="l00263"></a>00263 <span class="comment">         * the entire left side of the string with blanks to begin the scroll from the</span>
<a name="l00264"></a>00264 <span class="comment">         * rigthest side of the display */</span>
<a name="l00265"></a>00265         <span class="keywordflow">for</span> (x=0; x&lt;<a class="code" href="group__SevenSegDisplay.html#gaf157c1b0f5897e3552ba92859984c2c2" title="Number of digit present in the LED display.">CONFIG_LED_7SEG_DIGIT</a>; x++)
<a name="l00266"></a>00266             SS-&gt;<a class="code" href="structSevenSeg.html#ac171cdfbdac61c83ff3a2f96a4698fc3" title="The String to be displayed.">string</a>[x] = segstable[38];
<a name="l00267"></a>00267         y = CONFIG_LED_7SEG_DIGIT;
<a name="l00268"></a>00268     }
<a name="l00269"></a>00269     <span class="comment">/* Here we start to fill the string with the Hex 7seg characters values */</span>
<a name="l00270"></a>00270     hexchar = 0;
<a name="l00271"></a>00271     <span class="keywordflow">for</span> (x=0; x&lt;(<span class="keywordtype">unsigned</span> int)string_lenght; x++)
<a name="l00272"></a>00272     {
<a name="l00273"></a>00273         hexchar = sseg_tabcheck(sstring[x]);
<a name="l00274"></a>00274         <span class="comment">/* do we have a dot? */</span>
<a name="l00275"></a>00275         <span class="keywordflow">if</span> (hexchar == 10)
<a name="l00276"></a>00276         {
<a name="l00277"></a>00277             <span class="comment">/* If we are at the first character of the string it has to be forced</span>
<a name="l00278"></a>00278 <span class="comment">             * as &quot;lonly&quot; dot ;) */</span>
<a name="l00279"></a>00279             <span class="keywordflow">if</span> (x &gt; 0)
<a name="l00280"></a>00280             {
<a name="l00281"></a>00281 <span class="preprocessor">#if CONFIG_LED_7SEG_CCAT</span>
<a name="l00282"></a>00282 <span class="preprocessor"></span>                SS-&gt;<a class="code" href="structSevenSeg.html#ac171cdfbdac61c83ff3a2f96a4698fc3" title="The String to be displayed.">string</a>[y-1] = SS-&gt;<a class="code" href="structSevenSeg.html#ac171cdfbdac61c83ff3a2f96a4698fc3" title="The String to be displayed.">string</a>[y-1] | segstable[(int)hexchar];
<a name="l00283"></a>00283 <span class="preprocessor">#else</span>
<a name="l00284"></a>00284 <span class="preprocessor"></span>                SS-&gt;<a class="code" href="structSevenSeg.html#ac171cdfbdac61c83ff3a2f96a4698fc3" title="The String to be displayed.">string</a>[y-1] = SS-&gt;<a class="code" href="structSevenSeg.html#ac171cdfbdac61c83ff3a2f96a4698fc3" title="The String to be displayed.">string</a>[y-1] &amp; segstable[(int)hexchar];
<a name="l00285"></a>00285 <span class="preprocessor">#endif</span>
<a name="l00286"></a>00286 <span class="preprocessor"></span>                dotjump = <span class="keyword">true</span>;
<a name="l00287"></a>00287             }
<a name="l00288"></a>00288         }
<a name="l00289"></a>00289         <span class="comment">/* If the last character was a dot and we aren&#39;t at the first character of the string</span>
<a name="l00290"></a>00290 <span class="comment">         * we have just inserted it */</span>
<a name="l00291"></a>00291         <span class="keywordflow">if</span> (dotjump)
<a name="l00292"></a>00292             dotjump = <span class="keyword">false</span>;
<a name="l00293"></a>00293         <span class="comment">/* Let&#39;s put the character in the structure&#39;s string */</span>
<a name="l00294"></a>00294         <span class="keywordflow">else</span>
<a name="l00295"></a>00295         {
<a name="l00296"></a>00296             SS-&gt;<a class="code" href="structSevenSeg.html#ac171cdfbdac61c83ff3a2f96a4698fc3" title="The String to be displayed.">string</a>[y] = segstable[(int)hexchar];
<a name="l00297"></a>00297             y++;
<a name="l00298"></a>00298         }
<a name="l00299"></a>00299     }
<a name="l00300"></a>00300     <span class="comment">/* If we have the string length bigger than the display we need to fill</span>
<a name="l00301"></a>00301 <span class="comment">     * the entire right side of the string with blanks to end the scroll</span>
<a name="l00302"></a>00302 <span class="comment">     * to the rigthest side of the display */</span>
<a name="l00303"></a>00303     <span class="keywordflow">if</span> (((<span class="keywordtype">int</span>)string_lenght-dotnumber) &gt; <a class="code" href="group__SevenSegDisplay.html#gaf157c1b0f5897e3552ba92859984c2c2" title="Number of digit present in the LED display.">CONFIG_LED_7SEG_DIGIT</a>)
<a name="l00304"></a>00304     {
<a name="l00305"></a>00305         <span class="keywordflow">for</span> (x=0; x&lt;<a class="code" href="group__SevenSegDisplay.html#gaf157c1b0f5897e3552ba92859984c2c2" title="Number of digit present in the LED display.">CONFIG_LED_7SEG_DIGIT</a>; x++)
<a name="l00306"></a>00306         {
<a name="l00307"></a>00307             SS-&gt;<a class="code" href="structSevenSeg.html#ac171cdfbdac61c83ff3a2f96a4698fc3" title="The String to be displayed.">string</a>[y] = segstable[38];
<a name="l00308"></a>00308             y++;
<a name="l00309"></a>00309         }
<a name="l00310"></a>00310     }
<a name="l00311"></a>00311     <span class="comment">/* Let&#39;s put the total string length to the structure */</span>
<a name="l00312"></a>00312     SS-&gt;<a class="code" href="structSevenSeg.html#ac96f863120bdae5081ee236839db20a0" title="The length of the string to be displayed.">string_len</a> = y;
<a name="l00313"></a>00313 
<a name="l00314"></a>00314     <span class="keywordflow">return</span> 0;
<a name="l00315"></a>00315 }
<a name="l00316"></a>00316 
<a name="l00325"></a><a class="code" href="group__SevenSegDisplay.html#ga83e09b743ec54a60b596c154d501ad00">00325</a> <span class="keywordtype">void</span> <a class="code" href="group__SevenSegDisplay.html#ga83e09b743ec54a60b596c154d501ad00" title="initialize the structure and the timer for the display">sevenseg_init</a>(<a class="code" href="structSevenSeg.html" title="Context data for Display functions.">SevenSeg</a> *SS)
<a name="l00326"></a>00326 {
<a name="l00327"></a>00327     <span class="comment">/*</span>
<a name="l00328"></a>00328 <span class="comment">     * Init the 7segments string structure</span>
<a name="l00329"></a>00329 <span class="comment">     */</span>
<a name="l00330"></a>00330     SS-&gt;<a class="code" href="structSevenSeg.html#ad8050be682a2f28d9260165437143832" title="Is the structure in edit?">busyedit</a> = <span class="keyword">true</span>;
<a name="l00331"></a>00331     <a class="code" href="group__SevenSegDisplay.html#gae1efd17019b365c64e4c1b3a8425d347" title="clear the display">sevenseg_clear</a>(SS);
<a name="l00332"></a>00332     SS-&gt;<a class="code" href="structSevenSeg.html#ad8050be682a2f28d9260165437143832" title="Is the structure in edit?">busyedit</a> = <span class="keyword">false</span>;
<a name="l00333"></a>00333 
<a name="l00334"></a>00334     <span class="comment">/*</span>
<a name="l00335"></a>00335 <span class="comment">     * Init the I/O ports and set the display OFF</span>
<a name="l00336"></a>00336 <span class="comment">     */</span>
<a name="l00337"></a>00337     <a class="code" href="hw__led__7seg_8h.html#ae6befefa75584124dc527eb606ce569e" title="initalize the HW regsiters">sseg_init</a>();
<a name="l00338"></a>00338 
<a name="l00339"></a>00339     <span class="comment">/*</span>
<a name="l00340"></a>00340 <span class="comment">     * Define the timer for the refresh of the display</span>
<a name="l00341"></a>00341 <span class="comment">     * The timer calls the sevenseg_refresh function</span>
<a name="l00342"></a>00342 <span class="comment">     * every &quot;CONFIG_LED_7SEG_RTIME&quot; milliseconds for</span>
<a name="l00343"></a>00343 <span class="comment">     * an acceptable persistance of a single 7 segments</span>
<a name="l00344"></a>00344 <span class="comment">     * display.</span>
<a name="l00345"></a>00345 <span class="comment">     */</span>
<a name="l00346"></a>00346     <span class="comment">// set the callback</span>
<a name="l00347"></a>00347     <a class="code" href="group__drv__timers.html#ga05183713aaa5b341bcda25af3837a111" title="Set the timer so that it calls an user hook when it expires.">timer_setSoftint</a>(&amp;sseg_trefresh, sseg_refresh_wrapper, (<span class="keywordtype">void</span> *)SS);
<a name="l00348"></a>00348     <span class="comment">// expire time: 1s</span>
<a name="l00349"></a>00349     <a class="code" href="group__drv__timers.html#ga74311fd08b3bfdecb496f16b7465715b" title="Set the timer delay (the time before the event will be triggered)">timer_setDelay</a>(&amp;sseg_trefresh, <a class="code" href="group__drv__timers.html#ga1058ec50197d9ff9483be09612022929" title="Convert ms [ms] to ticks.">ms_to_ticks</a>(<a class="code" href="group__SevenSegDisplay.html#ga103097b0f20de17a9c8910e4b9c2ad51" title="Default refresh time (ms).">CONFIG_LED_7SEG_RTIME</a>));
<a name="l00350"></a>00350     <span class="comment">// start the timer</span>
<a name="l00351"></a>00351     <a class="code" href="group__drv__timers.html#ga31b280936e453dff724b326c0309af4c" title="Add the specified timer to the software timer service queue.">timer_add</a>(&amp;sseg_trefresh);
<a name="l00352"></a>00352 }
<a name="l00353"></a>00353 
<a name="l00364"></a><a class="code" href="group__SevenSegDisplay.html#ga602f45b9575ad540c3dbb4c23f82c11a">00364</a> <span class="keywordtype">bool</span> <a class="code" href="group__SevenSegDisplay.html#ga602f45b9575ad540c3dbb4c23f82c11a" title="check if is possible to do a new print">sevenseg_isReady</a>(<a class="code" href="structSevenSeg.html" title="Context data for Display functions.">SevenSeg</a> *SS)
<a name="l00365"></a>00365 {
<a name="l00366"></a>00366         <span class="keywordflow">return</span> !SS-&gt;<a class="code" href="structSevenSeg.html#a52d8dcc2120c8546478e576109232053" title="Is it printed at least one time?">firstrun</a>;
<a name="l00367"></a>00367 }
<a name="l00368"></a>00368 
<a name="l00379"></a><a class="code" href="group__SevenSegDisplay.html#ga4e700e600551b1f72cde57c259bdf610">00379</a> <span class="keywordtype">bool</span> <a class="code" href="group__SevenSegDisplay.html#ga4e700e600551b1f72cde57c259bdf610" title="unlock the SevenSeg structure and stops the print">sevenseg_unlock</a>(<a class="code" href="structSevenSeg.html" title="Context data for Display functions.">SevenSeg</a> *SS)
<a name="l00380"></a>00380 {
<a name="l00381"></a>00381     <span class="keywordflow">if</span> (SS-&gt;<a class="code" href="structSevenSeg.html#a52d8dcc2120c8546478e576109232053" title="Is it printed at least one time?">firstrun</a> == <span class="keyword">false</span>)
<a name="l00382"></a>00382     {
<a name="l00383"></a>00383         SS-&gt;<a class="code" href="structSevenSeg.html#ad8050be682a2f28d9260165437143832" title="Is the structure in edit?">busyedit</a> = <span class="keyword">true</span>;
<a name="l00384"></a>00384         SS-&gt;<a class="code" href="structSevenSeg.html#a52d8dcc2120c8546478e576109232053" title="Is it printed at least one time?">firstrun</a> = <span class="keyword">true</span>;
<a name="l00385"></a>00385         SS-&gt;<a class="code" href="structSevenSeg.html#ae599485da1d3c9d746838ea275dfc1fe" title="Working current digit.">curdigit</a> = 0;
<a name="l00386"></a>00386         SS-&gt;<a class="code" href="structSevenSeg.html#aef677238dc31002c2dce0addd4b5f056" title="Working current position.">curpos</a> = 0;
<a name="l00387"></a>00387     }
<a name="l00388"></a>00388     <span class="keywordflow">else</span>
<a name="l00389"></a>00389         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00390"></a>00390     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00391"></a>00391 }
<a name="l00392"></a>00392 
<a name="l00403"></a><a class="code" href="group__SevenSegDisplay.html#ga95eaf543d14935798d714cf9386d9b6c">00403</a> <span class="keywordtype">bool</span> <a class="code" href="group__SevenSegDisplay.html#ga95eaf543d14935798d714cf9386d9b6c" title="lock the SeveSeg structure and starts a new print">sevenseg_lock</a>(<a class="code" href="structSevenSeg.html" title="Context data for Display functions.">SevenSeg</a> *SS)
<a name="l00404"></a>00404 {
<a name="l00405"></a>00405     <span class="keywordflow">if</span> (SS-&gt;<a class="code" href="structSevenSeg.html#ad8050be682a2f28d9260165437143832" title="Is the structure in edit?">busyedit</a> == <span class="keyword">true</span>)
<a name="l00406"></a>00406     {
<a name="l00407"></a>00407     <span class="comment">/* If the string is longer than the number of the digit of the display we</span>
<a name="l00408"></a>00408 <span class="comment">     * reset the single digit blink to zero to be sure that the display of</span>
<a name="l00409"></a>00409 <span class="comment">     * the text is clean from previous single digit blinking settings */</span>
<a name="l00410"></a>00410         <span class="keywordflow">if</span> (SS-&gt;<a class="code" href="structSevenSeg.html#ac96f863120bdae5081ee236839db20a0" title="The length of the string to be displayed.">string_len</a> &gt; <a class="code" href="group__SevenSegDisplay.html#gaf157c1b0f5897e3552ba92859984c2c2" title="Number of digit present in the LED display.">CONFIG_LED_7SEG_DIGIT</a>)
<a name="l00411"></a>00411             SS-&gt;<a class="code" href="structSevenSeg.html#af30f5da3cb040e98e26e2c34b9b00f1f" title="Has to blink only one digit?">bdigit</a> = 0;
<a name="l00412"></a>00412         SS-&gt;<a class="code" href="structSevenSeg.html#ad8050be682a2f28d9260165437143832" title="Is the structure in edit?">busyedit</a> = <span class="keyword">false</span>;
<a name="l00413"></a>00413     }
<a name="l00414"></a>00414     <span class="keywordflow">else</span>
<a name="l00415"></a>00415         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00416"></a>00416     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00417"></a>00417 }
<a name="l00418"></a>00418 
<a name="l00432"></a><a class="code" href="group__SevenSegDisplay.html#ga83f7f9e39d428e5e8eea6327175c7953">00432</a> <span class="keywordtype">bool</span> <a class="code" href="group__SevenSegDisplay.html#ga83f7f9e39d428e5e8eea6327175c7953" title="set the blinking of the digits of the display">sevenseg_setBlink</a>(<a class="code" href="structSevenSeg.html" title="Context data for Display functions.">SevenSeg</a> *SS, <span class="keywordtype">bool</span> blink, uint8_t digit)
<a name="l00433"></a>00433 {
<a name="l00434"></a>00434     <span class="keywordflow">if</span> (SS-&gt;<a class="code" href="structSevenSeg.html#ad8050be682a2f28d9260165437143832" title="Is the structure in edit?">busyedit</a> == <span class="keyword">true</span>)
<a name="l00435"></a>00435     {
<a name="l00436"></a>00436         <span class="keywordflow">if</span> (blink == <span class="keyword">true</span>)
<a name="l00437"></a>00437         {
<a name="l00438"></a>00438             <span class="keywordflow">if</span> (digit == 0)
<a name="l00439"></a>00439                 SS-&gt;<a class="code" href="structSevenSeg.html#af30f5da3cb040e98e26e2c34b9b00f1f" title="Has to blink only one digit?">bdigit</a> = digit;
<a name="l00440"></a>00440             <span class="keywordflow">else</span>
<a name="l00441"></a>00441                 <span class="keywordflow">if</span> ((digit-1) &lt;= <a class="code" href="group__SevenSegDisplay.html#gaf157c1b0f5897e3552ba92859984c2c2" title="Number of digit present in the LED display.">CONFIG_LED_7SEG_DIGIT</a>)
<a name="l00442"></a>00442                     SS-&gt;<a class="code" href="structSevenSeg.html#af30f5da3cb040e98e26e2c34b9b00f1f" title="Has to blink only one digit?">bdigit</a> = digit;
<a name="l00443"></a>00443                 <span class="keywordflow">else</span>
<a name="l00444"></a>00444                     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00445"></a>00445         }
<a name="l00446"></a>00446         SS-&gt;<a class="code" href="structSevenSeg.html#a499fbe67df8814ef60c79651a4c2e9f0" title="Has to blink?">blink</a> = blink;
<a name="l00447"></a>00447     }
<a name="l00448"></a>00448     <span class="keywordflow">else</span>
<a name="l00449"></a>00449         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00450"></a>00450     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00451"></a>00451 }
<a name="l00452"></a>00452 
<a name="l00464"></a><a class="code" href="group__SevenSegDisplay.html#ga0acfcb4e8a556d2a9abc8d858735cdcd">00464</a> <span class="keywordtype">bool</span> <a class="code" href="group__SevenSegDisplay.html#ga0acfcb4e8a556d2a9abc8d858735cdcd" title="set if the text has to be displayed just one time">sevenseg_setRunonce</a>(<a class="code" href="structSevenSeg.html" title="Context data for Display functions.">SevenSeg</a> *SS, <span class="keywordtype">bool</span> runonce)
<a name="l00465"></a>00465 {
<a name="l00466"></a>00466     <span class="keywordflow">if</span> (SS-&gt;<a class="code" href="structSevenSeg.html#ad8050be682a2f28d9260165437143832" title="Is the structure in edit?">busyedit</a> == <span class="keyword">true</span>)
<a name="l00467"></a>00467         SS-&gt;<a class="code" href="structSevenSeg.html#a3d3986f18dbc16cc3589477f5a97dad0" title="Has to be displayed only one time?">runonce</a> = runonce;
<a name="l00468"></a>00468     <span class="keywordflow">else</span>
<a name="l00469"></a>00469         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00470"></a>00470     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00471"></a>00471 }
<a name="l00472"></a>00472 
<a name="l00486"></a><a class="code" href="group__SevenSegDisplay.html#ga7dc8265f345b3001b8b68d4e5402bd76">00486</a> <span class="keywordtype">bool</span> <a class="code" href="group__SevenSegDisplay.html#ga7dc8265f345b3001b8b68d4e5402bd76" title="set the scrolling speed of the text">sevenseg_setRunspeed</a>(<a class="code" href="structSevenSeg.html" title="Context data for Display functions.">SevenSeg</a> *SS, <span class="keywordtype">unsigned</span> <span class="keywordtype">int</span> r_speed)
<a name="l00487"></a>00487 {
<a name="l00488"></a>00488     <span class="keywordflow">if</span> (SS-&gt;<a class="code" href="structSevenSeg.html#ad8050be682a2f28d9260165437143832" title="Is the structure in edit?">busyedit</a> == <span class="keyword">true</span>)
<a name="l00489"></a>00489     {
<a name="l00490"></a>00490         SS-&gt;<a class="code" href="structSevenSeg.html#af205235c7d82d5e663aae2572bf3e699" title="Scrolling speed.">speed</a> = r_speed;
<a name="l00491"></a>00491         SS-&gt;<a class="code" href="structSevenSeg.html#a4769182c92e04dd81c57a64ffe6e3408" title="Working scrolling speed.">curspeed</a> = r_speed;
<a name="l00492"></a>00492     }
<a name="l00493"></a>00493     <span class="keywordflow">else</span>
<a name="l00494"></a>00494         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00495"></a>00495     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00496"></a>00496 }
<a name="l00497"></a>00497 
<a name="l00508"></a><a class="code" href="group__SevenSegDisplay.html#gae1efd17019b365c64e4c1b3a8425d347">00508</a> <span class="keywordtype">bool</span> <a class="code" href="group__SevenSegDisplay.html#gae1efd17019b365c64e4c1b3a8425d347" title="clear the display">sevenseg_clear</a>(<a class="code" href="structSevenSeg.html" title="Context data for Display functions.">SevenSeg</a> *SS)
<a name="l00509"></a>00509 {
<a name="l00510"></a>00510     <span class="keywordflow">if</span> (SS-&gt;<a class="code" href="structSevenSeg.html#ad8050be682a2f28d9260165437143832" title="Is the structure in edit?">busyedit</a> == <span class="keyword">true</span>)
<a name="l00511"></a>00511     {
<a name="l00512"></a>00512         memset(((<span class="keywordtype">void</span> *)&amp;SS-&gt;<a class="code" href="structSevenSeg.html#ac171cdfbdac61c83ff3a2f96a4698fc3" title="The String to be displayed.">string</a>),segstable[38],<span class="keyword">sizeof</span>(SS-&gt;<a class="code" href="structSevenSeg.html#ac171cdfbdac61c83ff3a2f96a4698fc3" title="The String to be displayed.">string</a>));
<a name="l00513"></a>00513         SS-&gt;<a class="code" href="structSevenSeg.html#ac96f863120bdae5081ee236839db20a0" title="The length of the string to be displayed.">string_len</a> = <a class="code" href="group__SevenSegDisplay.html#gaf157c1b0f5897e3552ba92859984c2c2" title="Number of digit present in the LED display.">CONFIG_LED_7SEG_DIGIT</a>;
<a name="l00514"></a>00514         SS-&gt;<a class="code" href="structSevenSeg.html#a499fbe67df8814ef60c79651a4c2e9f0" title="Has to blink?">blink</a> = <span class="keyword">false</span>;
<a name="l00515"></a>00515         SS-&gt;<a class="code" href="structSevenSeg.html#af30f5da3cb040e98e26e2c34b9b00f1f" title="Has to blink only one digit?">bdigit</a> = 0;
<a name="l00516"></a>00516         SS-&gt;<a class="code" href="structSevenSeg.html#a3d3986f18dbc16cc3589477f5a97dad0" title="Has to be displayed only one time?">runonce</a> = <span class="keyword">false</span>;
<a name="l00517"></a>00517         SS-&gt;<a class="code" href="structSevenSeg.html#ae599485da1d3c9d746838ea275dfc1fe" title="Working current digit.">curdigit</a> = 0;
<a name="l00518"></a>00518         SS-&gt;<a class="code" href="structSevenSeg.html#aef677238dc31002c2dce0addd4b5f056" title="Working current position.">curpos</a> = 0;
<a name="l00519"></a>00519         SS-&gt;<a class="code" href="structSevenSeg.html#af205235c7d82d5e663aae2572bf3e699" title="Scrolling speed.">speed</a> = <a class="code" href="group__SevenSegDisplay.html#ga23731e943a910c63240af378961195f8" title="Default scrolling speed (ms * CONFIG_LED_7SEG_RTIME).">CONFIG_LED_7SEG_SSPEED</a>;
<a name="l00520"></a>00520         SS-&gt;<a class="code" href="structSevenSeg.html#a4769182c92e04dd81c57a64ffe6e3408" title="Working scrolling speed.">curspeed</a> = <a class="code" href="group__SevenSegDisplay.html#ga23731e943a910c63240af378961195f8" title="Default scrolling speed (ms * CONFIG_LED_7SEG_RTIME).">CONFIG_LED_7SEG_SSPEED</a>;
<a name="l00521"></a>00521         SS-&gt;<a class="code" href="structSevenSeg.html#a52d8dcc2120c8546478e576109232053" title="Is it printed at least one time?">firstrun</a> = <span class="keyword">false</span>;
<a name="l00522"></a>00522     }
<a name="l00523"></a>00523     <span class="keywordflow">else</span>
<a name="l00524"></a>00524         <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00525"></a>00525     <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00526"></a>00526 } <span class="comment">//defgroup drivers</span>
</pre></div></div>
</div>


