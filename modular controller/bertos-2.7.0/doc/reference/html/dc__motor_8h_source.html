

<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_9fd71c1ac00056e7d855336b2291c56c.html">bertos</a>      </li>
      <li class="navelem"><a class="el" href="dir_f7c89dbd63e8f34e572fe939945c15d7.html">drv</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">dc_motor.h</div>  </div>
</div>
<div class="contents">
<a href="dc__motor_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00043"></a>00043 <span class="preprocessor">#ifndef DRV_DC_MOTOR_H</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">#define DRV_DC_MOTOR_H</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="hw__dc__motor_8h.html" title="DC motor hardware-specific definitions.">hw/hw_dc_motor.h</a>&quot;</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="preprocessor">#include &quot;<a class="code" href="cfg__dc__motor_8h.html" title="Configuration file for DC motor module.">cfg/cfg_dc_motor.h</a>&quot;</span>
<a name="l00049"></a>00049 <span class="preprocessor">#include &quot;<a class="code" href="cfg__pwm_8h.html" title="Configuration file for PWM module.">cfg/cfg_pwm.h</a>&quot;</span>
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;<a class="code" href="macros_8h.html">cfg/macros.h</a>&gt;</span>
<a name="l00051"></a>00051 
<a name="l00052"></a>00052 <span class="preprocessor">#include &lt;<a class="code" href="pid__control_8h.html" title="Proportional, integral, derivative controller (PID controller).">algo/pid_control.h</a>&gt;</span>
<a name="l00053"></a>00053 
<a name="l00054"></a>00054 <span class="preprocessor">#include &lt;<a class="code" href="pwm_8h.html">drv/pwm.h</a>&gt;</span>
<a name="l00055"></a>00055 <span class="preprocessor">#include &lt;<a class="code" href="timer_8h.html">drv/timer.h</a>&gt;</span>
<a name="l00056"></a>00056 <span class="preprocessor">#include &lt;<a class="code" href="adc_8h.html">drv/adc.h</a>&gt;</span>
<a name="l00057"></a>00057 
<a name="l00058"></a><a class="code" href="dc__motor_8h.html#a9c7affbfc873e147273c4db502f7078e">00058</a> <span class="preprocessor">#define DC_MOTOR_NO_EXPIRE        -1  ///&lt; The DC motor runs do not expire, so it runs forever.</span>
<a name="l00059"></a><a class="code" href="dc__motor_8h.html#a30e10bc42ef9ddf6207e9b662aa57396">00059</a> <span class="preprocessor"></span><span class="preprocessor">#define DC_MOTOR_NO_DEV_SPEED     -1  ///&lt; Disable the speed acquire from device (like trimmer, etc.).</span>
<a name="l00060"></a>00060 <span class="preprocessor"></span>
<a name="l00064"></a><a class="code" href="dc__motor_8h.html#a1df3986d581c772f61532e1512d956fe">00064</a> <span class="keyword">typedef</span> uint16_t <a class="code" href="dc__motor_8h.html#a1df3986d581c772f61532e1512d956fe" title="Type for DC motor.">dc_speed_t</a>;
<a name="l00065"></a>00065 
<a name="l00069"></a><a class="code" href="structDCMotorConfig.html">00069</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structDCMotorConfig.html" title="DC motor configuration stucture.">DCMotorConfig</a>
<a name="l00070"></a>00070 {
<a name="l00071"></a><a class="code" href="structDCMotorConfig.html#af6866052967609155589c1070aca3aeb">00071</a>     <a class="code" href="structPidCfg.html" title="PID context structure.">PidCfg</a> <a class="code" href="structDCMotorConfig.html#af6866052967609155589c1070aca3aeb" title="Pid control.">pid_cfg</a>;         
<a name="l00072"></a><a class="code" href="structDCMotorConfig.html#ade0afac4cd6969ea38c5abfa29cd752b">00072</a>     <span class="keywordtype">bool</span> <a class="code" href="structDCMotorConfig.html#ade0afac4cd6969ea38c5abfa29cd752b" title="Flag to disable or enable pid control.">pid_enable</a>;        
<a name="l00073"></a>00073 
<a name="l00074"></a><a class="code" href="structDCMotorConfig.html#ae02ad85662dd4f092d7a7385598729c3">00074</a>     <span class="keywordtype">unsigned</span> <a class="code" href="structDCMotorConfig.html#ae02ad85662dd4f092d7a7385598729c3" title="Pwm channel.">pwm_dev</a>;       
<a name="l00075"></a><a class="code" href="structDCMotorConfig.html#a222ec476e9f5af88a511e8c6ad90c231">00075</a>     <a class="code" href="group__pwm__driver.html#ga441d99cfd172b050d79e3fa5e150a937" title="Type for PWM frequency.">pwm_freq_t</a> <a class="code" href="structDCMotorConfig.html#a222ec476e9f5af88a511e8c6ad90c231" title="Pwm waveform frequency.">freq</a>;        
<a name="l00076"></a>00076 
<a name="l00077"></a><a class="code" href="structDCMotorConfig.html#a93dfd8166fc616bbe55e73d8eab07e67">00077</a>     <a class="code" href="group__adc.html#gacb8be3e53706878d49ed1f6a37ffa27f" title="Type for channel.">adc_ch_t</a> <a class="code" href="structDCMotorConfig.html#a93dfd8166fc616bbe55e73d8eab07e67" title="ADC channel.">adc_ch</a>;        
<a name="l00078"></a><a class="code" href="structDCMotorConfig.html#ac8310a735ff2771059057ff6ac7ec545">00078</a>     <a class="code" href="group__adc.html#gac08af26bad316225f17d378219e02bd2" title="Type for ADC return value.">adcread_t</a> <a class="code" href="structDCMotorConfig.html#ac8310a735ff2771059057ff6ac7ec545" title="ADC max scale value.">adc_max</a>;      
<a name="l00079"></a><a class="code" href="structDCMotorConfig.html#a92b1830f09f35f173241ae8729764aa3">00079</a>     <a class="code" href="group__adc.html#gac08af26bad316225f17d378219e02bd2" title="Type for ADC return value.">adcread_t</a> <a class="code" href="structDCMotorConfig.html#a92b1830f09f35f173241ae8729764aa3" title="ADC min scale value.">adc_min</a>;      
<a name="l00080"></a>00080 
<a name="l00081"></a><a class="code" href="structDCMotorConfig.html#a769099d666af120fa87c25a3f2bf8868">00081</a>     <span class="keywordtype">bool</span> <a class="code" href="structDCMotorConfig.html#a769099d666af120fa87c25a3f2bf8868" title="Default direction for select DC motor.">dir</a>;               
<a name="l00082"></a><a class="code" href="structDCMotorConfig.html#a683db311181d058c232bdbd23ee4ca81">00082</a>     <span class="keywordtype">bool</span> <a class="code" href="structDCMotorConfig.html#a683db311181d058c232bdbd23ee4ca81" title="If true the motor is braked when we turn off it.">braked</a>;            
<a name="l00083"></a>00083 
<a name="l00084"></a><a class="code" href="structDCMotorConfig.html#a59c9629aab42565a6e671af81f564537">00084</a>     <a class="code" href="dc__motor_8h.html#a1df3986d581c772f61532e1512d956fe" title="Type for DC motor.">dc_speed_t</a> <a class="code" href="structDCMotorConfig.html#a59c9629aab42565a6e671af81f564537" title="Default speed value for select DC motor.">speed</a>;       
<a name="l00085"></a>00085 
<a name="l00086"></a><a class="code" href="structDCMotorConfig.html#a05f306b4744265d1ab0d74d07e052ed3">00086</a>     <span class="keywordtype">int</span> <a class="code" href="structDCMotorConfig.html#a05f306b4744265d1ab0d74d07e052ed3" title="Index of the device where read speed, to disable set to DC_MOTOR_NO_DEV_SPEED.">speed_dev_id</a>;       
<a name="l00087"></a>00087 
<a name="l00088"></a>00088 } <a class="code" href="structDCMotorConfig.html" title="DC motor configuration stucture.">DCMotorConfig</a>;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 
<a name="l00094"></a><a class="code" href="structDCMotor.html">00094</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structDCMotor.html" title="Context structure for DC motor.">DCMotor</a>
<a name="l00095"></a>00095 {
<a name="l00096"></a>00096     <span class="keyword">const</span> <a class="code" href="structDCMotorConfig.html" title="DC motor configuration stucture.">DCMotorConfig</a> *cfg; <span class="comment">// All configuration for select DC motor.</span>
<a name="l00097"></a>00097     <a class="code" href="structPidContext.html" title="PID context structure.">PidContext</a> pid_ctx;       <span class="comment">// Pid control.</span>
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 <span class="preprocessor">#if !CFG_PWM_ENABLE_OLD_API</span>
<a name="l00100"></a>00100 <span class="preprocessor"></span>    <a class="code" href="structPwm.html" title="PWM context structure.">Pwm</a> pwm;                  <span class="comment">// Pwm context</span>
<a name="l00101"></a>00101 <span class="preprocessor">#endif</span>
<a name="l00102"></a>00102 <span class="preprocessor"></span>
<a name="l00103"></a>00103     <span class="keywordtype">int</span> index;                <span class="comment">// DC motor id.</span>
<a name="l00104"></a>00104     uint32_t status;          <span class="comment">// Status of select DC motor</span>
<a name="l00105"></a>00105     <a class="code" href="dc__motor_8h.html#a1df3986d581c772f61532e1512d956fe" title="Type for DC motor.">dc_speed_t</a> tgt_speed;     <span class="comment">// Target speed for select DC motor</span>
<a name="l00106"></a>00106 
<a name="l00107"></a>00107     <a class="code" href="compiler_8h.html#a9f2d272efa5f391ffc4b9ec4eb59fa88" title="Type for time expressed in ticks.">ticks_t</a> expire_time;      <span class="comment">// Amount of time that  dc motor run</span>
<a name="l00108"></a>00108 
<a name="l00109"></a>00109 } <a class="code" href="structDCMotor.html" title="Context structure for DC motor.">DCMotor</a>;
<a name="l00110"></a>00110 
<a name="l00111"></a>00111 <span class="keywordtype">void</span> <a class="code" href="dc__motor_8c.html#ae6da9a3fa5ccdf6e25f34d0ebd832d5e" title="Set spin direction of DC motor.">dc_motor_setDir</a>(<span class="keywordtype">int</span> index, <span class="keywordtype">bool</span> dir);
<a name="l00112"></a>00112 <span class="keywordtype">void</span> <a class="code" href="dc__motor_8c.html#aa24ea00e174985b4f0883aa660c26bb6" title="Enable or disable dc motor.">dc_motor_enable</a>(<span class="keywordtype">int</span> index, <span class="keywordtype">bool</span> state);
<a name="l00113"></a>00113 <span class="keywordtype">void</span> <a class="code" href="dc__motor_8c.html#a729b7d2ee9e96ea8e8a302907e205bdb" title="Set DC motor speed.">dc_motor_setSpeed</a>(<span class="keywordtype">int</span> index, <a class="code" href="dc__motor_8h.html#a1df3986d581c772f61532e1512d956fe" title="Type for DC motor.">dc_speed_t</a> speed);
<a name="l00114"></a>00114 <span class="keywordtype">void</span> <a class="code" href="dc__motor_8c.html#a630a290d843068374731c42361e3df60" title="Set among of time that dc motor should run.">dc_motor_startTimer</a>(<span class="keywordtype">int</span> index, <a class="code" href="compiler_8h.html#ac6f57181b1edf6b9b510c8a1a66201c1" title="Type for time expressed in milliseconds.">mtime_t</a> on_time);
<a name="l00115"></a>00115 <span class="keywordtype">void</span> dc_motor_waitStop(<span class="keywordtype">int</span> index);
<a name="l00116"></a>00116 <span class="keywordtype">void</span> <a class="code" href="dc__motor_8c.html#a7e9bc1dbb1fb17ebb0876c812ad3cebc" title="Apply a confinguration to select DC motor.">dc_motor_setup</a>(<span class="keywordtype">int</span> index, <a class="code" href="structDCMotorConfig.html" title="DC motor configuration stucture.">DCMotorConfig</a> *dcm_conf);
<a name="l00117"></a>00117 <a class="code" href="dc__motor_8h.html#a1df3986d581c772f61532e1512d956fe" title="Type for DC motor.">dc_speed_t</a> <a class="code" href="dc__motor_8c.html#a876301cead859ff75db3191f798d802d" title="Read the target speed from select device.">dc_motor_readTargetSpeed</a>(<span class="keywordtype">int</span> index);
<a name="l00118"></a>00118 <span class="keywordtype">void</span> <a class="code" href="dc__motor_8c.html#ad9a08b8c5ec90abd31a89fc772e3da97" title="If we had enabled the priority scheduling, we can adjust the DC motor poll process priority...">dc_motor_setPriority</a>(<span class="keywordtype">int</span> priority);
<a name="l00119"></a>00119 <span class="keywordtype">void</span> <a class="code" href="dc__motor_8c.html#a65e40de35ce11f560ed705c47c37dd84" title="Init DC motor.">dc_motor_init</a>(<span class="keywordtype">void</span>);
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 
<a name="l00127"></a>00127 <span class="keywordtype">int</span> <a class="code" href="dc__motor_8h.html#a9afe73223fd771b43d317748ef1aa91a" title="Test function prototypes.">dc_motor_testSetUp</a>(<span class="keywordtype">void</span>);
<a name="l00128"></a>00128 <span class="keywordtype">void</span> dc_motor_testRun(<span class="keywordtype">void</span>);
<a name="l00129"></a>00129 <span class="keywordtype">int</span> dc_motor_testTearDown(<span class="keywordtype">void</span>);
<a name="l00130"></a>00130 
<a name="l00131"></a>00131 <span class="preprocessor">#endif </span><span class="comment">/* DRV_DC_MOTOR_H */</span>
</pre></div></div>
</div>


