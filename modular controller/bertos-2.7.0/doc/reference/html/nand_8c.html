

<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_9fd71c1ac00056e7d855336b2291c56c.html">bertos</a>      </li>
      <li class="navelem"><a class="el" href="dir_f7c89dbd63e8f34e572fe939945c15d7.html">drv</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">nand.c File Reference</div>  </div>
</div>
<div class="contents">

<p>ONFI 1.0 compliant NAND kblock driver.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="nand_8h_source.html">nand.h</a>&quot;</code><br/>
<code>#include &lt;<a class="el" href="log_8h_source.html">cfg/log.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="heap_8h_source.html">struct/heap.h</a>&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
</div>
<p><a href="nand_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af2e90befdbbfe75a0cf34e09eb380c37"></a><!-- doxytag: member="nand.c::nand_blockErase" ref="af2e90befdbbfe75a0cf34e09eb380c37" args="(Nand *chip, uint16_t block)" -->
int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nand_8c.html#af2e90befdbbfe75a0cf34e09eb380c37">nand_blockErase</a> (<a class="el" href="structNand.html">Nand</a> *chip, uint16_t block)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Erase the whole block. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6f7cc3d0e8a27d2f665cf68d0639f381"></a><!-- doxytag: member="nand.c::nand_getDevId" ref="a6f7cc3d0e8a27d2f665cf68d0639f381" args="(Nand *chip, uint8_t dev_id[5])" -->
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nand_8c.html#a6f7cc3d0e8a27d2f665cf68d0639f381">nand_getDevId</a> (<a class="el" href="structNand.html">Nand</a> *chip, uint8_t dev_id[5])</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Read Device ID and configuration codes. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nand_8c.html#a44423986e2972887a6bc8af431bf3012">nand_format</a> (<a class="el" href="structNand.html">Nand</a> *chip)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Reset bad blocks map and erase all blocks.  <a href="#a44423986e2972887a6bc8af431bf3012"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aba7b59d0b1d12f5c51326d05e61e9fa1"></a><!-- doxytag: member="nand.c::nand_init" ref="aba7b59d0b1d12f5c51326d05e61e9fa1" args="(Nand *chip, struct Heap *heap, unsigned chip_select)" -->
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nand_8c.html#aba7b59d0b1d12f5c51326d05e61e9fa1">nand_init</a> (<a class="el" href="structNand.html">Nand</a> *chip, struct <a class="el" href="structHeap.html">Heap</a> *heap, unsigned chip_select)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize NAND kblock driver in buffered mode. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa29c1bd93915eed71f8632d261d6dec3"></a><!-- doxytag: member="nand.c::nand_initUnbuffered" ref="aa29c1bd93915eed71f8632d261d6dec3" args="(Nand *chip, struct Heap *heap, unsigned chip_select)" -->
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nand_8c.html#aa29c1bd93915eed71f8632d261d6dec3">nand_initUnbuffered</a> (<a class="el" href="structNand.html">Nand</a> *chip, struct <a class="el" href="structHeap.html">Heap</a> *heap, unsigned chip_select)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize NAND kblock driver in unbuffered mode. <br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>ONFI 1.0 compliant NAND kblock driver. </p>
<p>Defective blocks are remapped in a reserved area of configurable size at the bottom of the NAND. At the moment there is no wear-leveling block translation: kblock's blocks are mapped directly on NAND erase blocks: when a (k)block is written the corresponding erase block is erased and all pages within are rewritten. Partial write is not possible: it's recommended to use buffered mode.</p>
<p>The driver needs to format the NAND before use. If the initialization code detects a fresh memory it does a bad block scan and a formatting. Format info isn't stored in NAND in a global structure: each block has its info written in the spare area of its first page. These info contais a tag to detect formatted blocks and an index for bad block remapping (struct RemapInfo).</p>
<p>The ECC for each page is written in the spare area too.</p>
<p>Works only in 8 bit data mode and NAND parameters are not detected at run-time, but hand-configured in <a class="el" href="cfg__nand_8h.html" title="Configuration file for NAND driver module.">cfg_nand.h</a>.</p>
<p><a class="el" href="structHeap.html" title="A heap.">Heap</a> is needed to allocate the tipically large buffer necessary to erase and write a block.</p>
<dl class="author"><dt><b>Author:</b></dt><dd>Stefano Fedrigo &lt;<a href="mailto:aleph@develer.com">aleph@develer.com</a>&gt; </dd></dl>

<p>Definition in file <a class="el" href="nand_8c_source.html">nand.c</a>.</p>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="a44423986e2972887a6bc8af431bf3012"></a><!-- doxytag: member="nand.c::nand_format" ref="a44423986e2972887a6bc8af431bf3012" args="(Nand *chip)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nand_format </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structNand.html">Nand</a> *&#160;</td>
          <td class="paramname"><em>chip</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Reset bad blocks map and erase all blocks. </p>
<dl class="note"><dt><b>Note:</b></dt><dd>DON'T USE on production chips: this function will try to erase factory marked bad blocks too. </dd></dl>

<p>Definition at line <a class="el" href="nand_8c_source.html#l00511">511</a> of file <a class="el" href="nand_8c_source.html">nand.c</a>.</p>

</div>
</div>
</div>


