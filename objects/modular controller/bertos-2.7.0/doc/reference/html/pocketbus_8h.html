

<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_9fd71c1ac00056e7d855336b2291c56c.html">bertos</a>      </li>
      <li class="navelem"><a class="el" href="dir_e91c80130e425b11d52da5b92a7aa933.html">net</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#typedef-members">Typedefs</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">pocketbus.h File Reference</div>  </div>
</div>
<div class="contents">

<p>Basical functions to use pocketBus protocol.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="cfg__pocketbus_8h_source.html">cfg/cfg_pocketbus.h</a>&quot;</code><br/>
<code>#include &lt;<a class="el" href="compiler_8h_source.html">cfg/compiler.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="rotating__hash_8h_source.html">algo/rotating_hash.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="io_2kfile_8h_source.html">io/kfile.h</a>&gt;</code><br/>
</div>
<p><a href="pocketbus_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structPocketBusHdr.html">PocketBusHdr</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Header of pocketBus messages.  <a href="structPocketBusHdr.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structPocketBusCtx.html">PocketBusCtx</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">pocketBus context structure.  <a href="structPocketBusCtx.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structPocketMsg.html">PocketMsg</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure holding pocketBus message parameters.  <a href="structPocketMsg.html#details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aea1074099c8e42817e64e1a249d073e1"></a><!-- doxytag: member="pocketbus.h::POCKETBUS_BROADCAST_ADDR" ref="aea1074099c8e42817e64e1a249d073e1" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pocketbus_8h.html#aea1074099c8e42817e64e1a249d073e1">POCKETBUS_BROADCAST_ADDR</a>&#160;&#160;&#160;0xFFFF</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">pocketBus broadcast address <br/></td></tr>
<tr><td colspan="2"><div class="groupHeader"></div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2f2189c4c3d45ced8701224d970013c2"></a><!-- doxytag: member="pocketbus.h::POCKETBUS_STX" ref="a2f2189c4c3d45ced8701224d970013c2" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pocketbus_8h.html#a2f2189c4c3d45ced8701224d970013c2">POCKETBUS_STX</a>&#160;&#160;&#160;0x02</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">pocketBus special characters definitions. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aec6c2bc5f1440007c1d459972fed5a3e"></a><!-- doxytag: member="pocketbus.h::POCKETBUS_ETX" ref="aec6c2bc5f1440007c1d459972fed5a3e" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pocketbus_8h.html#aec6c2bc5f1440007c1d459972fed5a3e">POCKETBUS_ETX</a>&#160;&#160;&#160;0x03</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">pocketBus special characters definitions. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae8d63dbc87418d7ab43cc2164f4c5e9c"></a><!-- doxytag: member="pocketbus.h::POCKETBUS_ESC" ref="ae8d63dbc87418d7ab43cc2164f4c5e9c" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pocketbus_8h.html#ae8d63dbc87418d7ab43cc2164f4c5e9c">POCKETBUS_ESC</a>&#160;&#160;&#160;0x1B</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">pocketBus special characters definitions. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a00176121fe536f0d8a3881eb3498cabd"></a><!-- doxytag: member="pocketbus.h::POCKETBUS_ACK" ref="a00176121fe536f0d8a3881eb3498cabd" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pocketbus_8h.html#a00176121fe536f0d8a3881eb3498cabd">POCKETBUS_ACK</a>&#160;&#160;&#160;0x06</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">pocketBus special characters definitions. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a88fc41cd0e88eb505d4163e161113a81"></a><!-- doxytag: member="pocketbus.h::POCKETBUS_NAK" ref="a88fc41cd0e88eb505d4163e161113a81" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pocketbus_8h.html#a88fc41cd0e88eb505d4163e161113a81">POCKETBUS_NAK</a>&#160;&#160;&#160;0x15</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">pocketBus special characters definitions. <br/></td></tr>
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a8c6d1bda67f65a44ce69c9ef0b75c55e"></a><!-- doxytag: member="pocketbus.h::pocketbus_len_t" ref="a8c6d1bda67f65a44ce69c9ef0b75c55e" args="" -->
typedef uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pocketbus_8h.html#a8c6d1bda67f65a44ce69c9ef0b75c55e">pocketbus_len_t</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Type for pocketBus length. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af63b5ecec3f1a8ffaf7d711181392dec"></a><!-- doxytag: member="pocketbus.h::pocketbus_addr_t" ref="af63b5ecec3f1a8ffaf7d711181392dec" args="" -->
typedef uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pocketbus_8h.html#af63b5ecec3f1a8ffaf7d711181392dec">pocketbus_addr_t</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Type for pocketBus addresses. <br/></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae6a9a07114695dc497be7a9d19dfc153"></a><!-- doxytag: member="pocketbus.h::pocketbus_putchar" ref="ae6a9a07114695dc497be7a9d19dfc153" args="(struct PocketBusCtx *ctx, uint8_t c)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pocketbus_8h.html#ae6a9a07114695dc497be7a9d19dfc153">pocketbus_putchar</a> (struct <a class="el" href="structPocketBusCtx.html">PocketBusCtx</a> *ctx, uint8_t c)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a character over pocketBus channel stream, handling escape mode. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9e64fea54236836ebbb111188a386213"></a><!-- doxytag: member="pocketbus.h::pocketbus_begin" ref="a9e64fea54236836ebbb111188a386213" args="(struct PocketBusCtx *ctx, pocketbus_addr_t addr)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pocketbus_8h.html#a9e64fea54236836ebbb111188a386213">pocketbus_begin</a> (struct <a class="el" href="structPocketBusCtx.html">PocketBusCtx</a> *ctx, <a class="el" href="pocketbus_8h.html#af63b5ecec3f1a8ffaf7d711181392dec">pocketbus_addr_t</a> addr)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Send pocketBus packet header. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9589e76fc410f9fed1b25807baf8ba6d"></a><!-- doxytag: member="pocketbus.h::pocketbus_write" ref="a9589e76fc410f9fed1b25807baf8ba6d" args="(struct PocketBusCtx *ctx, const void *_data, size_t len)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pocketbus_8h.html#a9589e76fc410f9fed1b25807baf8ba6d">pocketbus_write</a> (struct <a class="el" href="structPocketBusCtx.html">PocketBusCtx</a> *ctx, const void *_data, size_t len)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Send buffer <em>_data</em> over bus, handling escape. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ac87ef3191ab444e8a02abd7819a7d068"></a><!-- doxytag: member="pocketbus.h::pocketbus_end" ref="ac87ef3191ab444e8a02abd7819a7d068" args="(struct PocketBusCtx *ctx)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pocketbus_8h.html#ac87ef3191ab444e8a02abd7819a7d068">pocketbus_end</a> (struct <a class="el" href="structPocketBusCtx.html">PocketBusCtx</a> *ctx)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Send pocketBus packet tail. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="afd291395155722155fc63cd63a0e1b15"></a><!-- doxytag: member="pocketbus.h::pocketbus_send" ref="afd291395155722155fc63cd63a0e1b15" args="(struct PocketBusCtx *ctx, pocketbus_addr_t addr, const void *data, size_t len)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pocketbus_8h.html#afd291395155722155fc63cd63a0e1b15">pocketbus_send</a> (struct <a class="el" href="structPocketBusCtx.html">PocketBusCtx</a> *ctx, <a class="el" href="pocketbus_8h.html#af63b5ecec3f1a8ffaf7d711181392dec">pocketbus_addr_t</a> addr, const void *data, size_t len)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Send buffer of <em>data</em> to address <em>addr</em> with a pocketBus packet over channel stream. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pocketbus_8h.html#ab5c6bf4b8545d77f30c6f92f97684106">pocketbus_recv</a> (struct <a class="el" href="structPocketBusCtx.html">PocketBusCtx</a> *ctx, struct <a class="el" href="structPocketMsg.html">PocketMsg</a> *msg)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Try to read a packet from the pocketBus.  <a href="#ab5c6bf4b8545d77f30c6f92f97684106"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a35e365a7ea36ce352e9895d01d81b8a8"></a><!-- doxytag: member="pocketbus.h::pocketbus_init" ref="a35e365a7ea36ce352e9895d01d81b8a8" args="(struct PocketBusCtx *ctx, struct KFile *fd)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pocketbus_8h.html#a35e365a7ea36ce352e9895d01d81b8a8">pocketbus_init</a> (struct <a class="el" href="structPocketBusCtx.html">PocketBusCtx</a> *ctx, struct <a class="el" href="structKFile.html">KFile</a> *fd)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize pocketBus protocol handler. <br/></td></tr>
<tr><td colspan="2"><div class="groupHeader"></div></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a87d02266d158c9833c2346fae9e216f7"></a><!-- doxytag: member="pocketbus.h::STATIC_ASSERT" ref="a87d02266d158c9833c2346fae9e216f7" args="(sizeof(pocketbus_addr_t)==sizeof(uint16_t))" -->
&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="pocketbus_8h.html#a87d02266d158c9833c2346fae9e216f7">STATIC_ASSERT</a> (sizeof(<a class="el" href="pocketbus_8h.html#af63b5ecec3f1a8ffaf7d711181392dec">pocketbus_addr_t</a>)==sizeof(uint16_t))</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">This ensure that endianess convertion functions work on the right data size. <br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Basical functions to use pocketBus protocol. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Francesco Sacchi &lt;<a href="mailto:batt@develer.com">batt@develer.com</a>&gt; </dd></dl>

<p>Definition in file <a class="el" href="pocketbus_8h_source.html">pocketbus.h</a>.</p>
</div><hr/><h2>Function Documentation</h2>
<a class="anchor" id="ab5c6bf4b8545d77f30c6f92f97684106"></a><!-- doxytag: member="pocketbus.h::pocketbus_recv" ref="ab5c6bf4b8545d77f30c6f92f97684106" args="(struct PocketBusCtx *ctx, struct PocketMsg *msg)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool pocketbus_recv </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structPocketBusCtx.html">PocketBusCtx</a> *&#160;</td>
          <td class="paramname"><em>ctx</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structPocketMsg.html">PocketMsg</a> *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Try to read a packet from the pocketBus. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>true if a packet is received, false otherwise. </dd></dl>

<p>Definition at line <a class="el" href="pocketbus_8c_source.html#l00171">171</a> of file <a class="el" href="pocketbus_8c_source.html">pocketbus.c</a>.</p>

</div>
</div>
</div>


