

<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_9fd71c1ac00056e7d855336b2291c56c.html">bertos</a>      </li>
      <li class="navelem"><a class="el" href="dir_e91c80130e425b11d52da5b92a7aa933.html">net</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">afsk.h</div>  </div>
</div>
<div class="contents">
<a href="afsk_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00043"></a>00043 <span class="preprocessor">#ifndef NET_AFSK_H</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span><span class="preprocessor">#define NET_AFSK_H</span>
<a name="l00045"></a>00045 <span class="preprocessor"></span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &quot;<a class="code" href="cfg__afsk_8h.html" title="Configuration file for AFSK1200 modem.">cfg/cfg_afsk.h</a>&quot;</span>
<a name="l00047"></a>00047 <span class="preprocessor">#include &quot;<a class="code" href="hw__afsk_8h.html" title="AFSK modem hardware-specific definitions.">hw/hw_afsk.h</a>&quot;</span>
<a name="l00048"></a>00048 
<a name="l00049"></a>00049 <span class="preprocessor">#include &lt;<a class="code" href="compiler_8h.html" title="Additional support macros for compiler independance.">cfg/compiler.h</a>&gt;</span>
<a name="l00050"></a>00050 
<a name="l00051"></a>00051 <span class="preprocessor">#include &lt;<a class="code" href="io_2kfile_8h.html">io/kfile.h</a>&gt;</span>
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="preprocessor">#include &lt;<a class="code" href="fifobuf_8h.html">struct/fifobuf.h</a>&gt;</span>
<a name="l00054"></a>00054 
<a name="l00055"></a>00055 
<a name="l00056"></a>00056 
<a name="l00062"></a><a class="code" href="afsk_8h.html#a538e0cad3acb787a49e16b1e53787610">00062</a> <span class="preprocessor">#define SAMPLERATE 9600</span>
<a name="l00063"></a>00063 <span class="preprocessor"></span>
<a name="l00069"></a><a class="code" href="afsk_8h.html#a17468d10f0c67a4ee7b38aab09d9e096">00069</a> <span class="preprocessor">#define BITRATE    1200</span>
<a name="l00070"></a>00070 <span class="preprocessor"></span>
<a name="l00071"></a>00071 <span class="preprocessor">#define SAMPLEPERBIT (SAMPLERATE / BITRATE)</span>
<a name="l00072"></a>00072 <span class="preprocessor"></span>
<a name="l00077"></a><a class="code" href="structHdlc.html">00077</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structHdlc.html" title="HDLC (High-Level Data Link Control) context.">Hdlc</a>
<a name="l00078"></a>00078 {
<a name="l00079"></a><a class="code" href="structHdlc.html#af84ca3a42c17864225b7c01394b542d0">00079</a>     uint8_t <a class="code" href="structHdlc.html#af84ca3a42c17864225b7c01394b542d0" title="Bitstream from the demodulator.">demod_bits</a>; 
<a name="l00080"></a><a class="code" href="structHdlc.html#ae652585b47e13affcd4eafa4bf88c5da">00080</a>     uint8_t <a class="code" href="structHdlc.html#ae652585b47e13affcd4eafa4bf88c5da" title="Current received bit.">bit_idx</a>;    
<a name="l00081"></a><a class="code" href="structHdlc.html#a4ff60b1275a400e4d7644c77ebaf0558">00081</a>     uint8_t <a class="code" href="structHdlc.html#a4ff60b1275a400e4d7644c77ebaf0558" title="Current received character.">currchar</a>;   
<a name="l00082"></a><a class="code" href="structHdlc.html#ae875f34472fc23e17d4d9fd86f11e566">00082</a>     <span class="keywordtype">bool</span> <a class="code" href="structHdlc.html#ae875f34472fc23e17d4d9fd86f11e566" title="True if an HDLC_FLAG char has been found in the bitstream.">rxstart</a>;       
<a name="l00083"></a>00083 } <a class="code" href="structHdlc.html" title="HDLC (High-Level Data Link Control) context.">Hdlc</a>;
<a name="l00084"></a>00084 
<a name="l00088"></a><a class="code" href="afsk_8h.html#abc27e633a81969b007bf9c4ebd71c380">00088</a> <span class="preprocessor">#define AFSK_RXFIFO_OVERRUN BV(0)</span>
<a name="l00089"></a>00089 <span class="preprocessor"></span>
<a name="l00093"></a><a class="code" href="structAfsk.html">00093</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structAfsk.html" title="AFSK1200 modem context.">Afsk</a>
<a name="l00094"></a>00094 {
<a name="l00096"></a><a class="code" href="structAfsk.html#a400e243f28952b2b2f887a7f783dbe41">00096</a>     <a class="code" href="structKFile.html" title="Context data for callback functions which operate on pseudo files.">KFile</a> <a class="code" href="structAfsk.html#a400e243f28952b2b2f887a7f783dbe41" title="Base &quot;class&quot;.">fd</a>;
<a name="l00097"></a>00097 
<a name="l00099"></a><a class="code" href="structAfsk.html#a87ffdb2908a82024359e4370daceba20">00099</a>     <span class="keywordtype">int</span> <a class="code" href="structAfsk.html#a87ffdb2908a82024359e4370daceba20" title="ADC channel to be used by the demodulator.">adc_ch</a>;
<a name="l00100"></a>00100 
<a name="l00102"></a><a class="code" href="structAfsk.html#a2c9534024bfe0b337f7b4393205861a1">00102</a>     <span class="keywordtype">int</span> <a class="code" href="structAfsk.html#a2c9534024bfe0b337f7b4393205861a1" title="DAC channel to be used by the modulator.">dac_ch</a>;
<a name="l00103"></a>00103 
<a name="l00105"></a><a class="code" href="structAfsk.html#a8f44f065777e87c39a166cb35cb65423">00105</a>     uint8_t <a class="code" href="structAfsk.html#a8f44f065777e87c39a166cb35cb65423" title="Current sample of bit for output data.">sample_count</a>;
<a name="l00106"></a>00106 
<a name="l00108"></a><a class="code" href="structAfsk.html#aab381825bf84dfbd8dd257668afe6f87">00108</a>     uint8_t <a class="code" href="structAfsk.html#aab381825bf84dfbd8dd257668afe6f87" title="Current character to be modulated.">curr_out</a>;
<a name="l00109"></a>00109 
<a name="l00111"></a><a class="code" href="structAfsk.html#a52749b0074acb4796cee6f42cd973d32">00111</a>     uint8_t <a class="code" href="structAfsk.html#a52749b0074acb4796cee6f42cd973d32" title="Mask of current modulated bit.">tx_bit</a>;
<a name="l00112"></a>00112 
<a name="l00114"></a><a class="code" href="structAfsk.html#a0aa86a2b90706f920162093a573e08f8">00114</a>     <span class="keywordtype">bool</span> <a class="code" href="structAfsk.html#a0aa86a2b90706f920162093a573e08f8" title="True if bit stuff is allowed, false otherwise.">bit_stuff</a>;
<a name="l00115"></a>00115 
<a name="l00117"></a><a class="code" href="structAfsk.html#ac00a531d67d24264b3562d1734d73dc8">00117</a>     uint8_t <a class="code" href="structAfsk.html#ac00a531d67d24264b3562d1734d73dc8" title="Counter for bit stuffing.">stuff_cnt</a>;
<a name="l00121"></a><a class="code" href="structAfsk.html#a4d41b4801cd66792aeb5138c8161b7ed">00121</a>     uint16_t <a class="code" href="structAfsk.html#a4d41b4801cd66792aeb5138c8161b7ed" title="DDS phase accumulator for generating modulated data.">phase_acc</a>;
<a name="l00122"></a>00122 
<a name="l00124"></a><a class="code" href="structAfsk.html#a7f5dfd46245eae82247bac8318dde2ce">00124</a>     uint16_t <a class="code" href="structAfsk.html#a7f5dfd46245eae82247bac8318dde2ce" title="Current phase increment for current modulated bit.">phase_inc</a>;
<a name="l00125"></a>00125 
<a name="l00127"></a><a class="code" href="structAfsk.html#a23cfc1d161728b380d82ff7e415a7ea6">00127</a>     FIFOBuffer <a class="code" href="structAfsk.html#a23cfc1d161728b380d82ff7e415a7ea6" title="Delay line used to delay samples by (SAMPLEPERBIT / 2)">delay_fifo</a>;
<a name="l00128"></a>00128 
<a name="l00134"></a><a class="code" href="structAfsk.html#a084d32d045b018c29080f85bc02fa91d">00134</a>     int8_t <a class="code" href="structAfsk.html#a084d32d045b018c29080f85bc02fa91d" title="Buffer for delay FIFO.">delay_buf</a>[SAMPLEPERBIT / 2 + 1];
<a name="l00135"></a>00135 
<a name="l00137"></a><a class="code" href="structAfsk.html#ab25b3bb05ad0a3a7c596ab024ebb09d8">00137</a>     FIFOBuffer <a class="code" href="structAfsk.html#ab25b3bb05ad0a3a7c596ab024ebb09d8" title="FIFO for received data.">rx_fifo</a>;
<a name="l00138"></a>00138 
<a name="l00140"></a><a class="code" href="structAfsk.html#a512a4e4393c8c84e226e77867a159e94">00140</a>     uint8_t <a class="code" href="structAfsk.html#a512a4e4393c8c84e226e77867a159e94" title="FIFO rx buffer.">rx_buf</a>[<a class="code" href="cfg__afsk_8h.html#adb056877043b2fcf1477cf3a69bb89a6" title="AFSK receiver buffer length.">CONFIG_AFSK_RX_BUFLEN</a>];
<a name="l00141"></a>00141 
<a name="l00143"></a><a class="code" href="structAfsk.html#a0db16217ec44719e2fd9fd77a5732892">00143</a>     FIFOBuffer <a class="code" href="structAfsk.html#a0db16217ec44719e2fd9fd77a5732892" title="FIFO for transmitted data.">tx_fifo</a>;
<a name="l00144"></a>00144 
<a name="l00146"></a><a class="code" href="structAfsk.html#a289a5ac353f6510ae2f5c9cad498490e">00146</a>     uint8_t <a class="code" href="structAfsk.html#a289a5ac353f6510ae2f5c9cad498490e" title="FIFO tx buffer.">tx_buf</a>[<a class="code" href="cfg__afsk_8h.html#adc5f6ad59595e8b2c14827f5012c6f4f" title="AFSK transimtter buffer length.">CONFIG_AFSK_TX_BUFLEN</a>];
<a name="l00147"></a>00147 
<a name="l00149"></a><a class="code" href="structAfsk.html#a6de280e20518b46307cf5924c66d3f0d">00149</a>     int16_t <a class="code" href="structAfsk.html#a6de280e20518b46307cf5924c66d3f0d" title="IIR filter X cells, used to filter sampled data by the demodulator.">iir_x</a>[2];
<a name="l00150"></a>00150 
<a name="l00152"></a><a class="code" href="structAfsk.html#a12544e43f0190a76fa96d7fac1508dd4">00152</a>     int16_t <a class="code" href="structAfsk.html#a12544e43f0190a76fa96d7fac1508dd4" title="IIR filter Y cells, used to filter sampled data by the demodulator.">iir_y</a>[2];
<a name="l00153"></a>00153 
<a name="l00159"></a><a class="code" href="structAfsk.html#a61024d1d2383df2eec0118324cfa1a05">00159</a>     uint8_t <a class="code" href="structAfsk.html#a61024d1d2383df2eec0118324cfa1a05" title="Bits sampled by the demodulator are here.">sampled_bits</a>;
<a name="l00160"></a>00160 
<a name="l00165"></a><a class="code" href="structAfsk.html#ac60905ae0ab33501bb597b7c66b9331b">00165</a>     int8_t <a class="code" href="structAfsk.html#ac60905ae0ab33501bb597b7c66b9331b" title="Current phase, needed to know when the bitstream at ADC speed should be sampled.">curr_phase</a>;
<a name="l00166"></a>00166 
<a name="l00168"></a><a class="code" href="structAfsk.html#a705350e2701cb501e6520c427f002d52">00168</a>     uint8_t <a class="code" href="structAfsk.html#a705350e2701cb501e6520c427f002d52" title="Bits found by the demodulator at the correct bitrate speed.">found_bits</a>;
<a name="l00169"></a>00169 
<a name="l00171"></a><a class="code" href="structAfsk.html#aea4204b922aaf2c78708bacec08d7888">00171</a>     <span class="keyword">volatile</span> <span class="keywordtype">bool</span> <a class="code" href="structAfsk.html#aea4204b922aaf2c78708bacec08d7888" title="True while modem sends data.">sending</a>;
<a name="l00172"></a>00172 
<a name="l00177"></a><a class="code" href="structAfsk.html#a4b90678865e08c02384199c6b10aa5b5">00177</a>     <span class="keyword">volatile</span> <span class="keywordtype">int</span> <a class="code" href="structAfsk.html#a4b90678865e08c02384199c6b10aa5b5" title="AFSK modem status.">status</a>;
<a name="l00178"></a>00178 
<a name="l00180"></a><a class="code" href="structAfsk.html#a0f2cf84d5882a74b33b54828e4adda6d">00180</a>     <a class="code" href="structHdlc.html" title="HDLC (High-Level Data Link Control) context.">Hdlc</a> <a class="code" href="structAfsk.html#a0f2cf84d5882a74b33b54828e4adda6d" title="Hdlc context.">hdlc</a>;
<a name="l00181"></a>00181 
<a name="l00188"></a><a class="code" href="structAfsk.html#ae4e1603bf1a13861e017921e135ca3af">00188</a>     uint16_t <a class="code" href="structAfsk.html#ae4e1603bf1a13861e017921e135ca3af" title="Preamble length.">preamble_len</a>;
<a name="l00189"></a>00189 
<a name="l00196"></a><a class="code" href="structAfsk.html#a1cffeb9e88165ac3689271b970b5aab3">00196</a>     uint16_t <a class="code" href="structAfsk.html#a1cffeb9e88165ac3689271b970b5aab3" title="Trailer length.">trailer_len</a>;
<a name="l00197"></a>00197 } <a class="code" href="structAfsk.html" title="AFSK1200 modem context.">Afsk</a>;
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 <span class="preprocessor">#define KFT_AFSK MAKE_ID(&#39;A&#39;, &#39;F&#39;, &#39;S&#39;, &#39;K&#39;)</span>
<a name="l00200"></a>00200 <span class="preprocessor"></span>
<a name="l00201"></a>00201 INLINE <a class="code" href="structAfsk.html" title="AFSK1200 modem context.">Afsk</a> *AFSK_CAST(<a class="code" href="structKFile.html" title="Context data for callback functions which operate on pseudo files.">KFile</a> *fd)
<a name="l00202"></a>00202 {
<a name="l00203"></a>00203   <a class="code" href="group__debug.html#gaca68c0d4ac8df0838e209fb5300f7be3" title="Assert a pre-condition on code.">ASSERT</a>(fd-&gt;_type == KFT_AFSK);
<a name="l00204"></a>00204   <span class="keywordflow">return</span> (<a class="code" href="structAfsk.html" title="AFSK1200 modem context.">Afsk</a> *)fd;
<a name="l00205"></a>00205 }
<a name="l00206"></a>00206 
<a name="l00207"></a>00207 
<a name="l00208"></a>00208 <span class="keywordtype">void</span> <a class="code" href="afsk_8c.html#a6e7a76ef4090f84faef32c36d5212818" title="ADC ISR callback.">afsk_adc_isr</a>(<a class="code" href="structAfsk.html" title="AFSK1200 modem context.">Afsk</a> *af, int8_t sample);
<a name="l00209"></a>00209 uint8_t <a class="code" href="afsk_8c.html#a3930063ec9d82dd3e4ede9b51bfe05b8" title="DAC ISR callback.">afsk_dac_isr</a>(<a class="code" href="structAfsk.html" title="AFSK1200 modem context.">Afsk</a> *af);
<a name="l00210"></a>00210 <span class="keywordtype">void</span> <a class="code" href="afsk_8c.html#adeb64b951e0db5f70d574a525ddbb1da" title="Initialize an AFSK1200 modem.">afsk_init</a>(<a class="code" href="structAfsk.html" title="AFSK1200 modem context.">Afsk</a> *af, <span class="keywordtype">int</span> adc_ch, <span class="keywordtype">int</span> dac_ch);
<a name="l00211"></a>00211 
<a name="l00212"></a>00212 
<a name="l00218"></a>00218 <span class="preprocessor">#define AFSK_BUTTERWORTH  0</span>
<a name="l00219"></a>00219 <span class="preprocessor"></span><span class="preprocessor">#define AFSK_CHEBYSHEV    1</span>
<a name="l00220"></a>00220 <span class="preprocessor"></span><span class="comment">/* \} */</span>
<a name="l00221"></a>00221 
<a name="l00222"></a>00222 <span class="keywordtype">int</span> afsk_testSetup(<span class="keywordtype">void</span>);
<a name="l00223"></a>00223 <span class="keywordtype">int</span> afsk_testRun(<span class="keywordtype">void</span>);
<a name="l00224"></a>00224 <span class="keywordtype">int</span> afsk_testTearDown(<span class="keywordtype">void</span>);
<a name="l00225"></a>00225 
<a name="l00226"></a>00226 <span class="preprocessor">#endif </span><span class="comment">/* NET_AFSK_H */</span>
</pre></div></div>
</div>


