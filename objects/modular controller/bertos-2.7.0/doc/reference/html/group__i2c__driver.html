

<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#groups">Modules</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">I2C driver</div>  </div>
<div class="ingroups"><a class="el" href="group__drivers.html">BeRTOS peripherals drivers</a></div></div>
<div class="contents">

<p>I2C generic driver functions.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="groups"></a>
Modules</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__i2c__api.html">I2C driver API</a></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__old__i2c__api.html">Old I2C API</a></td></tr>

<p><tr><td class="mdescLeft">&#160;</td><td class="mdescRight"><p>This is the old and deprecated I2C API. </p>
<br/></td></tr>
</p>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="group__i2c__driver.html#ga960fa6e5280e7d39dc862b648d7442c9">i2c_init_0</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize I2C module (old API).  <a href="#ga960fa6e5280e7d39dc862b648d7442c9"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="member-group"></a>
I2C bitbang devices enum</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ , <a class="el" href="group__i2c__driver.html#ggaac34dfe6c6b73b43a4656c9dce041034afcb4b0419e80c6313cdcaee93878e427">I2C_BITBANG0</a> =  1000, 
<a class="el" href="group__i2c__driver.html#ggaac34dfe6c6b73b43a4656c9dce041034a650781386ac8ad2bcba6b0095864a5fa">I2C_BITBANG1</a>
, <a class="el" href="group__i2c__driver.html#ggaac34dfe6c6b73b43a4656c9dce041034a1f0dbe3eedeea4df0b678e021bd3fb5e">I2C_BITBANG_CNT</a>
 }</td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<p>I2C generic driver functions. </p>
<p>Some hardware requires you to declare the number of transferred bytes and the communication direction before actually reading or writing to the bus. Furthermore, sometimes you need to specify the first transferred byte before any data is sent over the bus.</p>
<p>The usage pattern for writing is the following: </p>
<div class="fragment"><pre class="fragment"> <a class="code" href="group__i2c__api.html#gac614d06053727a7216dcfb902de3eb1d" title="Initialize I2C module.">i2c_init</a>(args...);
 ...
 <a class="code" href="group__i2c__api.html#ga8686744c1c2d8192acb6ef020f365b4b" title="Start a write session.">i2c_start_w</a>(args...);
 <a class="code" href="group__i2c__api.html#ga553963577b3d47170e100c0f68440e98" title="Write count bytes to port i2c, reading from _buf.">i2c_write</a>(i2c, buf, len);
</pre></div><p> The flags in i2c_start_w determine if the stop command is sent after the data. Notice that you don't need to explicitly call a stop function after the write.</p>
<p>Reading is a bit more complicated and it largely depends on the specific slave hardware. In general, the hardware may require you to first write something, then read the data without closing the communication. For example, EPROMs require first to write the reading address and then to read the actual data. Here is an example of how you can deal with such hardware:</p>
<div class="fragment"><pre class="fragment"> <span class="comment">// init a session without closing it</span>
 <a class="code" href="group__i2c__api.html#ga8686744c1c2d8192acb6ef020f365b4b" title="Start a write session.">i2c_start_w</a>(i2c, dev, bytes, <a class="code" href="group__i2c__api.html#gae7450a4ba0cc321d2581194c4387583b" title="Do not program the stop for current transition.">I2C_NOSTOP</a>);
 <span class="comment">// write the address to read from</span>
 <a class="code" href="group__i2c__api.html#ga553963577b3d47170e100c0f68440e98" title="Write count bytes to port i2c, reading from _buf.">i2c_write</a>(i2c, addr, bytes);
 <span class="keywordflow">if</span> (<a class="code" href="group__i2c__api.html#gaaa3a74fe2c10ac8d2e3bae4a4953ca1c" title="Return the error condition of the bus and clear errors.">i2c_error</a>(i2c))
     <span class="comment">// check for errors during setup</span>
     <span class="comment">//...</span>
 <span class="comment">// now start the real data transfer</span>
 <a class="code" href="group__i2c__api.html#ga3dc5a80d3c99017cb9d836b6a5269846" title="Start a read session.">i2c_start_r</a>(i2c, dev, bytes, <a class="code" href="group__i2c__api.html#gae97924b7877c5f26955e82ab97470b95" title="Program the stop for current transition.">I2C_STOP</a>);
 <a class="code" href="group__i2c__api.html#gaccd847c1d760696963dae9273533d125" title="Read count bytes into buffer _buf from device i2c.">i2c_read</a>(i2c, buf, bytes);
 <span class="comment">// check for errors</span>
 <span class="keywordflow">if</span> (<a class="code" href="group__i2c__api.html#gaaa3a74fe2c10ac8d2e3bae4a4953ca1c" title="Return the error condition of the bus and clear errors.">i2c_error</a>(i2c))
     <span class="comment">//...</span>
</pre></div><p>It's not guaranteed that after a single call to i2c_putc, i2c_getc etc. data will pass on the bus (this is hardware dependent). However, it IS guaranteed after you have sent all the data.</p>
<p>You can check error conditions by calling the function i2c_error after each function call. (This is similar to libc errno handling).</p>
<dl class="author"><dt><b>Author:</b></dt><dd>Francesco Sacchi &lt;<a href="mailto:batt@develer.com">batt@develer.com</a>&gt; </dd></dl>
<hr/><h2>Enumeration Type Documentation</h2>
<a class="anchor" id="gaac34dfe6c6b73b43a4656c9dce041034"></a><!-- doxytag: member="i2c.h::@29" ref="gaac34dfe6c6b73b43a4656c9dce041034" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">anonymous enum</td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl><dt><b>Enumerator: </b></dt><dd><table border="0" cellspacing="2" cellpadding="0">
<tr><td valign="top"><em><a class="anchor" id="ggaac34dfe6c6b73b43a4656c9dce041034afcb4b0419e80c6313cdcaee93878e427"></a><!-- doxytag: member="I2C_BITBANG0" ref="ggaac34dfe6c6b73b43a4656c9dce041034afcb4b0419e80c6313cdcaee93878e427" args="" -->I2C_BITBANG0</em>&nbsp;</td><td>
<p>Use bitbang on port 0. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ggaac34dfe6c6b73b43a4656c9dce041034a650781386ac8ad2bcba6b0095864a5fa"></a><!-- doxytag: member="I2C_BITBANG1" ref="ggaac34dfe6c6b73b43a4656c9dce041034a650781386ac8ad2bcba6b0095864a5fa" args="" -->I2C_BITBANG1</em>&nbsp;</td><td>
<p>Use bitbang on port 1. </p>
</td></tr>
<tr><td valign="top"><em><a class="anchor" id="ggaac34dfe6c6b73b43a4656c9dce041034a1f0dbe3eedeea4df0b678e021bd3fb5e"></a><!-- doxytag: member="I2C_BITBANG_CNT" ref="ggaac34dfe6c6b73b43a4656c9dce041034a1f0dbe3eedeea4df0b678e021bd3fb5e" args="" -->I2C_BITBANG_CNT</em>&nbsp;</td><td>
<p>Number of i2c ports. </p>
</td></tr>
</table>
</dd>
</dl>

<p>Definition at line <a class="el" href="i2c_8h_source.html#l00184">184</a> of file <a class="el" href="i2c_8h_source.html">i2c.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="ga960fa6e5280e7d39dc862b648d7442c9"></a><!-- doxytag: member="i2c.h::i2c_init_0" ref="ga960fa6e5280e7d39dc862b648d7442c9" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void i2c_init_0 </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize I2C module (old API). </p>
<dl class="attention"><dt><b>Attention:</b></dt><dd>This function is deprecated. Use i2c_init(args...) in new code </dd></dl>

<p>Definition at line <a class="el" href="i2c_8h_source.html#l00532">532</a> of file <a class="el" href="i2c_8h_source.html">i2c.h</a>.</p>

</div>
</div>
</div>


