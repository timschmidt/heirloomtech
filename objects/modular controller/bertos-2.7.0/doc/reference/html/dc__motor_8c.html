

<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_9fd71c1ac00056e7d855336b2291c56c.html">bertos</a>      </li>
      <li class="navelem"><a class="el" href="dir_f7c89dbd63e8f34e572fe939945c15d7.html">drv</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#define-members">Defines</a> &#124;
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">dc_motor.c File Reference</div>  </div>
</div>
<div class="contents">

<p>DC motor driver (implementation)  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="dc__motor_8h_source.html">dc_motor.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="hw__dc__motor_8h_source.html">hw/hw_dc_motor.h</a>&quot;</code><br/>
<code>#include &quot;<a class="el" href="cfg__pwm_8h_source.html">cfg/cfg_pwm.h</a>&quot;</code><br/>
<code>#include &lt;<a class="el" href="log_8h_source.html">cfg/log.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="debug_8h_source.html">cfg/debug.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="pid__control_8h_source.html">algo/pid_control.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="timer_8h_source.html">drv/timer.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="proc_8h_source.html">kern/proc.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="power_8h_source.html">cpu/power.h</a>&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
</div>
<p><a href="dc__motor_8c_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dc__motor_8c.html#add4978b08fc40ef8348c24abfb60f20d">DC_MOTOR_ACTIVE</a>&#160;&#160;&#160;BV(0)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Define status bit for DC motor device.  <a href="#add4978b08fc40ef8348c24abfb60f20d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a604b2a0b07525655f0bc223f12edb6c0"></a><!-- doxytag: member="dc_motor.c::DC_MOTOR_DIR" ref="a604b2a0b07525655f0bc223f12edb6c0" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dc__motor_8c.html#a604b2a0b07525655f0bc223f12edb6c0">DC_MOTOR_DIR</a>&#160;&#160;&#160;BV(1)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Spin direction of DC motor. <br/></td></tr>
<tr><td colspan="2"><h2><a name="func-members"></a>
Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a876301cead859ff75db3191f798d802d"></a><!-- doxytag: member="dc_motor.c::dc_motor_readTargetSpeed" ref="a876301cead859ff75db3191f798d802d" args="(int index)" -->
<a class="el" href="dc__motor_8h.html#a1df3986d581c772f61532e1512d956fe">dc_speed_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dc__motor_8c.html#a876301cead859ff75db3191f798d802d">dc_motor_readTargetSpeed</a> (int index)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Read the target speed from select device. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">static void NORETURN&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dc__motor_8c.html#ad4a9e5ca57bb94f6d0bd1a08ad965c93">dc_motor_poll</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Process to poll DC motor status.  <a href="#ad4a9e5ca57bb94f6d0bd1a08ad965c93"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dc__motor_8c.html#ae6da9a3fa5ccdf6e25f34d0ebd832d5e">dc_motor_setDir</a> (int index, bool dir)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Set spin direction of DC motor.  <a href="#ae6da9a3fa5ccdf6e25f34d0ebd832d5e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a729b7d2ee9e96ea8e8a302907e205bdb"></a><!-- doxytag: member="dc_motor.c::dc_motor_setSpeed" ref="a729b7d2ee9e96ea8e8a302907e205bdb" args="(int index, dc_speed_t speed)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dc__motor_8c.html#a729b7d2ee9e96ea8e8a302907e205bdb">dc_motor_setSpeed</a> (int index, <a class="el" href="dc__motor_8h.html#a1df3986d581c772f61532e1512d956fe">dc_speed_t</a> speed)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Set DC motor speed. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a630a290d843068374731c42361e3df60"></a><!-- doxytag: member="dc_motor.c::dc_motor_startTimer" ref="a630a290d843068374731c42361e3df60" args="(int index, mtime_t on_time)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dc__motor_8c.html#a630a290d843068374731c42361e3df60">dc_motor_startTimer</a> (int index, <a class="el" href="compiler_8h.html#ac6f57181b1edf6b9b510c8a1a66201c1">mtime_t</a> on_time)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Set among of time that dc motor should run. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aa24ea00e174985b4f0883aa660c26bb6"></a><!-- doxytag: member="dc_motor.c::dc_motor_enable" ref="aa24ea00e174985b4f0883aa660c26bb6" args="(int index, bool state)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dc__motor_8c.html#aa24ea00e174985b4f0883aa660c26bb6">dc_motor_enable</a> (int index, bool state)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Enable or disable dc motor. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7e9bc1dbb1fb17ebb0876c812ad3cebc"></a><!-- doxytag: member="dc_motor.c::dc_motor_setup" ref="a7e9bc1dbb1fb17ebb0876c812ad3cebc" args="(int index, DCMotorConfig *dcm_conf)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dc__motor_8c.html#a7e9bc1dbb1fb17ebb0876c812ad3cebc">dc_motor_setup</a> (int index, <a class="el" href="structDCMotorConfig.html">DCMotorConfig</a> *dcm_conf)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Apply a confinguration to select DC motor. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad9a08b8c5ec90abd31a89fc772e3da97"></a><!-- doxytag: member="dc_motor.c::dc_motor_setPriority" ref="ad9a08b8c5ec90abd31a89fc772e3da97" args="(int priority)" -->
void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dc__motor_8c.html#ad9a08b8c5ec90abd31a89fc772e3da97">dc_motor_setPriority</a> (int priority)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">If we had enabled the priority scheduling, we can adjust the DC motor poll process priority. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dc__motor_8c.html#a65e40de35ce11f560ed705c47c37dd84">dc_motor_init</a> (void)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Init DC motor.  <a href="#a65e40de35ce11f560ed705c47c37dd84"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="var-members"></a>
Variables</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a12f8d1df2a2800f342cdb8a7e94ef301"></a><!-- doxytag: member="dc_motor.c::dcm_all" ref="a12f8d1df2a2800f342cdb8a7e94ef301" args="[CONFIG_NUM_DC_MOTOR]" -->
static <a class="el" href="structDCMotor.html">DCMotor</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="dc__motor_8c.html#a12f8d1df2a2800f342cdb8a7e94ef301">dcm_all</a> [CONFIG_NUM_DC_MOTOR]</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">DC motor definition. <br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>DC motor driver (implementation) </p>
<p>Thi module provide a simple api to controll a DC motor in direction and speed, to allow this we use a Back-EMF technique. This technique is based, on the capability of the DC motor to become a generator of voltage when we turn off its supply. This happen every time we turn off the DC motor supply, and it continues to rotate for a short time thanks to its mechanical energy. Using this idea we can turn off the motor for a very short time, and we read the volage value from DC motor supply pins. This voltage say to us the actual speed of the motor.</p>
<dl class="author"><dt><b>Author:</b></dt><dd>Daniele Basile &lt;<a href="mailto:asterix@develer.com">asterix@develer.com</a>&gt; </dd></dl>

<p>Definition in file <a class="el" href="dc__motor_8c_source.html">dc_motor.c</a>.</p>
</div><hr/><h2>Define Documentation</h2>
<a class="anchor" id="add4978b08fc40ef8348c24abfb60f20d"></a><!-- doxytag: member="dc_motor.c::DC_MOTOR_ACTIVE" ref="add4978b08fc40ef8348c24abfb60f20d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define DC_MOTOR_ACTIVE&#160;&#160;&#160;BV(0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Define status bit for DC motor device. </p>
<p>DC motor enable or disable flag. </p>

<p>Definition at line <a class="el" href="dc__motor_8c_source.html#l00083">83</a> of file <a class="el" href="dc__motor_8c_source.html">dc_motor.c</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="a65e40de35ce11f560ed705c47c37dd84"></a><!-- doxytag: member="dc_motor.c::dc_motor_init" ref="a65e40de35ce11f560ed705c47c37dd84" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dc_motor_init </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Init DC motor. </p>
<p><em>priority:</em> sets the dc motor process priority. </p>

<p>Definition at line <a class="el" href="dc__motor_8c_source.html#l00490">490</a> of file <a class="el" href="dc__motor_8c_source.html">dc_motor.c</a>.</p>

</div>
</div>
<a class="anchor" id="ad4a9e5ca57bb94f6d0bd1a08ad965c93"></a><!-- doxytag: member="dc_motor.c::dc_motor_poll" ref="ad4a9e5ca57bb94f6d0bd1a08ad965c93" args="(void)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">static void NORETURN dc_motor_poll </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [static]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Process to poll DC motor status. </p>
<p>To use a Back-EMF technique (see brief for more details), we turn off a motor for CONFIG_DC_MOTOR_SAMPLE_DELAY, that value are stored in each DC motor config. For this implementation we assume that have a common CONFIG_DC_MOTOR_SAMPLE_DELAY, choose among a max delay to all DC motor configuration. The DC motor off time is choose to allow the out signal to be stable, so we can read and process this value for feedback controll loop. The period (CONFIG_DC_MOTOR_SAMPLE_PERIOD - CONFIG_DC_MOTOR_SAMPLE_DELAY) that every time we turn off a DC motor is choose to have a feedback controll more responsive or less responsive. </p>

<p>Definition at line <a class="el" href="dc__motor_8c_source.html#l00289">289</a> of file <a class="el" href="dc__motor_8c_source.html">dc_motor.c</a>.</p>

</div>
</div>
<a class="anchor" id="ae6da9a3fa5ccdf6e25f34d0ebd832d5e"></a><!-- doxytag: member="dc_motor.c::dc_motor_setDir" ref="ae6da9a3fa5ccdf6e25f34d0ebd832d5e" args="(int index, bool dir)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void dc_motor_setDir </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>index</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>dir</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Set spin direction of DC motor. </p>
<p><em>index</em> number of DC motor <em>dir</em> direction of DC motor </p>

<p>Definition at line <a class="el" href="dc__motor_8c_source.html#l00347">347</a> of file <a class="el" href="dc__motor_8c_source.html">dc_motor.c</a>.</p>

</div>
</div>
</div>


