

<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_9fd71c1ac00056e7d855336b2291c56c.html">bertos</a>      </li>
      <li class="navelem"><a class="el" href="dir_cd5151ad4b595b3b6d6807653813384b.html">fs</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Data Structures</a> &#124;
<a href="#define-members">Defines</a> &#124;
<a href="#typedef-members">Typedefs</a>  </div>
  <div class="headertitle">
<div class="title">battfs.h File Reference</div>  </div>
</div>
<div class="contents">

<p>BattFS: a filesystem for embedded platforms (interface). TODO: Add detailed filesystem description.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &lt;<a class="el" href="compiler_8h_source.html">cfg/compiler.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="types_8h_source.html">cpu/types.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="rotating__hash_8h_source.html">algo/rotating_hash.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="list_8h_source.html">struct/list.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="io_2kfile_8h_source.html">io/kfile.h</a>&gt;</code><br/>
<code>#include &lt;<a class="el" href="kblock_8h_source.html">io/kblock.h</a>&gt;</code><br/>
</div>
<p><a href="battfs_8h_source.html">Go to the source code of this file.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Data Structures</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBattFsPageHeader.html">BattFsPageHeader</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">BattFS page header, used to represent a page header in memory.  <a href="structBattFsPageHeader.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBattFsSuper.html">BattFsSuper</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Context used to describe a disk.  <a href="structBattFsSuper.html#details">More...</a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structBattFs.html">BattFs</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Describe a <a class="el" href="structBattFs.html" title="Describe a BattFs file usign a KFile.">BattFs</a> file usign a <a class="el" href="structKFile.html" title="Context data for callback functions which operate on pseudo files.">KFile</a>.  <a href="structBattFs.html#details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="define-members"></a>
Defines</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a5f50d8650c7f510c735ea41d140fe8b6">BATTFS_HEADER_LEN</a>&#160;&#160;&#160;12</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Size of the header once saved on disk.  <a href="#a5f50d8650c7f510c735ea41d140fe8b6"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a2742c4844d0d76afd296112f5893c4ed"></a><!-- doxytag: member="battfs.h::MAX_PAGE_ADDR" ref="a2742c4844d0d76afd296112f5893c4ed" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a2742c4844d0d76afd296112f5893c4ed">MAX_PAGE_ADDR</a>&#160;&#160;&#160;((1 &lt;&lt; (CPU_BITS_PER_CHAR * sizeof(<a class="el" href="battfs_8h.html#ab696748712d719603833f401031a7907">pgcnt_t</a>))) - 1)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Maximum page address. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a027862d094e3f04e031a45a0268f6a50"></a><!-- doxytag: member="battfs.h::BATTFS_MAX_FILES" ref="a027862d094e3f04e031a45a0268f6a50" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a027862d094e3f04e031a45a0268f6a50">BATTFS_MAX_FILES</a>&#160;&#160;&#160;(1 &lt;&lt; (CPU_BITS_PER_CHAR * sizeof(<a class="el" href="battfs_8h.html#a74713a2f9f355cad853593781defa824">inode_t</a>)))</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Max number of files. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a953801195b124d1b4bca5df3c47ff645"></a><!-- doxytag: member="battfs.h::PAGE_UNSET_SENTINEL" ref="a953801195b124d1b4bca5df3c47ff645" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a953801195b124d1b4bca5df3c47ff645">PAGE_UNSET_SENTINEL</a>&#160;&#160;&#160;((<a class="el" href="battfs_8h.html#ab696748712d719603833f401031a7907">pgcnt_t</a>)((1L &lt;&lt; (CPU_BITS_PER_CHAR * sizeof(pgcnt_t))) - 1))</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Sentinel used to keep trace of unset pages in disk-&gt;page_array. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a655dbaa973085429b2b0f5953f256c87"></a><!-- doxytag: member="battfs.h::SPACE_OVER" ref="a655dbaa973085429b2b0f5953f256c87" args="(disk)" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a655dbaa973085429b2b0f5953f256c87">SPACE_OVER</a>(disk)&#160;&#160;&#160;((disk)-&gt;free_page_start &gt;= (disk)-&gt;dev-&gt;blk_cnt)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">True if space on <em>disk</em> is over. <br/></td></tr>
<tr><td colspan="2"><h2><a name="typedef-members"></a>
Typedefs</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af0b3070403482fbfa266d6e3e6cff088"></a><!-- doxytag: member="battfs.h::fill_t" ref="af0b3070403482fbfa266d6e3e6cff088" args="" -->
typedef uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#af0b3070403482fbfa266d6e3e6cff088">fill_t</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Type for keeping trace of space filled inside a page. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a533d079449525768fe3d92f4a8089c67"></a><!-- doxytag: member="battfs.h::pgaddr_t" ref="a533d079449525768fe3d92f4a8089c67" args="" -->
typedef <a class="el" href="battfs_8h.html#af0b3070403482fbfa266d6e3e6cff088">fill_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a533d079449525768fe3d92f4a8089c67">pgaddr_t</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Type for addressing space inside a page. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ab696748712d719603833f401031a7907"></a><!-- doxytag: member="battfs.h::pgcnt_t" ref="ab696748712d719603833f401031a7907" args="" -->
typedef uint16_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#ab696748712d719603833f401031a7907">pgcnt_t</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Type for counting pages on disk. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abd9d9d290feaf2e76bce6142ae59019e"></a><!-- doxytag: member="battfs.h::pgoff_t" ref="abd9d9d290feaf2e76bce6142ae59019e" args="" -->
typedef <a class="el" href="battfs_8h.html#ab696748712d719603833f401031a7907">pgcnt_t</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#abd9d9d290feaf2e76bce6142ae59019e">pgoff_t</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Type for counting pages inside a file. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a74713a2f9f355cad853593781defa824"></a><!-- doxytag: member="battfs.h::inode_t" ref="a74713a2f9f355cad853593781defa824" args="" -->
typedef uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a74713a2f9f355cad853593781defa824">inode_t</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Type for file inodes. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="abbbad188c9c52701e8dbd92f0a5635f5"></a><!-- doxytag: member="battfs.h::seq_t" ref="abbbad188c9c52701e8dbd92f0a5635f5" args="" -->
typedef uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#abbbad188c9c52701e8dbd92f0a5635f5">seq_t</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Type for page seq number, at least 40bits wide. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="aaf7617a98621b494ad58b8bbbdf9306e"></a><!-- doxytag: member="battfs.h::fcs_t" ref="aaf7617a98621b494ad58b8bbbdf9306e" args="" -->
typedef rotating_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#aaf7617a98621b494ad58b8bbbdf9306e">fcs_t</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Type for header FCS. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a9017d685cb32390bc614feb39ecf2282"></a><!-- doxytag: member="battfs.h::disk_size_t" ref="a9017d685cb32390bc614feb39ecf2282" args="" -->
typedef uint32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a9017d685cb32390bc614feb39ecf2282">disk_size_t</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Type for disk sizes. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="adf5532a6841c3713f99a378e3f9f7a82"></a><!-- doxytag: member="battfs.h::filemode_t" ref="adf5532a6841c3713f99a378e3f9f7a82" args="" -->
typedef uint8_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#adf5532a6841c3713f99a378e3f9f7a82">filemode_t</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Type for file open modes. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a63bb07cc5b9e2d76ea5499b397e2b4ee"></a><!-- doxytag: member="battfs.h::file_size_t" ref="a63bb07cc5b9e2d76ea5499b397e2b4ee" args="" -->
typedef int32_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a63bb07cc5b9e2d76ea5499b397e2b4ee">file_size_t</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Type for file sizes. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a28f6a15a43a57c449718ae0d291cc6a8">BATTFS_CREATE</a>&#160;&#160;&#160;BV(0)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Modes for battfs_fileopen.  <a href="#a28f6a15a43a57c449718ae0d291cc6a8"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af9280046ad0f906092570349a596618c"></a><!-- doxytag: member="battfs.h::BATTFS_RD" ref="af9280046ad0f906092570349a596618c" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#af9280046ad0f906092570349a596618c">BATTFS_RD</a>&#160;&#160;&#160;BV(1)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Open file for reading. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0bf91449ef87bac7cd038bdd0f35dd84"></a><!-- doxytag: member="battfs.h::BATTFS_WR" ref="a0bf91449ef87bac7cd038bdd0f35dd84" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a0bf91449ef87bac7cd038bdd0f35dd84">BATTFS_WR</a>&#160;&#160;&#160;BV(2)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Open file fir writing. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a56f53433488152eaadf5f32af96b4fca">BATTFS_NEGATIVE_SEEK_ERR</a>&#160;&#160;&#160;BV(0)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">File errors.  <a href="#a56f53433488152eaadf5f32af96b4fca"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad5f5f02fc2e2e920d004790a5ea0d4a5"></a><!-- doxytag: member="battfs.h::BATTFS_DISK_READ_ERR" ref="ad5f5f02fc2e2e920d004790a5ea0d4a5" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#ad5f5f02fc2e2e920d004790a5ea0d4a5">BATTFS_DISK_READ_ERR</a>&#160;&#160;&#160;BV(1)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Error reading from disk device. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a64b38adc1699a23bf33be496bc0a3a11"></a><!-- doxytag: member="battfs.h::BATTFS_DISK_WRITE_ERR" ref="a64b38adc1699a23bf33be496bc0a3a11" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a64b38adc1699a23bf33be496bc0a3a11">BATTFS_DISK_WRITE_ERR</a>&#160;&#160;&#160;BV(2)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Error writing in the disk device. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a07e6c6967d3b82e1a6003ce648abbd43"></a><!-- doxytag: member="battfs.h::BATTFS_DISK_SPACEOVER_ERR" ref="a07e6c6967d3b82e1a6003ce648abbd43" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a07e6c6967d3b82e1a6003ce648abbd43">BATTFS_DISK_SPACEOVER_ERR</a>&#160;&#160;&#160;BV(3)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">No more disk space available. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ae58fb1fcd745519527a3df0b6143444c"></a><!-- doxytag: member="battfs.h::BATTFS_DISK_FLUSHBUF_ERR" ref="ae58fb1fcd745519527a3df0b6143444c" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#ae58fb1fcd745519527a3df0b6143444c">BATTFS_DISK_FLUSHBUF_ERR</a>&#160;&#160;&#160;BV(4)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Error flushing (writing) the current page to disk. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a60adbbfdf02b27134b0a24c7286371f4"></a><!-- doxytag: member="battfs.h::BATTFS_FILE_NOT_FOUND_ERR" ref="a60adbbfdf02b27134b0a24c7286371f4" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a60adbbfdf02b27134b0a24c7286371f4">BATTFS_FILE_NOT_FOUND_ERR</a>&#160;&#160;&#160;BV(5)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">File not found on disk. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a773a6de12626d04cb1311cf53cb88044"></a><!-- doxytag: member="battfs.h::KFT_BATTFS" ref="a773a6de12626d04cb1311cf53cb88044" args="" -->
#define&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a773a6de12626d04cb1311cf53cb88044">KFT_BATTFS</a>&#160;&#160;&#160;MAKE_ID('B', 'T', 'F', 'S')</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Id for battfs file descriptors. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="el" href="structBattFs.html">BattFs</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#aa3454be3a409226483796545df248615">BATTFS_CAST</a> (<a class="el" href="structKFile.html">KFile</a> *fd)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Macro used to cast a <a class="el" href="structKFile.html" title="Context data for callback functions which operate on pseudo files.">KFile</a> to a BattFS.  <a href="#aa3454be3a409226483796545df248615"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a5ae502d0f195b3a16836f3883f80ebac">battfs_mount</a> (struct <a class="el" href="structBattFsSuper.html">BattFsSuper</a> *disk, struct <a class="el" href="structKBlock.html">KBlock</a> *dev, <a class="el" href="battfs_8h.html#ab696748712d719603833f401031a7907">pgcnt_t</a> *page_array, size_t array_size)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize and mount disk described by <em>disk</em>.  <a href="#a5ae502d0f195b3a16836f3883f80ebac"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#abefec8a14bbb305b13d77adc7a56996b">battfs_fsck</a> (struct <a class="el" href="structBattFsSuper.html">BattFsSuper</a> *disk)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Check the filesystem.  <a href="#abefec8a14bbb305b13d77adc7a56996b"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a6059da32732f2272b68894610eddb99d"></a><!-- doxytag: member="battfs.h::battfs_umount" ref="a6059da32732f2272b68894610eddb99d" args="(struct BattFsSuper *disk)" -->
bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a6059da32732f2272b68894610eddb99d">battfs_umount</a> (struct <a class="el" href="structBattFsSuper.html">BattFsSuper</a> *disk)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Umount <em>disk</em>. <br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a7469859a17ef79668fdc9b3e949bba7b">battfs_fileExists</a> (<a class="el" href="structBattFsSuper.html">BattFsSuper</a> *disk, <a class="el" href="battfs_8h.html#a74713a2f9f355cad853593781defa824">inode_t</a> inode)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a8295240f9546944d0b8e1b06a1e5579d">battfs_fileopen</a> (<a class="el" href="structBattFsSuper.html">BattFsSuper</a> *disk, <a class="el" href="structBattFs.html">BattFs</a> *fd, <a class="el" href="battfs_8h.html#a74713a2f9f355cad853593781defa824">inode_t</a> inode, <a class="el" href="battfs_8h.html#adf5532a6841c3713f99a378e3f9f7a82">filemode_t</a> mode)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Open file <em>inode</em> from <em>disk</em> in <em>mode</em>.  <a href="#a8295240f9546944d0b8e1b06a1e5579d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#a71a27ec6b07d8232c5cbcc893eb07bfd">battfs_writeTestBlock</a> (<a class="el" href="structKBlock.html">KBlock</a> *dev, <a class="el" href="battfs_8h.html#ab696748712d719603833f401031a7907">pgcnt_t</a> page, <a class="el" href="battfs_8h.html#a74713a2f9f355cad853593781defa824">inode_t</a> inode, <a class="el" href="battfs_8h.html#abbbad188c9c52701e8dbd92f0a5635f5">seq_t</a> seq, <a class="el" href="battfs_8h.html#af0b3070403482fbfa266d6e3e6cff088">fill_t</a> fill, <a class="el" href="battfs_8h.html#abd9d9d290feaf2e76bce6142ae59019e">pgoff_t</a> pgoff)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Modes for battfs_fileopen.  <a href="#a71a27ec6b07d8232c5cbcc893eb07bfd"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="battfs_8h.html#aa00a8d53d613cced6d6c36e3a8f92357">battfs_eraseBlock</a> (<a class="el" href="structKBlock.html">KBlock</a> *dev, <a class="el" href="battfs_8h.html#ab696748712d719603833f401031a7907">pgcnt_t</a> page)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Modes for battfs_fileopen.  <a href="#aa00a8d53d613cced6d6c36e3a8f92357"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>BattFS: a filesystem for embedded platforms (interface). TODO: Add detailed filesystem description. </p>
<dl class="author"><dt><b>Author:</b></dt><dd>Francesco Sacchi &lt;<a href="mailto:batt@develer.com">batt@develer.com</a>&gt; </dd></dl>

<p>Definition in file <a class="el" href="battfs_8h_source.html">battfs.h</a>.</p>
</div><hr/><h2>Define Documentation</h2>
<a class="anchor" id="a28f6a15a43a57c449718ae0d291cc6a8"></a><!-- doxytag: member="battfs.h::BATTFS_CREATE" ref="a28f6a15a43a57c449718ae0d291cc6a8" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BATTFS_CREATE&#160;&#160;&#160;BV(0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Modes for battfs_fileopen. </p>
<p>Create file if does not exist </p>

<p>Definition at line <a class="el" href="battfs_8h_source.html#l00160">160</a> of file <a class="el" href="battfs_8h_source.html">battfs.h</a>.</p>

</div>
</div>
<a class="anchor" id="a5f50d8650c7f510c735ea41d140fe8b6"></a><!-- doxytag: member="battfs.h::BATTFS_HEADER_LEN" ref="a5f50d8650c7f510c735ea41d140fe8b6" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BATTFS_HEADER_LEN&#160;&#160;&#160;12</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Size of the header once saved on disk. </p>
<dl class="see"><dt><b>See also:</b></dt><dd><a class="el" href="battfs_8c.html#a2ab58e79b36e2d503e0a3197ca08b65a" title="Convert from memory representation to disk structure.">battfs_to_disk</a> </dd>
<dd>
<a class="el" href="battfs_8c.html#ab52ab90298977c2327a5d857fbb6517c" title="Convert from disk structure to memory representation.">disk_to_battfs</a> </dd></dl>

<p>Definition at line <a class="el" href="battfs_8h_source.html#l00097">97</a> of file <a class="el" href="battfs_8h_source.html">battfs.h</a>.</p>

</div>
</div>
<a class="anchor" id="a56f53433488152eaadf5f32af96b4fca"></a><!-- doxytag: member="battfs.h::BATTFS_NEGATIVE_SEEK_ERR" ref="a56f53433488152eaadf5f32af96b4fca" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">#define BATTFS_NEGATIVE_SEEK_ERR&#160;&#160;&#160;BV(0)</td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>File errors. </p>
<p>Trying to read/write before file start. </p>

<p>Definition at line <a class="el" href="battfs_8h_source.html#l00170">170</a> of file <a class="el" href="battfs_8h_source.html">battfs.h</a>.</p>

</div>
</div>
<hr/><h2>Function Documentation</h2>
<a class="anchor" id="aa3454be3a409226483796545df248615"></a><!-- doxytag: member="battfs.h::BATTFS_CAST" ref="aa3454be3a409226483796545df248615" args="(KFile *fd)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="structBattFs.html">BattFs</a>* BATTFS_CAST </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structKFile.html">KFile</a> *&#160;</td>
          <td class="paramname"><em>fd</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Macro used to cast a <a class="el" href="structKFile.html" title="Context data for callback functions which operate on pseudo files.">KFile</a> to a BattFS. </p>
<p>Also perform dynamic type check. </p>

<p>Definition at line <a class="el" href="battfs_8h_source.html#l00202">202</a> of file <a class="el" href="battfs_8h_source.html">battfs.h</a>.</p>

</div>
</div>
<a class="anchor" id="aa00a8d53d613cced6d6c36e3a8f92357"></a><!-- doxytag: member="battfs.h::battfs_eraseBlock" ref="aa00a8d53d613cced6d6c36e3a8f92357" args="(KBlock *dev, pgcnt_t page)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void battfs_eraseBlock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structKBlock.html">KBlock</a> *&#160;</td>
          <td class="paramname"><em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="battfs_8h.html#ab696748712d719603833f401031a7907">pgcnt_t</a>&#160;</td>
          <td class="paramname"><em>page</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Modes for battfs_fileopen. </p>
<p>Create file if does not exist </p>

</div>
</div>
<a class="anchor" id="a7469859a17ef79668fdc9b3e949bba7b"></a><!-- doxytag: member="battfs.h::battfs_fileExists" ref="a7469859a17ef79668fdc9b3e949bba7b" args="(BattFsSuper *disk, inode_t inode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool battfs_fileExists </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structBattFsSuper.html">BattFsSuper</a> *&#160;</td>
          <td class="paramname"><em>disk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="battfs_8h.html#a74713a2f9f355cad853593781defa824">inode_t</a>&#160;</td>
          <td class="paramname"><em>inode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">
<dl class="return"><dt><b>Returns:</b></dt><dd>true if file <em>inode</em> exists on <em>disk</em>, false otherwise. </dd></dl>

<p>Definition at line <a class="el" href="battfs_8c_source.html#l00860">860</a> of file <a class="el" href="battfs_8c_source.html">battfs.c</a>.</p>

</div>
</div>
<a class="anchor" id="a8295240f9546944d0b8e1b06a1e5579d"></a><!-- doxytag: member="battfs.h::battfs_fileopen" ref="a8295240f9546944d0b8e1b06a1e5579d" args="(BattFsSuper *disk, BattFs *fd, inode_t inode, filemode_t mode)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool battfs_fileopen </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structBattFsSuper.html">BattFsSuper</a> *&#160;</td>
          <td class="paramname"><em>disk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="structBattFs.html">BattFs</a> *&#160;</td>
          <td class="paramname"><em>fd</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="battfs_8h.html#a74713a2f9f355cad853593781defa824">inode_t</a>&#160;</td>
          <td class="paramname"><em>inode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="battfs_8h.html#adf5532a6841c3713f99a378e3f9f7a82">filemode_t</a>&#160;</td>
          <td class="paramname"><em>mode</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Open file <em>inode</em> from <em>disk</em> in <em>mode</em>. </p>
<p>File context is stored in <em>fd</em>. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>true if ok, false otherwise. </dd></dl>

<p>Definition at line <a class="el" href="battfs_8c_source.html#l00906">906</a> of file <a class="el" href="battfs_8c_source.html">battfs.c</a>.</p>

</div>
</div>
<a class="anchor" id="abefec8a14bbb305b13d77adc7a56996b"></a><!-- doxytag: member="battfs.h::battfs_fsck" ref="abefec8a14bbb305b13d77adc7a56996b" args="(struct BattFsSuper *disk)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool battfs_fsck </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structBattFsSuper.html">BattFsSuper</a> *&#160;</td>
          <td class="paramname"><em>disk</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Check the filesystem. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>true if ok, false on errors. </dd></dl>

<p>Definition at line <a class="el" href="battfs_8c_source.html#l00425">425</a> of file <a class="el" href="battfs_8c_source.html">battfs.c</a>.</p>

</div>
</div>
<a class="anchor" id="a5ae502d0f195b3a16836f3883f80ebac"></a><!-- doxytag: member="battfs.h::battfs_mount" ref="a5ae502d0f195b3a16836f3883f80ebac" args="(struct BattFsSuper *disk, struct KBlock *dev, pgcnt_t *page_array, size_t array_size)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool battfs_mount </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structBattFsSuper.html">BattFsSuper</a> *&#160;</td>
          <td class="paramname"><em>disk</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structKBlock.html">KBlock</a> *&#160;</td>
          <td class="paramname"><em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="battfs_8h.html#ab696748712d719603833f401031a7907">pgcnt_t</a> *&#160;</td>
          <td class="paramname"><em>page_array</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">size_t&#160;</td>
          <td class="paramname"><em>array_size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Initialize and mount disk described by <em>disk</em>. </p>
<dl class="return"><dt><b>Returns:</b></dt><dd>false on errors, true otherwise. </dd></dl>

<p>Definition at line <a class="el" href="battfs_8c_source.html#l00364">364</a> of file <a class="el" href="battfs_8c_source.html">battfs.c</a>.</p>

</div>
</div>
<a class="anchor" id="a71a27ec6b07d8232c5cbcc893eb07bfd"></a><!-- doxytag: member="battfs.h::battfs_writeTestBlock" ref="a71a27ec6b07d8232c5cbcc893eb07bfd" args="(KBlock *dev, pgcnt_t page, inode_t inode, seq_t seq, fill_t fill, pgoff_t pgoff)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void battfs_writeTestBlock </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="structKBlock.html">KBlock</a> *&#160;</td>
          <td class="paramname"><em>dev</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="battfs_8h.html#ab696748712d719603833f401031a7907">pgcnt_t</a>&#160;</td>
          <td class="paramname"><em>page</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="battfs_8h.html#a74713a2f9f355cad853593781defa824">inode_t</a>&#160;</td>
          <td class="paramname"><em>inode</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="battfs_8h.html#abbbad188c9c52701e8dbd92f0a5635f5">seq_t</a>&#160;</td>
          <td class="paramname"><em>seq</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="battfs_8h.html#af0b3070403482fbfa266d6e3e6cff088">fill_t</a>&#160;</td>
          <td class="paramname"><em>fill</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype"><a class="el" href="battfs_8h.html#abd9d9d290feaf2e76bce6142ae59019e">pgoff_t</a>&#160;</td>
          <td class="paramname"><em>pgoff</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Modes for battfs_fileopen. </p>
<p>Create file if does not exist </p>

</div>
</div>
</div>


