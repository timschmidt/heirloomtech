

<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_9fd71c1ac00056e7d855336b2291c56c.html">bertos</a>      </li>
      <li class="navelem"><a class="el" href="dir_e91c80130e425b11d52da5b92a7aa933.html">net</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">pocketcmd.h</div>  </div>
</div>
<div class="contents">
<a href="pocketcmd_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00040"></a>00040 <span class="preprocessor">#ifndef NET_POCKETCMD_H</span>
<a name="l00041"></a>00041 <span class="preprocessor"></span><span class="preprocessor">#define NET_POCKETCMD_H</span>
<a name="l00042"></a>00042 <span class="preprocessor"></span>
<a name="l00043"></a>00043 <span class="preprocessor">#include &quot;<a class="code" href="pocketbus_8h.html" title="Basical functions to use pocketBus protocol.">pocketbus.h</a>&quot;</span>
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;<a class="code" href="compiler_8h.html" title="Additional support macros for compiler independance.">cfg/compiler.h</a>&gt;</span>
<a name="l00045"></a>00045 
<a name="l00046"></a><a class="code" href="pocketcmd_8h.html#ae67decfe8a2dc61cff2b0bddbd803b76">00046</a> <span class="preprocessor">#define PKTCMD_NULL 0 ///&lt; pocketBus Null command</span>
<a name="l00047"></a>00047 <span class="preprocessor"></span>
<a name="l00048"></a><a class="code" href="pocketcmd_8h.html#affe678a12b9a8f6f3238b24e8eb4a9d7">00048</a> <span class="keyword">typedef</span> uint16_t <a class="code" href="pocketcmd_8h.html#affe678a12b9a8f6f3238b24e8eb4a9d7" title="Type for Command IDs.">pocketcmd_t</a>; 
<a name="l00049"></a>00049 
<a name="l00053"></a><a class="code" href="structPocketCmdHdr.html">00053</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structPocketCmdHdr.html" title="Header for transmitted pocketBus Commands.">PocketCmdHdr</a>
<a name="l00054"></a>00054 {
<a name="l00055"></a><a class="code" href="structPocketCmdHdr.html#a9be499f09b0d6cd1d1e73c10ffc8e47b">00055</a>     <a class="code" href="pocketcmd_8h.html#affe678a12b9a8f6f3238b24e8eb4a9d7" title="Type for Command IDs.">pocketcmd_t</a> <a class="code" href="structPocketCmdHdr.html#a9be499f09b0d6cd1d1e73c10ffc8e47b" title="command ID">cmd</a>; 
<a name="l00056"></a>00056 } <a class="code" href="structPocketCmdHdr.html" title="Header for transmitted pocketBus Commands.">PocketCmdHdr</a>;
<a name="l00057"></a>00057 
<a name="l00063"></a>00063 <a class="code" href="compiler_8h.html#a695e64485eb9535f5ddcfec01167bddc" title="Issue a compilation error if the condition is false.">STATIC_ASSERT</a>(<span class="keyword">sizeof</span>(<a class="code" href="pocketcmd_8h.html#affe678a12b9a8f6f3238b24e8eb4a9d7" title="Type for Command IDs.">pocketcmd_t</a>) == <span class="keyword">sizeof</span>(uint16_t));
<a name="l00064"></a>00064 <span class="comment">/*\}*/</span>
<a name="l00065"></a>00065 
<a name="l00066"></a>00066 <span class="comment">/* fwd declaration */</span>
<a name="l00067"></a>00067 <span class="keyword">struct </span><a class="code" href="structPocketCmdCtx.html" title="pocketBus context for command layer communications.">PocketCmdCtx</a>;
<a name="l00068"></a>00068 
<a name="l00072"></a><a class="code" href="structPocketCmdMsg.html">00072</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structPocketCmdMsg.html" title="pocketBus command message structure.">PocketCmdMsg</a>
<a name="l00073"></a>00073 {
<a name="l00074"></a><a class="code" href="structPocketCmdMsg.html#a4419634cf45ca4056edbc97714c63b70">00074</a>     <span class="keyword">struct </span><a class="code" href="structPocketCmdCtx.html" title="pocketBus context for command layer communications.">PocketCmdCtx</a> *<a class="code" href="structPocketCmdMsg.html#a4419634cf45ca4056edbc97714c63b70" title="command context">cmd_ctx</a>; 
<a name="l00075"></a><a class="code" href="structPocketCmdMsg.html#ac1bf17028b0e21468ffe4b28e51739a0">00075</a>     <a class="code" href="pocketcmd_8h.html#affe678a12b9a8f6f3238b24e8eb4a9d7" title="Type for Command IDs.">pocketcmd_t</a> <a class="code" href="structPocketCmdMsg.html#ac1bf17028b0e21468ffe4b28e51739a0" title="command id">cmd</a>;              
<a name="l00076"></a><a class="code" href="structPocketCmdMsg.html#ac64c2de986beda81162cd9f3d30d590a">00076</a>     <a class="code" href="pocketbus_8h.html#a8c6d1bda67f65a44ce69c9ef0b75c55e" title="Type for pocketBus length.">pocketbus_len_t</a> <a class="code" href="structPocketCmdMsg.html#ac64c2de986beda81162cd9f3d30d590a" title="optional arg length">len</a>;          
<a name="l00077"></a><a class="code" href="structPocketCmdMsg.html#a33c23053e1a07dbca61e746a07657471">00077</a>     <span class="keyword">const</span> uint8_t *<a class="code" href="structPocketCmdMsg.html#a33c23053e1a07dbca61e746a07657471" title="optional arguments">buf</a>;           
<a name="l00078"></a>00078 } <a class="code" href="structPocketCmdMsg.html" title="pocketBus command message structure.">PocketCmdMsg</a>;
<a name="l00079"></a>00079 
<a name="l00083"></a><a class="code" href="pocketcmd_8h.html#a8f01ff4713827b63e23b8d65b45f3ee7">00083</a> <span class="keyword">typedef</span> void (*<a class="code" href="pocketcmd_8h.html#a8f01ff4713827b63e23b8d65b45f3ee7" title="Type for command hooks.">pocketcmd_hook_t</a>)(<span class="keyword">struct </span><a class="code" href="structPocketCmdMsg.html" title="pocketBus command message structure.">PocketCmdMsg</a> *cmd_msg);
<a name="l00084"></a>00084 
<a name="l00088"></a><a class="code" href="pocketcmd_8h.html#af46331528972d3b475ed35e3fc006617">00088</a> <span class="keyword">typedef</span> <a class="code" href="pocketcmd_8h.html#a8f01ff4713827b63e23b8d65b45f3ee7" title="Type for command hooks.">pocketcmd_hook_t</a> (*<a class="code" href="pocketcmd_8h.html#af46331528972d3b475ed35e3fc006617" title="Type for lookup function hooks.">pocketcmd_lookup_t</a>)(<a class="code" href="pocketcmd_8h.html#affe678a12b9a8f6f3238b24e8eb4a9d7" title="Type for Command IDs.">pocketcmd_t</a> <a class="code" href="structPocketCmdMsg.html#ac1bf17028b0e21468ffe4b28e51739a0" title="command id">cmd</a>);
<a name="l00089"></a>00089 
<a name="l00093"></a><a class="code" href="structPocketCmdCtx.html">00093</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structPocketCmdCtx.html" title="pocketBus context for command layer communications.">PocketCmdCtx</a>
<a name="l00094"></a>00094 {
<a name="l00095"></a><a class="code" href="structPocketCmdCtx.html#a2119f3edc96ff1082531e37c7c6f68bd">00095</a>     <span class="keyword">struct </span><a class="code" href="structPocketBusCtx.html" title="pocketBus context structure.">PocketBusCtx</a> *<a class="code" href="structPocketCmdCtx.html#a2119f3edc96ff1082531e37c7c6f68bd" title="pocketBus context">bus_ctx</a>; 
<a name="l00096"></a><a class="code" href="structPocketCmdCtx.html#a6b7762bb5ad47bc1e128ff6ef04d9481">00096</a>     <a class="code" href="pocketbus_8h.html#af63b5ecec3f1a8ffaf7d711181392dec" title="Type for pocketBus addresses.">pocketbus_addr_t</a> <a class="code" href="structPocketCmdCtx.html#a6b7762bb5ad47bc1e128ff6ef04d9481" title="Our address.">addr</a>;        
<a name="l00097"></a><a class="code" href="structPocketCmdCtx.html#ac42ab139fdbe6ffb6d79db7a635f0576">00097</a>     <a class="code" href="pocketcmd_8h.html#af46331528972d3b475ed35e3fc006617" title="Type for lookup function hooks.">pocketcmd_lookup_t</a> <a class="code" href="structPocketCmdCtx.html#ac42ab139fdbe6ffb6d79db7a635f0576" title="Lookup function used to search for command callbacks.">search</a>;    
<a name="l00098"></a><a class="code" href="structPocketCmdCtx.html#a41cc49ce818974988453de1ddf640a63">00098</a>     <a class="code" href="pocketcmd_8h.html#affe678a12b9a8f6f3238b24e8eb4a9d7" title="Type for Command IDs.">pocketcmd_t</a> <a class="code" href="structPocketCmdCtx.html#a41cc49ce818974988453de1ddf640a63" title="The command ID we are waiting for or PKTCMD_NULL.">waiting</a>;          
<a name="l00099"></a><a class="code" href="structPocketCmdCtx.html#a184f1b234b1df60a395e3cb4f54b02ab">00099</a>     <a class="code" href="compiler_8h.html#a9f2d272efa5f391ffc4b9ec4eb59fa88" title="Type for time expressed in ticks.">ticks_t</a> <a class="code" href="structPocketCmdCtx.html#a184f1b234b1df60a395e3cb4f54b02ab" title="For waiting_reply.">reply_timer</a>;          
<a name="l00100"></a>00100 } <a class="code" href="structPocketCmdCtx.html" title="pocketBus context for command layer communications.">PocketCmdCtx</a>;
<a name="l00101"></a>00101 
<a name="l00107"></a><a class="code" href="pocketcmd_8h.html#ab58ad8e743aacd2c778b8af04975a91a">00107</a> INLINE <span class="keywordtype">void</span> <a class="code" href="pocketcmd_8h.html#ab58ad8e743aacd2c778b8af04975a91a" title="Set slave address addr for pocketBus command layer.">pocketcmd_setAddr</a>(<span class="keyword">struct</span> <a class="code" href="structPocketCmdCtx.html" title="pocketBus context for command layer communications.">PocketCmdCtx</a> *ctx, <a class="code" href="pocketbus_8h.html#af63b5ecec3f1a8ffaf7d711181392dec" title="Type for pocketBus addresses.">pocketbus_addr_t</a> addr)
<a name="l00108"></a>00108 {
<a name="l00109"></a>00109     ctx-&gt;<a class="code" href="structPocketCmdCtx.html#a6b7762bb5ad47bc1e128ff6ef04d9481" title="Our address.">addr</a> = addr;
<a name="l00110"></a>00110 }
<a name="l00111"></a>00111 
<a name="l00112"></a>00112 <span class="keywordtype">void</span> <a class="code" href="pocketcmd_8c.html#a4d1eb2686d1093319c9165f8e82804ce" title="Init pocketBus command layer.">pocketcmd_init</a>(<span class="keyword">struct</span> <a class="code" href="structPocketCmdCtx.html" title="pocketBus context for command layer communications.">PocketCmdCtx</a> *ctx, <span class="keyword">struct</span> <a class="code" href="structPocketBusCtx.html" title="pocketBus context structure.">PocketBusCtx</a> *bus_ctx, <a class="code" href="pocketbus_8h.html#af63b5ecec3f1a8ffaf7d711181392dec" title="Type for pocketBus addresses.">pocketbus_addr_t</a> addr, <a class="code" href="pocketcmd_8h.html#af46331528972d3b475ed35e3fc006617" title="Type for lookup function hooks.">pocketcmd_lookup_t</a> search);
<a name="l00113"></a>00113 <span class="keywordtype">void</span> <a class="code" href="pocketcmd_8c.html#a03d8be6ba197eafbd3cf7985eb6a92d5" title="pocketBus Command poll function.">pocketcmd_poll</a>(<span class="keyword">struct</span> <a class="code" href="structPocketCmdCtx.html" title="pocketBus context for command layer communications.">PocketCmdCtx</a> *ctx);
<a name="l00114"></a>00114 <span class="keywordtype">bool</span> <a class="code" href="pocketcmd_8c.html#a42cde2e81868cb68d11bc4b2ae50d354" title="Send command cmd to/from slave adding len arguments in buf.">pocketcmd_send</a>(<span class="keyword">struct</span> <a class="code" href="structPocketCmdCtx.html" title="pocketBus context for command layer communications.">PocketCmdCtx</a> *ctx, <a class="code" href="pocketcmd_8h.html#affe678a12b9a8f6f3238b24e8eb4a9d7" title="Type for Command IDs.">pocketcmd_t</a> cmd, <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="structPocketBusCtx.html#a44fa9585b743eb44482eca7abecba34e" title="receiving Buffer">buf</a>, <span class="keywordtype">size_t</span> <a class="code" href="structPocketBusCtx.html#a79f45c81258788997cdd2f9fd94f8a66" title="Received length.">len</a>, <span class="keywordtype">bool</span> has_replay);
<a name="l00115"></a>00115 <span class="keywordtype">bool</span> <a class="code" href="pocketcmd_8c.html#a23fc67283834014609b06cd4b318fc9e" title="pocketBus Command recv function.">pocketcmd_recv</a>(<span class="keyword">struct</span> <a class="code" href="structPocketCmdCtx.html" title="pocketBus context for command layer communications.">PocketCmdCtx</a> *ctx, <a class="code" href="structPocketCmdMsg.html" title="pocketBus command message structure.">PocketCmdMsg</a> *recv_msg);
<a name="l00116"></a>00116 <span class="keywordtype">void</span> <a class="code" href="pocketcmd_8c.html#a5060e7ace57fad7f8fb9debf50faff41" title="Helper function used to reply to master with a NAK.">pocketcmd_replyNak</a>(<span class="keyword">struct</span> <a class="code" href="structPocketCmdMsg.html" title="pocketBus command message structure.">PocketCmdMsg</a> *msg);
<a name="l00117"></a>00117 <span class="keywordtype">void</span> <a class="code" href="pocketcmd_8c.html#ab19c58e94373dffa1aaad2922db4ac16" title="Helper function used to reply to master with an ACK.">pocketcmd_replyAck</a>(<span class="keyword">struct</span> <a class="code" href="structPocketCmdMsg.html" title="pocketBus command message structure.">PocketCmdMsg</a> *msg);
<a name="l00118"></a>00118 
<a name="l00122"></a><a class="code" href="pocketcmd_8h.html#a20c04401cc4064caccdf5538e04d2452">00122</a> INLINE <span class="keywordtype">bool</span> <a class="code" href="pocketcmd_8h.html#a20c04401cc4064caccdf5538e04d2452" title="Helper function used by master to send a command to slave addr.">pocketcmd_masterSend</a>(<span class="keyword">struct</span> <a class="code" href="structPocketCmdCtx.html" title="pocketBus context for command layer communications.">PocketCmdCtx</a> *ctx, <a class="code" href="pocketbus_8h.html#af63b5ecec3f1a8ffaf7d711181392dec" title="Type for pocketBus addresses.">pocketbus_addr_t</a> addr, <a class="code" href="pocketcmd_8h.html#affe678a12b9a8f6f3238b24e8eb4a9d7" title="Type for Command IDs.">pocketcmd_t</a> cmd, <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="structPocketBusCtx.html#a44fa9585b743eb44482eca7abecba34e" title="receiving Buffer">buf</a>, <span class="keywordtype">size_t</span> <a class="code" href="structPocketBusCtx.html#a79f45c81258788997cdd2f9fd94f8a66" title="Received length.">len</a>)
<a name="l00123"></a>00123 {
<a name="l00124"></a>00124     <a class="code" href="pocketcmd_8h.html#ab58ad8e743aacd2c778b8af04975a91a" title="Set slave address addr for pocketBus command layer.">pocketcmd_setAddr</a>(ctx, addr);
<a name="l00125"></a>00125     <span class="keywordflow">return</span> <a class="code" href="pocketcmd_8c.html#a42cde2e81868cb68d11bc4b2ae50d354" title="Send command cmd to/from slave adding len arguments in buf.">pocketcmd_send</a>(ctx, cmd, buf, len, <span class="keyword">true</span>);
<a name="l00126"></a>00126 }
<a name="l00127"></a>00127 
<a name="l00131"></a><a class="code" href="pocketcmd_8h.html#af576546acc34fa09eba5dbe3cf9d0280">00131</a> INLINE <span class="keywordtype">bool</span> <a class="code" href="pocketcmd_8h.html#af576546acc34fa09eba5dbe3cf9d0280" title="Helper function used by slave to reply to a master command.">pocketcmd_slaveReply</a>(<span class="keyword">struct</span> <a class="code" href="structPocketCmdCtx.html" title="pocketBus context for command layer communications.">PocketCmdCtx</a> *ctx, <a class="code" href="pocketcmd_8h.html#affe678a12b9a8f6f3238b24e8eb4a9d7" title="Type for Command IDs.">pocketcmd_t</a> cmd, <span class="keyword">const</span> <span class="keywordtype">void</span> *<a class="code" href="structPocketBusCtx.html#a44fa9585b743eb44482eca7abecba34e" title="receiving Buffer">buf</a>, <span class="keywordtype">size_t</span> <a class="code" href="structPocketBusCtx.html#a79f45c81258788997cdd2f9fd94f8a66" title="Received length.">len</a>)
<a name="l00132"></a>00132 {
<a name="l00133"></a>00133     <span class="keywordflow">return</span> <a class="code" href="pocketcmd_8c.html#a42cde2e81868cb68d11bc4b2ae50d354" title="Send command cmd to/from slave adding len arguments in buf.">pocketcmd_send</a>(ctx, cmd, buf, len, <span class="keyword">false</span>);
<a name="l00134"></a>00134 }
<a name="l00135"></a>00135 
<a name="l00139"></a><a class="code" href="pocketcmd_8h.html#afb888f76ee5d05f1063f4824d1dfd751">00139</a> INLINE <span class="keywordtype">bool</span> <a class="code" href="pocketcmd_8h.html#afb888f76ee5d05f1063f4824d1dfd751" title="Return true if message contain NAK.">pocketcmd_checkNak</a>(<span class="keyword">struct</span> <a class="code" href="structPocketCmdMsg.html" title="pocketBus command message structure.">PocketCmdMsg</a> *msg)
<a name="l00140"></a>00140 {
<a name="l00141"></a>00141     <span class="keywordflow">if</span> (msg-&gt;<a class="code" href="structPocketCmdMsg.html#a33c23053e1a07dbca61e746a07657471" title="optional arguments">buf</a>[0] == <a class="code" href="pocketbus_8h.html#a88fc41cd0e88eb505d4163e161113a81" title="pocketBus special characters definitions.">POCKETBUS_NAK</a>)
<a name="l00142"></a>00142         <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00143"></a>00143 
<a name="l00144"></a>00144     <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00145"></a>00145 }
<a name="l00146"></a>00146 
<a name="l00147"></a>00147 
<a name="l00148"></a>00148 
<a name="l00149"></a>00149 <span class="preprocessor">#endif </span><span class="comment">/* NET_POCKETCMD_H */</span>
</pre></div></div>
</div>


