

<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_9fd71c1ac00056e7d855336b2291c56c.html">bertos</a>      </li>
      <li class="navelem"><a class="el" href="dir_9a060263bfb9303858e12a804212ea33.html">gfx</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">text.c</div>  </div>
</div>
<div class="contents">
<a href="text_8c.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00040"></a>00040 <span class="preprocessor">#include &lt;<a class="code" href="gfx_8h.html">gfx/gfx.h</a>&gt;</span>
<a name="l00041"></a>00041 <span class="preprocessor">#include &lt;<a class="code" href="font_8h.html" title="Font 8x6 IBM-PC 8bit.">gfx/font.h</a>&gt;</span>
<a name="l00042"></a>00042 <span class="preprocessor">#include &lt;<a class="code" href="text_8h.html">gfx/text.h</a>&gt;</span>
<a name="l00043"></a>00043 
<a name="l00044"></a>00044 <span class="preprocessor">#include &lt;<a class="code" href="gfx__p_8h.html" title="Graphics private header.">gfx/gfx_p.h</a>&gt;</span> <span class="comment">// FIXME: BM_DRAWPIXEL</span>
<a name="l00045"></a>00045 
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;<a class="code" href="debug_8h.html">cfg/debug.h</a>&gt;</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 
<a name="l00054"></a><a class="code" href="text_8c.html#a39e1ce66cce127e0a3752e07345a3dd6">00054</a> <span class="keyword">static</span> <span class="keywordtype">bool</span> <a class="code" href="text_8c.html#a39e1ce66cce127e0a3752e07345a3dd6" title="ANSI escape sequences flag: true for ESC state on.">ansi_mode</a> = <span class="keyword">false</span>;
<a name="l00055"></a>00055 
<a name="l00059"></a><a class="code" href="group__text.html#ga55c3857af1780b4f35093ccf7f4ea1c5">00059</a> <span class="keywordtype">void</span> <a class="code" href="group__text.html#ga55c3857af1780b4f35093ccf7f4ea1c5" title="Move (imaginary) cursor to coordinates specified.">text_setCoord</a>(<span class="keyword">struct</span> <a class="code" href="structBitmap.html" title="Control structure to draw in a bitmap.">Bitmap</a> *bm, <span class="keywordtype">int</span> x, <span class="keywordtype">int</span> y)
<a name="l00060"></a>00060 {
<a name="l00061"></a>00061     bm-&gt;penX = x;
<a name="l00062"></a>00062     bm-&gt;<a class="code" href="structBitmap.html#afb830d068064b85602f2000b39100d2c" title="Current pen position MoveTo()/LineTo()">penY</a> = y;
<a name="l00063"></a>00063 }
<a name="l00064"></a>00064 
<a name="l00065"></a>00065 
<a name="l00070"></a><a class="code" href="group__text.html#gad7688018b0b948c3ae044dbe577fca26">00070</a> <span class="keywordtype">void</span> <a class="code" href="group__text.html#gad7688018b0b948c3ae044dbe577fca26" title="Move (imaginary) cursor to column and row specified.">text_moveTo</a>(<span class="keyword">struct</span> <a class="code" href="structBitmap.html" title="Control structure to draw in a bitmap.">Bitmap</a> *bm, <span class="keywordtype">int</span> row, <span class="keywordtype">int</span> col)
<a name="l00071"></a>00071 {
<a name="l00072"></a>00072     <a class="code" href="group__debug.html#gaca68c0d4ac8df0838e209fb5300f7be3" title="Assert a pre-condition on code.">ASSERT</a>(col &gt;= 0);
<a name="l00073"></a>00073     <a class="code" href="group__debug.html#gaca68c0d4ac8df0838e209fb5300f7be3" title="Assert a pre-condition on code.">ASSERT</a>(col &lt; bm-&gt;width / bm-&gt;font-&gt;width);
<a name="l00074"></a>00074     <a class="code" href="group__debug.html#gaca68c0d4ac8df0838e209fb5300f7be3" title="Assert a pre-condition on code.">ASSERT</a>(row &gt;= 0);
<a name="l00075"></a>00075     <a class="code" href="group__debug.html#gaca68c0d4ac8df0838e209fb5300f7be3" title="Assert a pre-condition on code.">ASSERT</a>(row &lt; bm-&gt;height / bm-&gt;font-&gt;<a class="code" href="structBitmap.html#a037c5bdbd9fb14eecd4d3ac617d508b2" title="Width/Height in pixels.">height</a>);
<a name="l00076"></a>00076 
<a name="l00077"></a>00077     <a class="code" href="group__text.html#ga55c3857af1780b4f35093ccf7f4ea1c5" title="Move (imaginary) cursor to coordinates specified.">text_setCoord</a>(bm, col * bm-&gt;font-&gt;width, row * bm-&gt;font-&gt;<a class="code" href="structBitmap.html#a037c5bdbd9fb14eecd4d3ac617d508b2" title="Width/Height in pixels.">height</a>);
<a name="l00078"></a>00078 }
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 
<a name="l00084"></a><a class="code" href="text_8c.html#af1bd3851099ca884b4f4620ca3e11b96">00084</a> <span class="keyword">static</span> <span class="keywordtype">int</span> <a class="code" href="text_8c.html#af1bd3851099ca884b4f4620ca3e11b96" title="Render char c on Bitmap bm.">text_putglyph</a>(<span class="keywordtype">char</span> c, <span class="keyword">struct</span> <a class="code" href="structBitmap.html" title="Control structure to draw in a bitmap.">Bitmap</a> *bm)
<a name="l00085"></a>00085 {
<a name="l00086"></a>00086     <span class="keyword">const</span> uint8_t * PROGMEM glyph;  <span class="comment">/* font is in progmem */</span>
<a name="l00087"></a>00087     uint8_t glyph_width, glyph_height, glyph_height_bytes;
<a name="l00088"></a>00088     <span class="keywordtype">unsigned</span> <span class="keywordtype">char</span> index = (<span class="keywordtype">unsigned</span> char)c;
<a name="l00089"></a>00089 
<a name="l00090"></a>00090     <span class="comment">/* Check for out of range char and replace with &#39;?&#39; or first char in font. */</span>
<a name="l00091"></a>00091     <span class="keywordflow">if</span> (UNLIKELY(!<a class="code" href="font_8h.html#aac552b1355ffac30a42b7cf4fc2792e5" title="Return true if glyph c is available in font.">FONT_HAS_GLYPH</a>(bm-&gt;font, index)))
<a name="l00092"></a>00092     {
<a name="l00093"></a>00093         kprintf(<span class="stringliteral">&quot;Illegal char &#39;%c&#39; (0x%02x)\n&quot;</span>, index, index);
<a name="l00094"></a>00094         <span class="keywordflow">if</span> (<a class="code" href="font_8h.html#aac552b1355ffac30a42b7cf4fc2792e5" title="Return true if glyph c is available in font.">FONT_HAS_GLYPH</a>(bm-&gt;font, <span class="charliteral">&#39;?&#39;</span>))
<a name="l00095"></a>00095             index = <span class="charliteral">&#39;?&#39;</span>;
<a name="l00096"></a>00096         <span class="keywordflow">else</span>
<a name="l00097"></a>00097             index = bm-&gt;font-&gt;first;
<a name="l00098"></a>00098     }
<a name="l00099"></a>00099 
<a name="l00100"></a>00100     <span class="comment">/* Make character relative to font start */</span>
<a name="l00101"></a>00101     index -= bm-&gt;font-&gt;first;
<a name="l00102"></a>00102 
<a name="l00103"></a>00103     glyph_height = bm-&gt;font-&gt;<a class="code" href="structBitmap.html#a037c5bdbd9fb14eecd4d3ac617d508b2" title="Width/Height in pixels.">height</a>;
<a name="l00104"></a>00104     <span class="comment">// FIXME: for vertical fonts only</span>
<a name="l00105"></a>00105     glyph_height_bytes = (glyph_height + 7) / 8;
<a name="l00106"></a>00106 
<a name="l00107"></a>00107     <span class="keywordflow">if</span> (bm-&gt;font-&gt;offset)
<a name="l00108"></a>00108     {
<a name="l00109"></a>00109         <span class="comment">/* Proportional font */</span>
<a name="l00110"></a>00110         glyph_width = bm-&gt;font-&gt;widths[index]; <span class="comment">/* TODO: optimize away */</span>
<a name="l00111"></a>00111         glyph = bm-&gt;font-&gt;glyph + bm-&gt;font-&gt;offset[index];
<a name="l00112"></a>00112     }
<a name="l00113"></a>00113     <span class="keywordflow">else</span>
<a name="l00114"></a>00114     {
<a name="l00115"></a>00115         <span class="comment">/*</span>
<a name="l00116"></a>00116 <span class="comment">         * Fixed-width font: compute the first column of pixels</span>
<a name="l00117"></a>00117 <span class="comment">         * of the selected glyph using the character code to index</span>
<a name="l00118"></a>00118 <span class="comment">         * the glyph array.</span>
<a name="l00119"></a>00119 <span class="comment">         */</span>
<a name="l00120"></a>00120         glyph_width = bm-&gt;font-&gt;width;
<a name="l00121"></a>00121 
<a name="l00122"></a>00122         <span class="comment">//For horizontal fonts</span>
<a name="l00123"></a>00123         <span class="comment">//glyph = bm-&gt;font-&gt;glyph + index * (((glyph_width + 7) / 8) * glyph_height);</span>
<a name="l00124"></a>00124         glyph = bm-&gt;font-&gt;glyph + index * glyph_height_bytes * glyph_width;
<a name="l00125"></a>00125     }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127     <span class="comment">/* Slow path for styled glyphs */</span>
<a name="l00128"></a>00128     <span class="keywordflow">if</span> (UNLIKELY(bm-&gt;styles))
<a name="l00129"></a>00129     {
<a name="l00130"></a>00130         uint8_t styles = bm-&gt;styles;
<a name="l00131"></a>00131         uint8_t prev_dots = 0, italic_prev_dots = 0;
<a name="l00132"></a>00132         uint8_t dots;
<a name="l00133"></a>00133         uint8_t row, col, row_bit;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135         <span class="comment">/*</span>
<a name="l00136"></a>00136 <span class="comment">         * To avoid repeating clipping and other expensive computations,</span>
<a name="l00137"></a>00137 <span class="comment">         * we cluster calls to gfx_blitRaster() using a small buffer.</span>
<a name="l00138"></a>00138 <span class="comment">         */</span>
<a name="l00139"></a>00139 <span class="preprocessor">        #define CONFIG_TEXT_RENDER_OPTIMIZE 1</span>
<a name="l00140"></a>00140 <span class="preprocessor"></span><span class="preprocessor">        #if CONFIG_TEXT_RENDER_OPTIMIZE</span>
<a name="l00141"></a>00141 <span class="preprocessor"></span><span class="preprocessor">            #define RENDER_BUF_WIDTH 12</span>
<a name="l00142"></a>00142 <span class="preprocessor"></span><span class="preprocessor">            #define RENDER_BUF_HEIGHT 8</span>
<a name="l00143"></a>00143 <span class="preprocessor"></span>            uint8_t render_buf[RAST_SIZE(RENDER_BUF_WIDTH, RENDER_BUF_HEIGHT)];
<a name="l00144"></a>00144             uint8_t render_xpos = 0;
<a name="l00145"></a>00145 <span class="preprocessor">        #endif</span>
<a name="l00146"></a>00146 <span class="preprocessor"></span>
<a name="l00147"></a>00147         <span class="comment">/* This style alone could be handled by the fast path too */</span>
<a name="l00148"></a>00148         <span class="keywordflow">if</span> (bm-&gt;styles &amp; STYLEF_CONDENSED)
<a name="l00149"></a>00149             --glyph_width;
<a name="l00150"></a>00150 
<a name="l00151"></a>00151         <span class="keywordflow">if</span> (bm-&gt;styles &amp; STYLEF_EXPANDED)
<a name="l00152"></a>00152             glyph_width *= 2;
<a name="l00153"></a>00153 
<a name="l00154"></a>00154         <span class="keywordflow">for</span> (row = 0, row_bit = 0; row &lt; glyph_height_bytes; ++row, row_bit += 8)
<a name="l00155"></a>00155         {
<a name="l00156"></a>00156             <span class="comment">/* For each dot column in the glyph... */</span>
<a name="l00157"></a>00157             <span class="keywordflow">for</span> (col = 0; col &lt; glyph_width; ++col)
<a name="l00158"></a>00158             {
<a name="l00159"></a>00159                 uint8_t src_col = col;
<a name="l00160"></a>00160 
<a name="l00161"></a>00161                 <span class="comment">/* Expanded style: advances only once every two columns. */</span>
<a name="l00162"></a>00162                 <span class="keywordflow">if</span> (styles &amp; STYLEF_EXPANDED)
<a name="l00163"></a>00163                     src_col /= 2;
<a name="l00164"></a>00164 
<a name="l00165"></a>00165                 <span class="comment">/* Fetch a column of dots from glyph. */</span>
<a name="l00166"></a>00166                 dots = PGM_READ_CHAR(RAST_ADDR(glyph, src_col, row_bit, glyph_width));
<a name="l00167"></a>00167 
<a name="l00168"></a>00168                 <span class="comment">/* Italic: get lower 4 dots from previous column */</span>
<a name="l00169"></a>00169                 <span class="keywordflow">if</span> (styles &amp; STYLEF_ITALIC)
<a name="l00170"></a>00170                 {
<a name="l00171"></a>00171                     uint8_t new_dots = dots;
<a name="l00172"></a>00172                     dots = (dots &amp; 0xF0) | italic_prev_dots;
<a name="l00173"></a>00173                     italic_prev_dots = new_dots &amp; 0x0F;
<a name="l00174"></a>00174                 }
<a name="l00175"></a>00175 
<a name="l00176"></a>00176                 <span class="comment">/* Bold: &quot;or&quot; pixels with the previous column */</span>
<a name="l00177"></a>00177                 <span class="keywordflow">if</span> (styles &amp; STYLEF_BOLD)
<a name="l00178"></a>00178                 {
<a name="l00179"></a>00179                     uint8_t new_dots = dots;
<a name="l00180"></a>00180                     dots |= prev_dots;
<a name="l00181"></a>00181                     prev_dots = new_dots;
<a name="l00182"></a>00182                 }
<a name="l00183"></a>00183 
<a name="l00184"></a>00184                 <span class="comment">/* Underlined: turn on base pixel */</span>
<a name="l00185"></a>00185                 <span class="keywordflow">if</span> ((styles &amp; STYLEF_UNDERLINE)
<a name="l00186"></a>00186                     &amp;&amp; (row == glyph_height_bytes - 1))
<a name="l00187"></a>00187                     dots |= (1 &lt;&lt; (glyph_height - row_bit - 1));
<a name="l00188"></a>00188 
<a name="l00189"></a>00189                 <span class="comment">/* Inverted: invert pixels */</span>
<a name="l00190"></a>00190                 <span class="keywordflow">if</span> (styles &amp; STYLEF_INVERT)
<a name="l00191"></a>00191                     dots = ~dots;
<a name="l00192"></a>00192 
<a name="l00193"></a>00193                 <span class="comment">/* Output dots */</span>
<a name="l00194"></a>00194 <span class="preprocessor">                #if CONFIG_TEXT_RENDER_OPTIMIZE</span>
<a name="l00195"></a>00195 <span class="preprocessor"></span>                    render_buf[render_xpos++] = dots;
<a name="l00196"></a>00196                     <span class="keywordflow">if</span> (render_xpos == RENDER_BUF_WIDTH)
<a name="l00197"></a>00197                     {
<a name="l00198"></a>00198                         <a class="code" href="bitmap_8c.html#a6ae8fd23236a5979f6babddacaa55625" title="Blit a raster to a Bitmap.">gfx_blitRaster</a>(bm, bm-&gt;penX + col - render_xpos + 1, bm-&gt;<a class="code" href="structBitmap.html#afb830d068064b85602f2000b39100d2c" title="Current pen position MoveTo()/LineTo()">penY</a> + row_bit,
<a name="l00199"></a>00199                             render_buf, render_xpos,
<a name="l00200"></a>00200                             MIN((uint8_t)RENDER_BUF_HEIGHT, (uint8_t)(glyph_height - row_bit)),
<a name="l00201"></a>00201                             RENDER_BUF_WIDTH);
<a name="l00202"></a>00202                         render_xpos = 0;
<a name="l00203"></a>00203                     }
<a name="l00204"></a>00204 <span class="preprocessor">                #else</span>
<a name="l00205"></a>00205 <span class="preprocessor"></span>                    <a class="code" href="bitmap_8c.html#a6ae8fd23236a5979f6babddacaa55625" title="Blit a raster to a Bitmap.">gfx_blitRaster</a>(bm, bm-&gt;penX + col, bm-&gt;<a class="code" href="structBitmap.html#afb830d068064b85602f2000b39100d2c" title="Current pen position MoveTo()/LineTo()">penY</a> + row_bit,
<a name="l00206"></a>00206                         &amp;dots, 1, MIN((uint8_t)8, glyph_height - row_bit), 1);
<a name="l00207"></a>00207 <span class="preprocessor">                #endif</span>
<a name="l00208"></a>00208 <span class="preprocessor"></span>            }
<a name="l00209"></a>00209 
<a name="l00210"></a>00210 <span class="preprocessor">            #if CONFIG_TEXT_RENDER_OPTIMIZE</span>
<a name="l00211"></a>00211 <span class="preprocessor"></span>                <span class="comment">/* Flush out rest of render buffer */</span>
<a name="l00212"></a>00212                 <span class="keywordflow">if</span> (render_xpos != 0)
<a name="l00213"></a>00213                 {
<a name="l00214"></a>00214                     <a class="code" href="bitmap_8c.html#a6ae8fd23236a5979f6babddacaa55625" title="Blit a raster to a Bitmap.">gfx_blitRaster</a>(bm, bm-&gt;penX + col - render_xpos, bm-&gt;<a class="code" href="structBitmap.html#afb830d068064b85602f2000b39100d2c" title="Current pen position MoveTo()/LineTo()">penY</a> + row_bit,
<a name="l00215"></a>00215                         render_buf, render_xpos,
<a name="l00216"></a>00216                         MIN((uint8_t)RENDER_BUF_HEIGHT, (uint8_t)(glyph_height - row_bit)),
<a name="l00217"></a>00217                         RENDER_BUF_WIDTH);
<a name="l00218"></a>00218                     render_xpos = 0;
<a name="l00219"></a>00219                 }
<a name="l00220"></a>00220 <span class="preprocessor">            #endif</span>
<a name="l00221"></a>00221 <span class="preprocessor"></span>        }
<a name="l00222"></a>00222     }
<a name="l00223"></a>00223     <span class="keywordflow">else</span>
<a name="l00224"></a>00224     {
<a name="l00225"></a>00225         <span class="comment">/* No style: fast vanilla copy of glyph to bitmap */</span>
<a name="l00226"></a>00226         <a class="code" href="bitmap_8c.html#a6ae8fd23236a5979f6babddacaa55625" title="Blit a raster to a Bitmap.">gfx_blitRaster</a>(bm, bm-&gt;penX, bm-&gt;<a class="code" href="structBitmap.html#afb830d068064b85602f2000b39100d2c" title="Current pen position MoveTo()/LineTo()">penY</a>, glyph, glyph_width, glyph_height, glyph_width);
<a name="l00227"></a>00227     }
<a name="l00228"></a>00228 
<a name="l00229"></a>00229     <span class="comment">/* Update current pen position */</span>
<a name="l00230"></a>00230     bm-&gt;penX += glyph_width;
<a name="l00231"></a>00231 
<a name="l00232"></a>00232     <span class="keywordflow">return</span> c;
<a name="l00233"></a>00233 }
<a name="l00234"></a>00234 
<a name="l00235"></a>00235 
<a name="l00240"></a><a class="code" href="group__text.html#gaff95a28db3cde2a7079817673866b3f8">00240</a> <span class="keywordtype">int</span> <a class="code" href="group__text.html#gaff95a28db3cde2a7079817673866b3f8" title="Render char c, with (currently) limited ANSI escapes emulation support and &#39; &#39; for newline...">text_putchar</a>(<span class="keywordtype">char</span> c, <span class="keyword">struct</span> <a class="code" href="structBitmap.html" title="Control structure to draw in a bitmap.">Bitmap</a> *bm)
<a name="l00241"></a>00241 {
<a name="l00242"></a>00242     <span class="comment">/* Handle ANSI escape sequences */</span>
<a name="l00243"></a>00243     <span class="keywordflow">if</span> (UNLIKELY(<a class="code" href="text_8c.html#a39e1ce66cce127e0a3752e07345a3dd6" title="ANSI escape sequences flag: true for ESC state on.">ansi_mode</a>))
<a name="l00244"></a>00244     {
<a name="l00245"></a>00245         <span class="keywordflow">switch</span> (c)
<a name="l00246"></a>00246         {
<a name="l00247"></a>00247         <span class="keywordflow">case</span> <a class="code" href="group__text.html#ga5816b4411c01a648711088828787a710" title="Escape sequences codes.">ANSI_ESC_CLEARSCREEN</a>:
<a name="l00248"></a>00248             <a class="code" href="bitmap_8c.html#a65a47ac38a94bda2f8346fc11834647d" title="Clear the whole bitmap surface to the background color.">gfx_bitmapClear</a>(bm);
<a name="l00249"></a>00249             bm-&gt;penX = 0;
<a name="l00250"></a>00250             bm-&gt;<a class="code" href="structBitmap.html#afb830d068064b85602f2000b39100d2c" title="Current pen position MoveTo()/LineTo()">penY</a> = 0;
<a name="l00251"></a>00251             <a class="code" href="group__text.html#gaf63765dfcdc1ff38e5a55676777f2bb0" title="Set/clear algorithmic font style bits.">text_style</a>(bm, 0, STYLEF_MASK);
<a name="l00252"></a>00252             <span class="keywordflow">break</span>;
<a name="l00253"></a>00253         <a class="code" href="group__debug.html#ga5ae59b9945c3ef623af1719976ef3a1f" title="This macro can be used to conditionally exclude one or more statements conditioned on _DEBUG...">DB</a>(<span class="keywordflow">default</span>:
<a name="l00254"></a>00254             kprintf(<span class="stringliteral">&quot;Unknown ANSI esc code: %x\n&quot;</span>, c);)
<a name="l00255"></a>00255         }
<a name="l00256"></a>00256         <a class="code" href="text_8c.html#a39e1ce66cce127e0a3752e07345a3dd6" title="ANSI escape sequences flag: true for ESC state on.">ansi_mode</a> = <span class="keyword">false</span>;
<a name="l00257"></a>00257     }
<a name="l00258"></a>00258     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\033&#39;</span>)  <span class="comment">/* Enter ANSI ESC mode */</span>
<a name="l00259"></a>00259     {
<a name="l00260"></a>00260         <a class="code" href="text_8c.html#a39e1ce66cce127e0a3752e07345a3dd6" title="ANSI escape sequences flag: true for ESC state on.">ansi_mode</a> = <span class="keyword">true</span>;
<a name="l00261"></a>00261     }
<a name="l00262"></a>00262     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (c == <span class="charliteral">&#39;\n&#39;</span>)  <span class="comment">/* Go one line down on a line-feed */</span>
<a name="l00263"></a>00263     {
<a name="l00264"></a>00264         <span class="keywordflow">if</span> (bm-&gt;<a class="code" href="structBitmap.html#afb830d068064b85602f2000b39100d2c" title="Current pen position MoveTo()/LineTo()">penY</a> + bm-&gt;font-&gt;<a class="code" href="structBitmap.html#a037c5bdbd9fb14eecd4d3ac617d508b2" title="Width/Height in pixels.">height</a> &lt; bm-&gt;<a class="code" href="structBitmap.html#a037c5bdbd9fb14eecd4d3ac617d508b2" title="Width/Height in pixels.">height</a>)
<a name="l00265"></a>00265         {
<a name="l00266"></a>00266             bm-&gt;<a class="code" href="structBitmap.html#afb830d068064b85602f2000b39100d2c" title="Current pen position MoveTo()/LineTo()">penY</a> += bm-&gt;font-&gt;<a class="code" href="structBitmap.html#a037c5bdbd9fb14eecd4d3ac617d508b2" title="Width/Height in pixels.">height</a>;
<a name="l00267"></a>00267             bm-&gt;penX = 0;
<a name="l00268"></a>00268         }
<a name="l00269"></a>00269     }
<a name="l00270"></a>00270     <span class="keywordflow">else</span>
<a name="l00271"></a>00271     {
<a name="l00272"></a>00272         <a class="code" href="text_8c.html#af1bd3851099ca884b4f4620ca3e11b96" title="Render char c on Bitmap bm.">text_putglyph</a>(c, bm);
<a name="l00273"></a>00273     }
<a name="l00274"></a>00274     <span class="keywordflow">return</span> c;
<a name="l00275"></a>00275 }
<a name="l00276"></a>00276 
<a name="l00277"></a>00277 
<a name="l00281"></a><a class="code" href="group__text.html#gae135eb2ac5f58a5ead4f3bf77c34c3cd">00281</a> <span class="keywordtype">void</span> <a class="code" href="group__text.html#gae135eb2ac5f58a5ead4f3bf77c34c3cd" title="Clear the screen and reset cursor position.">text_clear</a>(<span class="keyword">struct</span> <a class="code" href="structBitmap.html" title="Control structure to draw in a bitmap.">Bitmap</a> *bmp)
<a name="l00282"></a>00282 {
<a name="l00283"></a>00283     <a class="code" href="group__text.html#gaff95a28db3cde2a7079817673866b3f8" title="Render char c, with (currently) limited ANSI escapes emulation support and &#39; &#39; for newline...">text_putchar</a>(<span class="stringliteral">&#39;\x1b&#39;</span>, bmp);
<a name="l00284"></a>00284     <a class="code" href="group__text.html#gaff95a28db3cde2a7079817673866b3f8" title="Render char c, with (currently) limited ANSI escapes emulation support and &#39; &#39; for newline...">text_putchar</a>(<span class="charliteral">&#39;c&#39;</span>, bmp);
<a name="l00285"></a>00285 }
<a name="l00286"></a>00286 
<a name="l00287"></a>00287 
<a name="l00288"></a>00288 <span class="keywordtype">void</span> text_clearLine(<span class="keyword">struct</span> <a class="code" href="structBitmap.html" title="Control structure to draw in a bitmap.">Bitmap</a> *bm, <span class="keywordtype">int</span> line)
<a name="l00289"></a>00289 {
<a name="l00290"></a>00290     <a class="code" href="gfx_8h.html#ab7124b6d3eafe66785656ffdfc2cf55d" title="Clear a rectangular area.">gfx_rectClear</a>(bm, 0, line * bm-&gt;font-&gt;<a class="code" href="structBitmap.html#a037c5bdbd9fb14eecd4d3ac617d508b2" title="Width/Height in pixels.">height</a>, bm-&gt;width, (line + 1) * bm-&gt;font-&gt;<a class="code" href="structBitmap.html#a037c5bdbd9fb14eecd4d3ac617d508b2" title="Width/Height in pixels.">height</a>);
<a name="l00291"></a>00291 }
<a name="l00292"></a>00292 
<a name="l00293"></a>00293 
<a name="l00315"></a><a class="code" href="group__text.html#gaf63765dfcdc1ff38e5a55676777f2bb0">00315</a> uint8_t <a class="code" href="group__text.html#gaf63765dfcdc1ff38e5a55676777f2bb0" title="Set/clear algorithmic font style bits.">text_style</a>(<span class="keyword">struct</span> <a class="code" href="structBitmap.html" title="Control structure to draw in a bitmap.">Bitmap</a> *bm, uint8_t flags, uint8_t mask)
<a name="l00316"></a>00316 {
<a name="l00317"></a>00317     uint8_t old = bm-&gt;styles;
<a name="l00318"></a>00318     bm-&gt;styles = (bm-&gt;styles &amp; ~mask) | flags;
<a name="l00319"></a>00319     <span class="keywordflow">return</span> old;
<a name="l00320"></a>00320 }
</pre></div></div>
</div>


