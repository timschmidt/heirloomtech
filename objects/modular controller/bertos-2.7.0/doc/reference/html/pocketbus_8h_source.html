

<!-- Generated by Doxygen 1.7.4 -->
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="annotated.html"><span>Data&#160;Structures</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li><a href="dirs.html"><span>Directories</span></a></li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>Globals</span></a></li>
    </ul>
  </div>
  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="dir_9fd71c1ac00056e7d855336b2291c56c.html">bertos</a>      </li>
      <li class="navelem"><a class="el" href="dir_e91c80130e425b11d52da5b92a7aa933.html">net</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">pocketbus.h</div>  </div>
</div>
<div class="contents">
<a href="pocketbus_8h.html">Go to the documentation of this file.</a><div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 
<a name="l00042"></a>00042 <span class="preprocessor">#ifndef NET_POCKETBUS_H</span>
<a name="l00043"></a>00043 <span class="preprocessor"></span><span class="preprocessor">#define NET_POCKETBUS_H</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span>
<a name="l00045"></a>00045 <span class="preprocessor">#include &quot;<a class="code" href="cfg__pocketbus_8h.html" title="Configuration file for pocketbus module.">cfg/cfg_pocketbus.h</a>&quot;</span>        <span class="comment">/* for CONFIG_POCKETBUS_BUFLEN */</span>
<a name="l00046"></a>00046 <span class="preprocessor">#include &lt;<a class="code" href="compiler_8h.html" title="Additional support macros for compiler independance.">cfg/compiler.h</a>&gt;</span>
<a name="l00047"></a>00047 
<a name="l00048"></a>00048 <span class="preprocessor">#include &lt;<a class="code" href="rotating__hash_8h.html" title="Rotating Hash algorithm.">algo/rotating_hash.h</a>&gt;</span>
<a name="l00049"></a>00049 
<a name="l00050"></a>00050 <span class="preprocessor">#include &lt;<a class="code" href="io_2kfile_8h.html">io/kfile.h</a>&gt;</span>
<a name="l00051"></a>00051 
<a name="l00056"></a><a class="code" href="pocketbus_8h.html#a2f2189c4c3d45ced8701224d970013c2">00056</a> <span class="preprocessor">#define POCKETBUS_STX 0x02 //ASCII STX</span>
<a name="l00057"></a><a class="code" href="pocketbus_8h.html#aec6c2bc5f1440007c1d459972fed5a3e">00057</a> <span class="preprocessor"></span><span class="preprocessor">#define POCKETBUS_ETX 0x03 //ASCII ETX</span>
<a name="l00058"></a><a class="code" href="pocketbus_8h.html#ae8d63dbc87418d7ab43cc2164f4c5e9c">00058</a> <span class="preprocessor"></span><span class="preprocessor">#define POCKETBUS_ESC 0x1B //ASCII ESC</span>
<a name="l00059"></a><a class="code" href="pocketbus_8h.html#a00176121fe536f0d8a3881eb3498cabd">00059</a> <span class="preprocessor"></span><span class="preprocessor">#define POCKETBUS_ACK 0x06 //ASCII ACK</span>
<a name="l00060"></a><a class="code" href="pocketbus_8h.html#a88fc41cd0e88eb505d4163e161113a81">00060</a> <span class="preprocessor"></span><span class="preprocessor">#define POCKETBUS_NAK 0x15 //ASCII NAK</span>
<a name="l00061"></a>00061 <span class="preprocessor"></span><span class="comment">/*\}*/</span>
<a name="l00062"></a>00062 
<a name="l00063"></a><a class="code" href="pocketbus_8h.html#aea1074099c8e42817e64e1a249d073e1">00063</a> <span class="preprocessor">#define POCKETBUS_BROADCAST_ADDR 0xFFFF ///&lt; pocketBus broadcast address</span>
<a name="l00064"></a>00064 <span class="preprocessor"></span>
<a name="l00068"></a><a class="code" href="pocketbus_8h.html#a8c6d1bda67f65a44ce69c9ef0b75c55e">00068</a> <span class="keyword">typedef</span> uint16_t <a class="code" href="pocketbus_8h.html#a8c6d1bda67f65a44ce69c9ef0b75c55e" title="Type for pocketBus length.">pocketbus_len_t</a>;
<a name="l00069"></a>00069 
<a name="l00073"></a><a class="code" href="pocketbus_8h.html#af63b5ecec3f1a8ffaf7d711181392dec">00073</a> <span class="keyword">typedef</span> uint16_t <a class="code" href="pocketbus_8h.html#af63b5ecec3f1a8ffaf7d711181392dec" title="Type for pocketBus addresses.">pocketbus_addr_t</a>;
<a name="l00074"></a>00074 
<a name="l00078"></a><a class="code" href="structPocketBusHdr.html">00078</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structPocketBusHdr.html" title="Header of pocketBus messages.">PocketBusHdr</a>
<a name="l00079"></a>00079 {
<a name="l00080"></a>00080 <span class="preprocessor">    #define POCKETBUS_VER 1</span>
<a name="l00081"></a><a class="code" href="structPocketBusHdr.html#ab1ba4d24145973544ee08818ed2e98f7">00081</a> <span class="preprocessor"></span>    uint8_t <a class="code" href="structPocketBusHdr.html#ab1ba4d24145973544ee08818ed2e98f7" title="packet version">ver</a>;   
<a name="l00082"></a><a class="code" href="structPocketBusHdr.html#a9b8dbd7319a98b27d9775e30708efa83">00082</a>     <a class="code" href="pocketbus_8h.html#af63b5ecec3f1a8ffaf7d711181392dec" title="Type for pocketBus addresses.">pocketbus_addr_t</a> <a class="code" href="structPocketBusHdr.html#a9b8dbd7319a98b27d9775e30708efa83" title="slave address">addr</a>; 
<a name="l00083"></a>00083 } <a class="code" href="structPocketBusHdr.html" title="Header of pocketBus messages.">PocketBusHdr</a>;
<a name="l00084"></a>00084 
<a name="l00088"></a><a class="code" href="structPocketBusCtx.html">00088</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structPocketBusCtx.html" title="pocketBus context structure.">PocketBusCtx</a>
<a name="l00089"></a>00089 {
<a name="l00090"></a><a class="code" href="structPocketBusCtx.html#a44fa9585b743eb44482eca7abecba34e">00090</a>     uint8_t <a class="code" href="structPocketBusCtx.html#a44fa9585b743eb44482eca7abecba34e" title="receiving Buffer">buf</a>[<a class="code" href="cfg__pocketbus_8h.html#a8df6303314c579786d81eb15e0300626" title="Buffer len for pockebus protocol.">CONFIG_POCKETBUS_BUFLEN</a>]; 
<a name="l00091"></a><a class="code" href="structPocketBusCtx.html#abf9becd84a17b6e96966922b4af7093a">00091</a>     <span class="keyword">struct </span><a class="code" href="structKFile.html" title="Context data for callback functions which operate on pseudo files.">KFile</a> *<a class="code" href="structPocketBusCtx.html#abf9becd84a17b6e96966922b4af7093a" title="File descriptor.">fd</a>;   
<a name="l00092"></a><a class="code" href="structPocketBusCtx.html#a38f89072c821b818d3f895e1bbbe3283">00092</a>     <span class="keywordtype">bool</span> <a class="code" href="structPocketBusCtx.html#a38f89072c821b818d3f895e1bbbe3283" title="Status flag: true if we have received an STX, false otherwise.">sync</a>;           
<a name="l00093"></a><a class="code" href="structPocketBusCtx.html#a0a98cf14df674c7a8d443adade357eec">00093</a>     <span class="keywordtype">bool</span> <a class="code" href="structPocketBusCtx.html#a0a98cf14df674c7a8d443adade357eec" title="Status flag: true if we are in escape mode, false otherwise.">escape</a>;         
<a name="l00094"></a><a class="code" href="structPocketBusCtx.html#a0594688ef2e92a736dfa6e54b2b3c803">00094</a>     rotating_t <a class="code" href="structPocketBusCtx.html#a0594688ef2e92a736dfa6e54b2b3c803" title="Checksum computation for received data.">in_cks</a>;   
<a name="l00095"></a><a class="code" href="structPocketBusCtx.html#ac0514ebcce95b0d22bd8551196cd4c5f">00095</a>     rotating_t <a class="code" href="structPocketBusCtx.html#ac0514ebcce95b0d22bd8551196cd4c5f" title="Checksum computation for transmitted data.">out_cks</a>;  
<a name="l00096"></a><a class="code" href="structPocketBusCtx.html#a79f45c81258788997cdd2f9fd94f8a66">00096</a>     <a class="code" href="pocketbus_8h.html#a8c6d1bda67f65a44ce69c9ef0b75c55e" title="Type for pocketBus length.">pocketbus_len_t</a> <a class="code" href="structPocketBusCtx.html#a79f45c81258788997cdd2f9fd94f8a66" title="Received length.">len</a>; 
<a name="l00097"></a>00097 } <a class="code" href="structPocketBusCtx.html" title="pocketBus context structure.">PocketBusCtx</a>;
<a name="l00098"></a>00098 
<a name="l00099"></a>00099 <a class="code" href="compiler_8h.html#a695e64485eb9535f5ddcfec01167bddc" title="Issue a compilation error if the condition is false.">STATIC_ASSERT</a>(<a class="code" href="compiler_8h.html#ad89ebe5fe5ad08c683f0871118ea8e2f" title="Return the byte offset of the member m in struct s.">offsetof</a>(<a class="code" href="structPocketBusCtx.html" title="pocketBus context structure.">PocketBusCtx</a>, buf) == 0);
<a name="l00103"></a><a class="code" href="structPocketMsg.html">00103</a> <span class="keyword">typedef</span> <span class="keyword">struct </span><a class="code" href="structPocketMsg.html" title="Structure holding pocketBus message parameters.">PocketMsg</a>
<a name="l00104"></a>00104 {
<a name="l00105"></a><a class="code" href="structPocketMsg.html#ada982dfaafdde28a2dabab5608f6f3c2">00105</a>     <span class="keyword">struct </span><a class="code" href="structPocketBusCtx.html" title="pocketBus context structure.">PocketBusCtx</a> *<a class="code" href="structPocketMsg.html#ada982dfaafdde28a2dabab5608f6f3c2" title="pocketBus message context">ctx</a>; 
<a name="l00106"></a><a class="code" href="structPocketMsg.html#a3c591539dfb92e4f0f3e243963a32041">00106</a>     <a class="code" href="pocketbus_8h.html#af63b5ecec3f1a8ffaf7d711181392dec" title="Type for pocketBus addresses.">pocketbus_addr_t</a> <a class="code" href="structPocketMsg.html#a3c591539dfb92e4f0f3e243963a32041" title="address for received packet">addr</a>;    
<a name="l00107"></a><a class="code" href="structPocketMsg.html#accc0775a89a1a322a83bd77d28c4f22a">00107</a>     <a class="code" href="pocketbus_8h.html#a8c6d1bda67f65a44ce69c9ef0b75c55e" title="Type for pocketBus length.">pocketbus_len_t</a> <a class="code" href="structPocketMsg.html#accc0775a89a1a322a83bd77d28c4f22a" title="payload length">len</a>;      
<a name="l00108"></a><a class="code" href="structPocketMsg.html#a691da6b0989c0f6c2fc9df89f5f17daa">00108</a>     <span class="keyword">const</span> uint8_t *<a class="code" href="structPocketMsg.html#a691da6b0989c0f6c2fc9df89f5f17daa" title="payload data">payload</a>;   
<a name="l00109"></a>00109 } <a class="code" href="structPocketMsg.html" title="Structure holding pocketBus message parameters.">PocketMsg</a>;
<a name="l00110"></a>00110 
<a name="l00116"></a>00116 <a class="code" href="compiler_8h.html#a695e64485eb9535f5ddcfec01167bddc" title="Issue a compilation error if the condition is false.">STATIC_ASSERT</a>(<span class="keyword">sizeof</span>(<a class="code" href="pocketbus_8h.html#af63b5ecec3f1a8ffaf7d711181392dec" title="Type for pocketBus addresses.">pocketbus_addr_t</a>) == <span class="keyword">sizeof</span>(uint16_t));
<a name="l00117"></a>00117 <a class="code" href="compiler_8h.html#a695e64485eb9535f5ddcfec01167bddc" title="Issue a compilation error if the condition is false.">STATIC_ASSERT</a>(<span class="keyword">sizeof</span>(rotating_t) == <span class="keyword">sizeof</span>(uint16_t));
<a name="l00118"></a>00118 <span class="comment">/*\}*/</span>
<a name="l00119"></a>00119 
<a name="l00120"></a>00120 <span class="keywordtype">void</span> <a class="code" href="pocketbus_8c.html#ae6a9a07114695dc497be7a9d19dfc153" title="Send a character over pocketBus channel stream, handling escape mode.">pocketbus_putchar</a>(<span class="keyword">struct</span> <a class="code" href="structPocketBusCtx.html" title="pocketBus context structure.">PocketBusCtx</a> *ctx, uint8_t c);
<a name="l00121"></a>00121 <span class="keywordtype">void</span> <a class="code" href="pocketbus_8c.html#a9e64fea54236836ebbb111188a386213" title="Send pocketBus packet header.">pocketbus_begin</a>(<span class="keyword">struct</span> <a class="code" href="structPocketBusCtx.html" title="pocketBus context structure.">PocketBusCtx</a> *ctx, <a class="code" href="pocketbus_8h.html#af63b5ecec3f1a8ffaf7d711181392dec" title="Type for pocketBus addresses.">pocketbus_addr_t</a> addr);
<a name="l00122"></a>00122 <span class="keywordtype">void</span> <a class="code" href="pocketbus_8c.html#a9589e76fc410f9fed1b25807baf8ba6d" title="Send buffer _data over bus, handling escape.">pocketbus_write</a>(<span class="keyword">struct</span> <a class="code" href="structPocketBusCtx.html" title="pocketBus context structure.">PocketBusCtx</a> *ctx, <span class="keyword">const</span> <span class="keywordtype">void</span> *_data, <span class="keywordtype">size_t</span> <a class="code" href="structPocketBusCtx.html#a79f45c81258788997cdd2f9fd94f8a66" title="Received length.">len</a>);
<a name="l00123"></a>00123 <span class="keywordtype">void</span> <a class="code" href="pocketbus_8c.html#ac87ef3191ab444e8a02abd7819a7d068" title="Send pocketBus packet tail.">pocketbus_end</a>(<span class="keyword">struct</span> <a class="code" href="structPocketBusCtx.html" title="pocketBus context structure.">PocketBusCtx</a> *ctx);
<a name="l00124"></a>00124 
<a name="l00125"></a>00125 <span class="keywordtype">void</span> <a class="code" href="pocketbus_8c.html#afd291395155722155fc63cd63a0e1b15" title="Send buffer of data to address addr with a pocketBus packet over channel stream.">pocketbus_send</a>(<span class="keyword">struct</span> <a class="code" href="structPocketBusCtx.html" title="pocketBus context structure.">PocketBusCtx</a> *ctx, <a class="code" href="pocketbus_8h.html#af63b5ecec3f1a8ffaf7d711181392dec" title="Type for pocketBus addresses.">pocketbus_addr_t</a> addr, <span class="keyword">const</span> <span class="keywordtype">void</span> *data, <span class="keywordtype">size_t</span> <a class="code" href="structPocketBusCtx.html#a79f45c81258788997cdd2f9fd94f8a66" title="Received length.">len</a>);
<a name="l00126"></a>00126 <span class="keywordtype">bool</span> <a class="code" href="pocketbus_8c.html#ab5c6bf4b8545d77f30c6f92f97684106" title="Try to read a packet from the pocketBus.">pocketbus_recv</a>(<span class="keyword">struct</span> <a class="code" href="structPocketBusCtx.html" title="pocketBus context structure.">PocketBusCtx</a> *ctx, <span class="keyword">struct</span> <a class="code" href="structPocketMsg.html" title="Structure holding pocketBus message parameters.">PocketMsg</a> *msg);
<a name="l00127"></a>00127 <span class="keywordtype">void</span> <a class="code" href="pocketbus_8c.html#a35e365a7ea36ce352e9895d01d81b8a8" title="Initialize pocketBus protocol handler.">pocketbus_init</a>(<span class="keyword">struct</span> <a class="code" href="structPocketBusCtx.html" title="pocketBus context structure.">PocketBusCtx</a> *ctx, <span class="keyword">struct</span> <a class="code" href="structKFile.html" title="Context data for callback functions which operate on pseudo files.">KFile</a> *<a class="code" href="structPocketBusCtx.html#abf9becd84a17b6e96966922b4af7093a" title="File descriptor.">fd</a>);
<a name="l00128"></a>00128 
<a name="l00129"></a>00129 <span class="preprocessor">#endif </span><span class="comment">/* NET_POCKETBUS_H */</span>
</pre></div></div>
</div>


